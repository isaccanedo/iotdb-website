import{_ as i,c,b as e,d as a,e as s,a as p,w as l,r as o,o as r}from"./app-BHE9oQwv.js";const u={};function k(d,n){const t=o("RouteLink");return r(),c("div",null,[n[12]||(n[12]=e('<h1 id="alerting" tabindex="-1"><a class="header-anchor" href="#alerting"><span>Alerting</span></a></h1><h2 id="overview" tabindex="-1"><a class="header-anchor" href="#overview"><span>Overview</span></a></h2><p>The alerting of IoTDB is expected to support two modes:</p><ul><li><p>Writing triggered: the user writes data to the original time series, and every time a piece of data is inserted, the judgment logic of <code>trigger</code> will be triggered.<br> If the alerting requirements are met, an alert is sent to the data sink,<br> The data sink then forwards the alert to the external terminal.</p><ul><li>This mode is suitable for scenarios that need to monitor every piece of data in real time.</li><li>Since the operation in the trigger will affect the data writing performance, it is suitable for scenarios that are not sensitive to the original data writing performance.</li></ul></li><li><p>Continuous query: the user writes data to the original time series,<br><code>ContinousQuery</code> periodically queries the original time series, and writes the query results into the new time series,<br> Each write triggers the judgment logic of <code>trigger</code>,<br> If the alerting requirements are met, an alert is sent to the data sink,<br> The data sink then forwards the alert to the external terminal.</p><ul><li>This mode is suitable for scenarios where data needs to be regularly queried within a certain period of time.</li><li>It is Suitable for scenarios where the original data needs to be down-sampled and persisted.</li><li>Since the timing query hardly affects the writing of the original time series, it is suitable for scenarios that are sensitive to the performance of the original data writing performance.</li></ul></li></ul>',4)),a("p",null,[n[1]||(n[1]=s("With the introduction of the ")),p(t,{to:"/UserGuide/V1.1.x/Trigger/Instructions.html"},{default:l(()=>n[0]||(n[0]=[s("Trigger")])),_:1}),n[2]||(n[2]=s(" into IoTDB,")),n[3]||(n[3]=a("br",null,null,-1)),n[4]||(n[4]=s(" at present, users can use these two modules with ")),n[5]||(n[5]=a("code",null,"AlertManager",-1)),n[6]||(n[6]=s(" to realize the writing triggered alerting mode."))]),n[13]||(n[13]=e(`<h2 id="deploying-alertmanager" tabindex="-1"><a class="header-anchor" href="#deploying-alertmanager"><span>Deploying AlertManager</span></a></h2><h3 id="installation" tabindex="-1"><a class="header-anchor" href="#installation"><span>Installation</span></a></h3><h4 id="precompiled-binaries" tabindex="-1"><a class="header-anchor" href="#precompiled-binaries"><span>Precompiled binaries</span></a></h4><p>The pre-compiled binary file can be downloaded <a href="https://prometheus.io/download/" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Running command:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">./alertmanager <span class="token parameter variable">--config.file</span><span class="token operator">=</span><span class="token operator">&lt;</span>your_file<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="docker-image" tabindex="-1"><a class="header-anchor" href="#docker-image"><span>Docker image</span></a></h4><p>Available at <a href="https://hub.docker.com/r/prom/alertmanager/" target="_blank" rel="noopener noreferrer">Quay.io</a><br> or <a href="https://quay.io/repository/prometheus/alertmanager" target="_blank" rel="noopener noreferrer">Docker Hub</a>.</p><p>Running command:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">--name</span> alertmanager <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:9093:9093 quay.io/prometheus/alertmanager</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration"><span>Configuration</span></a></h3><p>The following is an example, which can cover most of the configuration rules. For detailed configuration rules, see<br><a href="https://prometheus.io/docs/alerting/latest/configuration/" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Example:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># alertmanager.yml</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">global</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># The smarthost and SMTP sender used for mail notifications.</span></span>
<span class="line">  <span class="token key atrule">smtp_smarthost</span><span class="token punctuation">:</span> <span class="token string">&#39;localhost:25&#39;</span></span>
<span class="line">  <span class="token key atrule">smtp_from</span><span class="token punctuation">:</span> <span class="token string">&#39;alertmanager@example.org&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># The root route on which each incoming alert enters.</span></span>
<span class="line"><span class="token key atrule">route</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># The root route must not have any matchers as it is the entry point for</span></span>
<span class="line">  <span class="token comment"># all alerts. It needs to have a receiver configured so alerts that do not</span></span>
<span class="line">  <span class="token comment"># match any of the sub-routes are sent to someone.</span></span>
<span class="line">  <span class="token key atrule">receiver</span><span class="token punctuation">:</span> <span class="token string">&#39;team-X-mails&#39;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment"># The labels by which incoming alerts are grouped together. For example,</span></span>
<span class="line">  <span class="token comment"># multiple alerts coming in for cluster=A and alertname=LatencyHigh would</span></span>
<span class="line">  <span class="token comment"># be batched into a single group.</span></span>
<span class="line">  <span class="token comment">#</span></span>
<span class="line">  <span class="token comment"># To aggregate by all possible labels use &#39;...&#39; as the sole label name.</span></span>
<span class="line">  <span class="token comment"># This effectively disables aggregation entirely, passing through all</span></span>
<span class="line">  <span class="token comment"># alerts as-is. This is unlikely to be what you want, unless you have</span></span>
<span class="line">  <span class="token comment"># a very low alert volume or your upstream notification system performs</span></span>
<span class="line">  <span class="token comment"># its own grouping. Example: group_by: [...]</span></span>
<span class="line">  <span class="token key atrule">group_by</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;alertname&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;cluster&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment"># When a new group of alerts is created by an incoming alert, wait at</span></span>
<span class="line">  <span class="token comment"># least &#39;group_wait&#39; to send the initial notification.</span></span>
<span class="line">  <span class="token comment"># This way ensures that you get multiple alerts for the same group that start</span></span>
<span class="line">  <span class="token comment"># firing shortly after another are batched together on the first</span></span>
<span class="line">  <span class="token comment"># notification.</span></span>
<span class="line">  <span class="token key atrule">group_wait</span><span class="token punctuation">:</span> 30s</span>
<span class="line"></span>
<span class="line">  <span class="token comment"># When the first notification was sent, wait &#39;group_interval&#39; to send a batch</span></span>
<span class="line">  <span class="token comment"># of new alerts that started firing for that group.</span></span>
<span class="line">  <span class="token key atrule">group_interval</span><span class="token punctuation">:</span> 5m</span>
<span class="line"></span>
<span class="line">  <span class="token comment"># If an alert has successfully been sent, wait &#39;repeat_interval&#39; to</span></span>
<span class="line">  <span class="token comment"># resend them.</span></span>
<span class="line">  <span class="token key atrule">repeat_interval</span><span class="token punctuation">:</span> 3h</span>
<span class="line"></span>
<span class="line">  <span class="token comment"># All the above attributes are inherited by all child routes and can</span></span>
<span class="line">  <span class="token comment"># overwritten on each.</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment"># The child route trees.</span></span>
<span class="line">  <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># This routes performs a regular expression match on alert labels to</span></span>
<span class="line">  <span class="token comment"># catch alerts that are related to a list of services.</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">match_re</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">service</span><span class="token punctuation">:</span> ^(foo1<span class="token punctuation">|</span>foo2<span class="token punctuation">|</span>baz)$</span>
<span class="line">    <span class="token key atrule">receiver</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>X<span class="token punctuation">-</span>mails</span>
<span class="line"></span>
<span class="line">    <span class="token comment"># The service has a sub-route for critical alerts, any alerts</span></span>
<span class="line">    <span class="token comment"># that do not match, i.e. severity != critical, fall-back to the</span></span>
<span class="line">    <span class="token comment"># parent node and are sent to &#39;team-X-mails&#39;</span></span>
<span class="line">    <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical</span>
<span class="line">      <span class="token key atrule">receiver</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>X<span class="token punctuation">-</span>pager</span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">service</span><span class="token punctuation">:</span> files</span>
<span class="line">    <span class="token key atrule">receiver</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>Y<span class="token punctuation">-</span>mails</span>
<span class="line"></span>
<span class="line">    <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical</span>
<span class="line">      <span class="token key atrule">receiver</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>Y<span class="token punctuation">-</span>pager</span>
<span class="line"></span>
<span class="line">  <span class="token comment"># This route handles all alerts coming from a database service. If there&#39;s</span></span>
<span class="line">  <span class="token comment"># no team to handle it, it defaults to the DB team.</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">service</span><span class="token punctuation">:</span> database</span>
<span class="line"></span>
<span class="line">    <span class="token key atrule">receiver</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>DB<span class="token punctuation">-</span>pager</span>
<span class="line">    <span class="token comment"># Also group alerts by affected database.</span></span>
<span class="line">    <span class="token key atrule">group_by</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>alertname<span class="token punctuation">,</span> cluster<span class="token punctuation">,</span> database<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">owner</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>X</span>
<span class="line">      <span class="token key atrule">receiver</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>X<span class="token punctuation">-</span>pager</span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">owner</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>Y</span>
<span class="line">      <span class="token key atrule">receiver</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>Y<span class="token punctuation">-</span>pager</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Inhibition rules allow to mute a set of alerts given that another alert is</span></span>
<span class="line"><span class="token comment"># firing.</span></span>
<span class="line"><span class="token comment"># We use this to mute any warning-level notifications if the same alert is</span></span>
<span class="line"><span class="token comment"># already critical.</span></span>
<span class="line"><span class="token key atrule">inhibit_rules</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token punctuation">-</span> <span class="token key atrule">source_match</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">severity</span><span class="token punctuation">:</span> <span class="token string">&#39;critical&#39;</span></span>
<span class="line">  <span class="token key atrule">target_match</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">severity</span><span class="token punctuation">:</span> <span class="token string">&#39;warning&#39;</span></span>
<span class="line">  <span class="token comment"># Apply inhibition if the alertname is the same.</span></span>
<span class="line">  <span class="token comment"># CAUTION: </span></span>
<span class="line">  <span class="token comment">#   If all label names listed in \`equal\` are missing </span></span>
<span class="line">  <span class="token comment">#   from both the source and target alerts,</span></span>
<span class="line">  <span class="token comment">#   the inhibition rule will apply!</span></span>
<span class="line">  <span class="token key atrule">equal</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;alertname&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">receivers</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;team-X-mails&#39;</span></span>
<span class="line">  <span class="token key atrule">email_configs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> <span class="token string">&#39;team-X+alerts@example.org, team-Y+alerts@example.org&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;team-X-pager&#39;</span></span>
<span class="line">  <span class="token key atrule">email_configs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> <span class="token string">&#39;team-X+alerts-critical@example.org&#39;</span></span>
<span class="line">  <span class="token key atrule">pagerduty_configs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">routing_key</span><span class="token punctuation">:</span> &lt;team<span class="token punctuation">-</span>X<span class="token punctuation">-</span>key<span class="token punctuation">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;team-Y-mails&#39;</span></span>
<span class="line">  <span class="token key atrule">email_configs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> <span class="token string">&#39;team-Y+alerts@example.org&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;team-Y-pager&#39;</span></span>
<span class="line">  <span class="token key atrule">pagerduty_configs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">routing_key</span><span class="token punctuation">:</span> &lt;team<span class="token punctuation">-</span>Y<span class="token punctuation">-</span>key<span class="token punctuation">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;team-DB-pager&#39;</span></span>
<span class="line">  <span class="token key atrule">pagerduty_configs</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">routing_key</span><span class="token punctuation">:</span> &lt;team<span class="token punctuation">-</span>DB<span class="token punctuation">-</span>key<span class="token punctuation">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In the following example, we used the following configuration:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># alertmanager.yml</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">global</span><span class="token punctuation">:</span> </span>
<span class="line">  <span class="token key atrule">smtp_smarthost</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">  <span class="token key atrule">smtp_from</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span> </span>
<span class="line">  <span class="token key atrule">smtp_auth_username</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span> </span>
<span class="line">  <span class="token key atrule">smtp_auth_password</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span> </span>
<span class="line">  <span class="token key atrule">smtp_require_tls</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">route</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">group_by</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;alertname&#39;</span><span class="token punctuation">]</span> </span>
<span class="line">  <span class="token key atrule">group_wait</span><span class="token punctuation">:</span> 1m</span>
<span class="line">  <span class="token key atrule">group_interval</span><span class="token punctuation">:</span> 10m</span>
<span class="line">  <span class="token key atrule">repeat_interval</span><span class="token punctuation">:</span> 10h </span>
<span class="line">  <span class="token key atrule">receiver</span><span class="token punctuation">:</span> <span class="token string">&#39;email&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">receivers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;email&#39;</span></span>
<span class="line">    <span class="token key atrule">email_configs</span><span class="token punctuation">:</span> </span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span> </span>
<span class="line"></span>
<span class="line"><span class="token key atrule">inhibit_rules</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">source_match</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">severity</span><span class="token punctuation">:</span> <span class="token string">&#39;critical&#39;</span></span>
<span class="line">    <span class="token key atrule">target_match</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">severity</span><span class="token punctuation">:</span> <span class="token string">&#39;warning&#39;</span></span>
<span class="line">    <span class="token key atrule">equal</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;alertname&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="api" tabindex="-1"><a class="header-anchor" href="#api"><span>API</span></a></h3><p>The <code>AlertManager</code> API is divided into two versions, <code>v1</code> and <code>v2</code>. The current <code>AlertManager</code> API version is <code>v2</code><br> (For configuration see<br><a href="https://github.com/prometheus/alertmanager/blob/master/api/v2/openapi.yaml" target="_blank" rel="noopener noreferrer">api/v2/openapi.yaml</a>).</p><p>By default, the prefix is <code>/api/v1</code> or <code>/api/v2</code> and the endpoint for sending alerts is <code>/api/v1/alerts</code> or <code>/api/v2/alerts</code>.<br> If the user specifies <code>--web.route-prefix</code>,<br> for example <code>--web.route-prefix=/alertmanager/</code>,<br> then the prefix will become <code>/alertmanager/api/v1</code> or <code>/alertmanager/api/v2</code>,<br> and the endpoint that sends the alert becomes <code>/alertmanager/api/v1/alerts</code><br> or <code>/alertmanager/api/v2/alerts</code>.</p><h2 id="creating-trigger" tabindex="-1"><a class="header-anchor" href="#creating-trigger"><span>Creating trigger</span></a></h2><h3 id="writing-the-trigger-class" tabindex="-1"><a class="header-anchor" href="#writing-the-trigger-class"><span>Writing the trigger class</span></a></h3>`,21)),a("p",null,[n[8]||(n[8]=s("The user defines a trigger by creating a Java class and writing the logic in the hook.")),n[9]||(n[9]=a("br",null,null,-1)),n[10]||(n[10]=s(" Please refer to ")),p(t,{to:"/UserGuide/V1.1.x/Trigger/Implement-Trigger.html"},{default:l(()=>n[7]||(n[7]=[s("Trigger")])),_:1}),n[11]||(n[11]=s(" for the specific configuration process."))]),n[14]||(n[14]=e(`<p>The following example creates the <code>org.apache.iotdb.trigger.ClusterAlertingExample</code> class,<br> Its alertManagerHandler member variables can send alerts to the AlertManager instance<br> at the address of <code>http://127.0.0.1:9093/</code>.</p><p>When <code>value&gt; 100.0</code>, send an alert of <code>critical</code> severity;<br> when <code>50.0 &lt;value &lt;= 100.0</code>, send an alert of <code>warning</code> severity<br> .</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line"> * Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="line"> * or more contributor license agreements.  See the NOTICE file</span>
<span class="line"> * distributed with this work for additional information</span>
<span class="line"> * regarding copyright ownership.  The ASF licenses this file</span>
<span class="line"> * to you under the Apache License, Version 2.0 (the</span>
<span class="line"> * &quot;License&quot;); you may not use this file except in compliance</span>
<span class="line"> * with the License.  You may obtain a copy of the License at</span>
<span class="line"> *</span>
<span class="line"> *     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="line"> *</span>
<span class="line"> * Unless required by applicable law or agreed to in writing,</span>
<span class="line"> * software distributed under the License is distributed on an</span>
<span class="line"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="line"> * KIND, either express or implied.  See the License for the</span>
<span class="line"> * specific language governing permissions and limitations</span>
<span class="line"> * under the License.</span>
<span class="line"> */</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>iotdb<span class="token punctuation">.</span>trigger</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>iotdb<span class="token punctuation">.</span>db<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>trigger<span class="token punctuation">.</span>sink<span class="token punctuation">.</span>alertmanager<span class="token punctuation">.</span></span><span class="token class-name">AlertManagerConfiguration</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>iotdb<span class="token punctuation">.</span>db<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>trigger<span class="token punctuation">.</span>sink<span class="token punctuation">.</span>alertmanager<span class="token punctuation">.</span></span><span class="token class-name">AlertManagerEvent</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>iotdb<span class="token punctuation">.</span>db<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>trigger<span class="token punctuation">.</span>sink<span class="token punctuation">.</span>alertmanager<span class="token punctuation">.</span></span><span class="token class-name">AlertManagerHandler</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>iotdb<span class="token punctuation">.</span>trigger<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Trigger</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>iotdb<span class="token punctuation">.</span>trigger<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">TriggerAttributes</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>iotdb<span class="token punctuation">.</span>tsfile<span class="token punctuation">.</span>file<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">TSDataType</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>iotdb<span class="token punctuation">.</span>tsfile<span class="token punctuation">.</span>write<span class="token punctuation">.</span>record<span class="token punctuation">.</span></span><span class="token class-name">Tablet</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>iotdb<span class="token punctuation">.</span>tsfile<span class="token punctuation">.</span>write<span class="token punctuation">.</span>schema<span class="token punctuation">.</span></span><span class="token class-name">MeasurementSchema</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClusterAlertingExample</span> <span class="token keyword">implements</span> <span class="token class-name">Trigger</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> <span class="token constant">LOGGER</span> <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ClusterAlertingExample</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AlertManagerHandler</span> alertManagerHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlertManagerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AlertManagerConfiguration</span> alertManagerConfiguration <span class="token operator">=</span></span>
<span class="line">      <span class="token keyword">new</span> <span class="token class-name">AlertManagerConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:9093/api/v2/alerts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">private</span> <span class="token class-name">String</span> alertname<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> labels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> annotations <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token annotation punctuation">@Override</span></span>
<span class="line">  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">TriggerAttributes</span> attributes<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">    alertname <span class="token operator">=</span> <span class="token string">&quot;alert_test&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    labels<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;series&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root.ln.wf01.wt01.temperature&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    labels<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    labels<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;severity&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    annotations<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;summary&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;high temperature&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    annotations<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;{{.alertname}}: {{.series}} is {{.value}}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    alertManagerHandler<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>alertManagerConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token annotation punctuation">@Override</span></span>
<span class="line">  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDrop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span></span>
<span class="line">    alertManagerHandler<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token annotation punctuation">@Override</span></span>
<span class="line">  <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">fire</span><span class="token punctuation">(</span><span class="token class-name">Tablet</span> tablet<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MeasurementSchema</span><span class="token punctuation">&gt;</span></span> measurementSchemaList <span class="token operator">=</span> tablet<span class="token punctuation">.</span><span class="token function">getSchemas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">=</span> measurementSchemaList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>measurementSchemaList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">TSDataType</span><span class="token punctuation">.</span><span class="token constant">DOUBLE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// for example, we only deal with the columns of Double type</span></span>
<span class="line">        <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> tablet<span class="token punctuation">.</span>values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">double</span> value <span class="token operator">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&gt;</span> <span class="token number">100.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;trigger value &gt; 100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            labels<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            labels<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;severity&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;critical&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">AlertManagerEvent</span> alertManagerEvent <span class="token operator">=</span></span>
<span class="line">                <span class="token keyword">new</span> <span class="token class-name">AlertManagerEvent</span><span class="token punctuation">(</span>alertname<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> annotations<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            alertManagerHandler<span class="token punctuation">.</span><span class="token function">onEvent</span><span class="token punctuation">(</span>alertManagerEvent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&gt;</span> <span class="token number">50.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;trigger value &gt; 50&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            labels<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            labels<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;severity&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;warning&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">AlertManagerEvent</span> alertManagerEvent <span class="token operator">=</span></span>
<span class="line">                <span class="token keyword">new</span> <span class="token class-name">AlertManagerEvent</span><span class="token punctuation">(</span>alertname<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> annotations<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            alertManagerHandler<span class="token punctuation">.</span><span class="token function">onEvent</span><span class="token punctuation">(</span>alertManagerEvent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="creating-trigger-1" tabindex="-1"><a class="header-anchor" href="#creating-trigger-1"><span>Creating trigger</span></a></h3><p>The following SQL statement registered the trigger<br> named <code>root-ln-wf01-wt01-alert</code><br> on the <code>root.ln.wf01.wt01.temperature</code> time series,<br> whose operation logic is defined<br> by <code>org.apache.iotdb.trigger.ClusterAlertingExample</code> java class.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line">  <span class="token keyword">CREATE</span> STATELESS <span class="token keyword">TRIGGER</span> <span class="token identifier"><span class="token punctuation">\`</span>root-ln-wf01-wt01-alert<span class="token punctuation">\`</span></span></span>
<span class="line">  <span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span></span>
<span class="line">  <span class="token keyword">ON</span> root<span class="token punctuation">.</span>ln<span class="token punctuation">.</span>wf01<span class="token punctuation">.</span>wt01<span class="token punctuation">.</span>temperature</span>
<span class="line">  <span class="token keyword">AS</span> <span class="token string">&quot;org.apache.iotdb.trigger.AlertingExample&quot;</span></span>
<span class="line">  <span class="token keyword">USING</span> URI <span class="token string">&#39;http://jar/ClusterAlertingExample.jar&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="writing-data" tabindex="-1"><a class="header-anchor" href="#writing-data"><span>Writing data</span></a></h2><p>When we finish the deployment and startup of AlertManager as well as the creation of Trigger,<br> we can test the alerting<br> by writing data to the time series.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> root<span class="token punctuation">.</span>ln<span class="token punctuation">.</span>wf01<span class="token punctuation">.</span>wt01<span class="token punctuation">(</span><span class="token keyword">timestamp</span><span class="token punctuation">,</span> temperature<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> root<span class="token punctuation">.</span>ln<span class="token punctuation">.</span>wf01<span class="token punctuation">.</span>wt01<span class="token punctuation">(</span><span class="token keyword">timestamp</span><span class="token punctuation">,</span> temperature<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> root<span class="token punctuation">.</span>ln<span class="token punctuation">.</span>wf01<span class="token punctuation">.</span>wt01<span class="token punctuation">(</span><span class="token keyword">timestamp</span><span class="token punctuation">,</span> temperature<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> root<span class="token punctuation">.</span>ln<span class="token punctuation">.</span>wf01<span class="token punctuation">.</span>wt01<span class="token punctuation">(</span><span class="token keyword">timestamp</span><span class="token punctuation">,</span> temperature<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> root<span class="token punctuation">.</span>ln<span class="token punctuation">.</span>wf01<span class="token punctuation">.</span>wt01<span class="token punctuation">(</span><span class="token keyword">timestamp</span><span class="token punctuation">,</span> temperature<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>After executing the above writing statements,<br> we can receive an alerting email. Because our <code>AlertManager</code> configuration above<br> makes alerts of <code>critical</code> severity inhibit those of <code>warning</code> severity,<br> the alerting email we receive only contains the alert triggered<br> by the writing of <code>(5, 120)</code>.</p><img width="669" alt="alerting" src="https://alioss.timecho.com/docs/img/github/115957896-a9791080-a537-11eb-9962-541412bdcee6.png">`,11))])}const v=i(u,[["render",k],["__file","Alerting.html.vue"]]),g=JSON.parse('{"path":"/UserGuide/V1.1.x/Monitor-Alert/Alerting.html","title":"Alerting","lang":"en-US","frontmatter":{"description":"Alerting Overview The alerting of IoTDB is expected to support two modes: Writing triggered: the user writes data to the original time series, and every time a piece of data is ...","head":[["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://iotdb.apache.org/zh/UserGuide/V1.1.x/Monitor-Alert/Alerting.html"}],["meta",{"property":"og:url","content":"https://iotdb.apache.org/UserGuide/V1.1.x/Monitor-Alert/Alerting.html"}],["meta",{"property":"og:site_name","content":"IoTDB Website"}],["meta",{"property":"og:title","content":"Alerting"}],["meta",{"property":"og:description","content":"Alerting Overview The alerting of IoTDB is expected to support two modes: Writing triggered: the user writes data to the original time series, and every time a piece of data is ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-07-10T03:11:17.000Z"}],["meta",{"property":"article:modified_time","content":"2023-07-10T03:11:17.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Alerting\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-07-10T03:11:17.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Overview","slug":"overview","link":"#overview","children":[]},{"level":2,"title":"Deploying AlertManager","slug":"deploying-alertmanager","link":"#deploying-alertmanager","children":[{"level":3,"title":"Installation","slug":"installation","link":"#installation","children":[]},{"level":3,"title":"Configuration","slug":"configuration","link":"#configuration","children":[]},{"level":3,"title":"API","slug":"api","link":"#api","children":[]}]},{"level":2,"title":"Creating trigger","slug":"creating-trigger","link":"#creating-trigger","children":[{"level":3,"title":"Writing the trigger class","slug":"writing-the-trigger-class","link":"#writing-the-trigger-class","children":[]},{"level":3,"title":"Creating trigger","slug":"creating-trigger-1","link":"#creating-trigger-1","children":[]}]},{"level":2,"title":"Writing data","slug":"writing-data","link":"#writing-data","children":[]}],"git":{"createdTime":1688958677000,"updatedTime":1688958677000,"contributors":[{"name":"CritasWang","email":"critas@outlook.com","commits":1}]},"readingTime":{"minutes":5.58,"words":1673},"filePathRelative":"UserGuide/V1.1.x/Monitor-Alert/Alerting.md","localizedDate":"July 10, 2023","autoDesc":true}');export{v as comp,g as data};
