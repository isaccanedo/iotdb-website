<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="alternate" hreflang="en-us" href="https://iotdb.apache.org/UserGuide/V1.3.0-2/Reference/UDF-Libraries.html"><meta property="og:url" content="https://iotdb.apache.org/zh/UserGuide/V1.3.0-2/Reference/UDF-Libraries.html"><meta property="og:site_name" content="IoTDB Website"><meta property="og:title" content="UDF函数库"><meta property="og:description" content="UDF函数库 基于用户自定义函数能力，IoTDB 提供了一系列关于时序数据处理的函数，包括数据质量、数据画像、异常检测、 频域分析、数据匹配、数据修复、序列发现、机器学习等，能够满足工业领域对时序数据处理的需求。 安装步骤 请获取与 IoTDB 版本兼容的 UDF 函数库 JAR 包的压缩包。 将获取的压缩包中的 library-udf.jar 文件放..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:locale:alternate" content="en-US"><meta property="og:updated_time" content="2024-11-11T11:01:16.000Z"><meta property="article:modified_time" content="2024-11-11T11:01:16.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"UDF函数库","image":[""],"dateModified":"2024-11-11T11:01:16.000Z","author":[]}</script><link rel="icon" href="/favicon.ico"><meta name="Description" content="Apache IoTDB: Time Series Database for IoT"><meta name="Keywords" content="TSDB, time series, time series database, IoTDB, IoT database, IoT data management,时序数据库, 时间序列管理, IoTDB, 物联网数据库, 实时数据库, 物联网数据管理, 物联网数据"><meta name="baidu-site-verification" content="wfKETzB3OT"><meta name="google-site-verification" content="mZWAoRY0yj_HAr-s47zHCGHzx5Ju-RVm5wDbPnwQYFo"><script type="text/javascript">
var _paq = window._paq = window._paq || [];
/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
_paq.push(["setDoNotTrack", true]);
_paq.push(["disableCookies"]);
_paq.push(['trackPageView']);
_paq.push(['enableLinkTracking']);
(function() {
  var u="https://analytics.apache.org/";
  _paq.push(['setTrackerUrl', u+'matomo.php']);
  _paq.push(['setSiteId', '56']);
  var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
  g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
})();
       </script><title>UDF函数库 | IoTDB Website</title><meta name="description" content="UDF函数库 基于用户自定义函数能力，IoTDB 提供了一系列关于时序数据处理的函数，包括数据质量、数据画像、异常检测、 频域分析、数据匹配、数据修复、序列发现、机器学习等，能够满足工业领域对时序数据处理的需求。 安装步骤 请获取与 IoTDB 版本兼容的 UDF 函数库 JAR 包的压缩包。 将获取的压缩包中的 library-udf.jar 文件放...">
    <link rel="preload" href="/assets/style-DNdyb_f0.css" as="style"><link rel="stylesheet" href="/assets/style-DNdyb_f0.css">
    <link rel="modulepreload" href="/assets/app-BHE9oQwv.js"><link rel="modulepreload" href="/assets/UDF-Libraries.html-B0WJW2nd.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container external-link-icon pure has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/zh/"><img class="vp-nav-logo" src="/logo.png" alt><!----><span class="vp-site-name hide-in-pad">IoTDB Website</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="文档"><!--[--><!---->文档<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/zh/UserGuide/latest/QuickStart/QuickStart_apache.html" aria-label="v1.3.3"><!---->v1.3.3<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/zh/UserGuide/V1.3.0-2/QuickStart/QuickStart_apache.html" aria-label="v1.3.0/1/2"><!---->v1.3.0/1/2<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/zh/UserGuide/V1.2.x/QuickStart/QuickStart.html" aria-label="v1.2.x"><!---->v1.2.x<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/zh/UserGuide/V1.1.x/QuickStart/QuickStart.html" aria-label="v1.1.x"><!---->v1.1.x<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/zh/UserGuide/V1.0.x/QuickStart/QuickStart.html" aria-label="v1.0.x"><!---->v1.0.x<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/zh/UserGuide/V0.13.x/QuickStart/QuickStart.html" aria-label="v0.13.x"><!---->v0.13.x<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="auto-link external-link" href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=177051872" aria-label="系统设计" rel="noopener noreferrer" target="_blank"><!---->系统设计<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/zh/Download/" aria-label="下载"><!---->下载<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="社区"><!--[--><!---->社区<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/zh/Community/About.html" aria-label="关于社区"><!---->关于社区<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/zh/Community/Development-Guide.html" aria-label="贡献指南"><!---->贡献指南<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/zh/Community/Powered-By.html" aria-label="社区伙伴"><!---->社区伙伴<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/zh/Community/Feedback.html" aria-label="交流与反馈"><!---->交流与反馈<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/zh/Community/Materials.html" aria-label="活动与报告"><!---->活动与报告<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/zh/Community/Community-Project-Committers.html" aria-label="Commiters"><!---->Commiters<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="ASF"><!--[--><!---->ASF<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="auto-link external-link" href="https://www.apache.org/" aria-label="基金会" rel="noopener noreferrer" target="_blank"><!---->基金会<!----></a></li><li class="vp-dropdown-item"><a class="auto-link external-link" href="https://www.apache.org/licenses/" aria-label="许可证" rel="noopener noreferrer" target="_blank"><!---->许可证<!----></a></li><li class="vp-dropdown-item"><a class="auto-link external-link" href="https://www.apache.org/security/" aria-label="安全" rel="noopener noreferrer" target="_blank"><!---->安全<!----></a></li><li class="vp-dropdown-item"><a class="auto-link external-link" href="https://www.apache.org/foundation/sponsorship.html" aria-label="赞助" rel="noopener noreferrer" target="_blank"><!---->赞助<!----></a></li><li class="vp-dropdown-item"><a class="auto-link external-link" href="https://www.apache.org/foundation/thanks.html" aria-label="致谢" rel="noopener noreferrer" target="_blank"><!---->致谢<!----></a></li><li class="vp-dropdown-item"><a class="auto-link external-link" href="https://www.apache.org/events/current-event" aria-label="活动" rel="noopener noreferrer" target="_blank"><!---->活动<!----></a></li><li class="vp-dropdown-item"><a class="auto-link external-link" href="https://privacy.apache.org/policies/privacy-policy-public.html" aria-label="隐私" rel="noopener noreferrer" target="_blank"><!---->隐私<!----></a></li></ul></button></div></div></nav><div class="vp-nav-item"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="选择语言"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" name="i18n" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/UserGuide/V1.3.0-2/Reference/UDF-Libraries.html" aria-label="English"><!---->English<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/zh/UserGuide/V1.3.0-2/Reference/UDF-Libraries.html" aria-label="简体中文"><!---->简体中文<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:none;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:block;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/apache/iotdb" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><!----><span class="vp-sidebar-title">IoTDB用户手册 (V1.3.0/1/2)</span><!----></p><ul class="vp-sidebar-links"></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">关于IoTDB</span><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/zh/UserGuide/V1.3.0-2/QuickStart/QuickStart_apache.html" aria-label="快速上手"><!---->快速上手<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">基础概念</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">部署与运维</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">使用手册</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">工具体系</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">应用编程接口</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">系统集成</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">SQL手册</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">FAQ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">参考</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/zh/UserGuide/V1.3.0-2/Reference/UDF-Libraries.html" aria-label="UDF函数库"><!---->UDF函数库<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zh/UserGuide/V1.3.0-2/Reference/UDF-development.html" aria-label="UDF开发"><!---->UDF开发<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zh/UserGuide/V1.3.0-2/Reference/Function-and-Expression.html" aria-label="内置函数与表达式"><!---->内置函数与表达式<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zh/UserGuide/V1.3.0-2/Reference/Common-Config-Manual.html" aria-label="配置参数"><!---->配置参数<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zh/UserGuide/V1.3.0-2/Reference/ConfigNode-Config-Manual.html" aria-label="ConfigNode配置参数"><!---->ConfigNode配置参数<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zh/UserGuide/V1.3.0-2/Reference/DataNode-Config-Manual.html" aria-label="DataNode配置参数"><!---->DataNode配置参数<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zh/UserGuide/V1.3.0-2/Reference/Status-Codes.html" aria-label="状态码"><!---->状态码<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zh/UserGuide/V1.3.0-2/Reference/Keywords.html" aria-label="关键字"><!---->关键字<!----></a></li></ul></section></li></ul><!----></aside><!--[--><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->UDF函数库</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="写作日期"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-09-01T12:02:30.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 107 分钟</span><meta property="timeRequired" content="PT107M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#安装步骤">安装步骤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#数据质量">数据质量</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#completeness">Completeness</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#consistency">Consistency</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#timeliness">Timeliness</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#validity">Validity</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#数据画像">数据画像</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#acf">ACF</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#distinct">Distinct</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#histogram">Histogram</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#integral">Integral</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#integralavg">IntegralAvg</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#mad">Mad</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#median">Median</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#minmax">MinMax</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#mvavg">MvAvg</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#pacf">PACF</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#percentile">Percentile</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#quantile">Quantile</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#period">Period</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#qlb">QLB</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#resample">Resample</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#sample">Sample</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#segment">Segment</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#skew">Skew</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spline">Spline</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spread">Spread</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#zscore">ZScore</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#异常检测">异常检测</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#iqr">IQR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ksigma">KSigma</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#lof">LOF</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#missdetect">MissDetect</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#range">Range</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#twosidedfilter">TwoSidedFilter</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#outlier">Outlier</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#mastertrain">MasterTrain</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#masterdetect">MasterDetect</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#频域分析">频域分析</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#conv">Conv</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#deconv">Deconv</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dwt">DWT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#fft">FFT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#highpass">HighPass</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ifft">IFFT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#lowpass">LowPass</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#envelope">Envelope</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#函数简介-41">函数简介</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用示例-41">使用示例</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#数据匹配">数据匹配</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cov">Cov</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dtw">Dtw</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#pearson">Pearson</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ptnsym">PtnSym</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#xcorr">XCorr</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#数据修复">数据修复</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#timestamprepair">TimestampRepair</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#函数简介-47">函数简介</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用示例-47">使用示例</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#valuefill">ValueFill</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#valuerepair">ValueRepair</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#masterrepair">MasterRepair</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#seasonalrepair">SeasonalRepair</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#序列发现">序列发现</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#consecutivesequences">ConsecutiveSequences</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#consecutivewindows">ConsecutiveWindows</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#机器学习">机器学习</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ar">AR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#representation">Representation</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rm">RM</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="udf函数库" tabindex="-1"><a class="header-anchor" href="#udf函数库"><span>UDF函数库</span></a></h1><p>基于用户自定义函数能力，IoTDB 提供了一系列关于时序数据处理的函数，包括数据质量、数据画像、异常检测、 频域分析、数据匹配、数据修复、序列发现、机器学习等，能够满足工业领域对时序数据处理的需求。</p><h2 id="安装步骤" tabindex="-1"><a class="header-anchor" href="#安装步骤"><span>安装步骤</span></a></h2><ol><li><p>请获取与 IoTDB 版本兼容的 UDF 函数库 JAR 包的压缩包。</p><table><thead><tr><th>UDF 函数库版本</th><th>支持的 IoTDB 版本</th><th>下载链接</th></tr></thead><tbody><tr><td>UDF-1.3.3.zip</td><td>V1.3.3及以上</td><td><a href="https://alioss.timecho.com/upload/UDF-1.3.3.zip" target="_blank" rel="noopener noreferrer">压缩包</a></td></tr><tr><td>UDF-1.3.2.zip</td><td>V1.0.0～V1.3.2</td><td><a href="https://alioss.timecho.com/upload/UDF-1.3.2.zip" target="_blank" rel="noopener noreferrer">压缩包</a></td></tr></tbody></table></li><li><p>将获取的压缩包中的 library-udf.jar 文件放置在 IoTDB 集群所有节点的 <code>/ext/udf</code> 的目录下</p></li><li><p>在 IoTDB 的 SQL 命令行终端（CLI）或可视化控制台（Workbench）的 SQL 操作界面中，执行下述相应的函数注册语句。</p></li><li><p>批量注册：两种注册方式：注册脚本 或 SQL汇总语句</p></li></ol><ul><li><p>注册脚本</p><ul><li>将压缩包中的注册脚本（<a href="http://register-UDF.sh" target="_blank" rel="noopener noreferrer">register-UDF.sh</a> 或 register-UDF.bat）按需复制到 IoTDB 的 tools 目录下，修改脚本中的参数（默认为host=127.0.0.1，rpcPort=6667，user=root，pass=root）；</li><li>启动 IoTDB 服务，运行注册脚本批量注册 UDF</li></ul></li><li><p>SQL汇总语句</p><ul><li>打开压缩包中的SQl文件，复制全部 SQL 语句，在 IoTDB 的 SQL 命令行终端（CLI）或可视化控制台（Workbench）的 SQL 操作界面中，执行全部 SQl 语句批量注册 UDF</li></ul></li></ul><h2 id="数据质量" tabindex="-1"><a class="header-anchor" href="#数据质量"><span>数据质量</span></a></h2><h3 id="completeness" tabindex="-1"><a class="header-anchor" href="#completeness"><span>Completeness</span></a></h3><h4 id="注册语句" tabindex="-1"><a class="header-anchor" href="#注册语句"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> completeness <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dquality.UDTFCompleteness&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介" tabindex="-1"><a class="header-anchor" href="#函数简介"><span>函数简介</span></a></h4><p>本函数用于计算时间序列的完整性。将输入序列划分为若干个连续且不重叠的窗口，分别计算每一个窗口的完整性，并输出窗口第一个数据点的时间戳和窗口的完整性。</p><p><strong>函数名：</strong> COMPLETENESS</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>window</code>：窗口大小，它是一个大于0的整数或者一个有单位的正数。前者代表每一个窗口包含的数据点数目，最后一个窗口的数据点数目可能会不足；后者代表窗口的时间跨度，目前支持五种单位，分别是&#39;ms&#39;（毫秒）、&#39;s&#39;（秒）、&#39;m&#39;（分钟）、&#39;h&#39;（小时）和&#39;d&#39;（天）。缺省情况下，全部输入数据都属于同一个窗口。</li><li><code>downtime</code>：完整性计算是否考虑停机异常。它的取值为 &#39;true&#39; 或 &#39;false&#39;，默认值为 &#39;true&#39;. 在考虑停机异常时，长时间的数据缺失将被视作停机，不对完整性产生影响。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为DOUBLE，其中每一个数据点的值的范围都是 [0,1].</p><p><strong>提示：</strong> 只有当窗口内的数据点数目超过10时，才会进行完整性计算。否则，该窗口将被忽略，不做任何输出。</p><h4 id="使用示例" tabindex="-1"><a class="header-anchor" href="#使用示例"><span>使用示例</span></a></h4><h5 id="参数缺省" tabindex="-1"><a class="header-anchor" href="#参数缺省"><span>参数缺省</span></a></h5><p>在参数缺省的情况下，本函数将会把全部输入数据都作为同一个窗口计算完整性。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|          101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|          112.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|          118.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          120.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|          124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|            NaN|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> completeness<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">30</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-----------------------------+</span>
<span class="line">|                         Time|completeness(root.test.d1.s1)|</span>
<span class="line">+-----------------------------+-----------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|                        0.875|</span>
<span class="line">+-----------------------------+-----------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="指定窗口大小" tabindex="-1"><a class="header-anchor" href="#指定窗口大小"><span>指定窗口大小</span></a></h5><p>在指定窗口大小的情况下，本函数会把输入数据划分为若干个窗口计算完整性。</p><p>输入序列:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|          101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|          112.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|          118.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          120.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|          124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|            NaN|</span>
<span class="line">|2020-01-01T00:00:32.000+08:00|          130.0|</span>
<span class="line">|2020-01-01T00:00:34.000+08:00|          132.0|</span>
<span class="line">|2020-01-01T00:00:36.000+08:00|          134.0|</span>
<span class="line">|2020-01-01T00:00:38.000+08:00|          136.0|</span>
<span class="line">|2020-01-01T00:00:40.000+08:00|          138.0|</span>
<span class="line">|2020-01-01T00:00:42.000+08:00|          140.0|</span>
<span class="line">|2020-01-01T00:00:44.000+08:00|          142.0|</span>
<span class="line">|2020-01-01T00:00:46.000+08:00|          144.0|</span>
<span class="line">|2020-01-01T00:00:48.000+08:00|          146.0|</span>
<span class="line">|2020-01-01T00:00:50.000+08:00|          148.0|</span>
<span class="line">|2020-01-01T00:00:52.000+08:00|          150.0|</span>
<span class="line">|2020-01-01T00:00:54.000+08:00|          152.0|</span>
<span class="line">|2020-01-01T00:00:56.000+08:00|          154.0|</span>
<span class="line">|2020-01-01T00:00:58.000+08:00|          156.0|</span>
<span class="line">|2020-01-01T00:01:00.000+08:00|          158.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> completeness<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&quot;window&quot;</span><span class="token operator">=</span><span class="token string">&quot;15&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">01</span>:<span class="token number">00</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------------------------------+</span>
<span class="line">|                         Time|completeness(root.test.d1.s1, &quot;window&quot;=&quot;15&quot;)|</span>
<span class="line">+-----------------------------+--------------------------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|                                       0.875|</span>
<span class="line">|2020-01-01T00:00:32.000+08:00|                                         1.0|</span>
<span class="line">+-----------------------------+--------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="consistency" tabindex="-1"><a class="header-anchor" href="#consistency"><span>Consistency</span></a></h3><h4 id="注册语句-1" tabindex="-1"><a class="header-anchor" href="#注册语句-1"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> consistency <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dquality.UDTFConsistency&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-1" tabindex="-1"><a class="header-anchor" href="#函数简介-1"><span>函数简介</span></a></h4><p>本函数用于计算时间序列的一致性。将输入序列划分为若干个连续且不重叠的窗口，分别计算每一个窗口的一致性，并输出窗口第一个数据点的时间戳和窗口的时效性。</p><p><strong>函数名：</strong> CONSISTENCY</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>window</code>：窗口大小，它是一个大于0的整数或者一个有单位的正数。前者代表每一个窗口包含的数据点数目，最后一个窗口的数据点数目可能会不足；后者代表窗口的时间跨度，目前支持五种单位，分别是 &#39;ms&#39;（毫秒）、&#39;s&#39;（秒）、&#39;m&#39;（分钟）、&#39;h&#39;（小时）和&#39;d&#39;（天）。缺省情况下，全部输入数据都属于同一个窗口。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为DOUBLE，其中每一个数据点的值的范围都是 [0,1].</p><p><strong>提示：</strong> 只有当窗口内的数据点数目超过10时，才会进行一致性计算。否则，该窗口将被忽略，不做任何输出。</p><h4 id="使用示例-1" tabindex="-1"><a class="header-anchor" href="#使用示例-1"><span>使用示例</span></a></h4><h5 id="参数缺省-1" tabindex="-1"><a class="header-anchor" href="#参数缺省-1"><span>参数缺省</span></a></h5><p>在参数缺省的情况下，本函数将会把全部输入数据都作为同一个窗口计算一致性。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|          101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|          112.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|          118.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          120.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|          124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|            NaN|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> consistency<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">30</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+----------------------------+</span>
<span class="line">|                         Time|consistency(root.test.d1.s1)|</span>
<span class="line">+-----------------------------+----------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          0.9333333333333333|</span>
<span class="line">+-----------------------------+----------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="指定窗口大小-1" tabindex="-1"><a class="header-anchor" href="#指定窗口大小-1"><span>指定窗口大小</span></a></h5><p>在指定窗口大小的情况下，本函数会把输入数据划分为若干个窗口计算一致性。</p><p>输入序列:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|          101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|          112.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|          118.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          120.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|          124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|            NaN|</span>
<span class="line">|2020-01-01T00:00:32.000+08:00|          130.0|</span>
<span class="line">|2020-01-01T00:00:34.000+08:00|          132.0|</span>
<span class="line">|2020-01-01T00:00:36.000+08:00|          134.0|</span>
<span class="line">|2020-01-01T00:00:38.000+08:00|          136.0|</span>
<span class="line">|2020-01-01T00:00:40.000+08:00|          138.0|</span>
<span class="line">|2020-01-01T00:00:42.000+08:00|          140.0|</span>
<span class="line">|2020-01-01T00:00:44.000+08:00|          142.0|</span>
<span class="line">|2020-01-01T00:00:46.000+08:00|          144.0|</span>
<span class="line">|2020-01-01T00:00:48.000+08:00|          146.0|</span>
<span class="line">|2020-01-01T00:00:50.000+08:00|          148.0|</span>
<span class="line">|2020-01-01T00:00:52.000+08:00|          150.0|</span>
<span class="line">|2020-01-01T00:00:54.000+08:00|          152.0|</span>
<span class="line">|2020-01-01T00:00:56.000+08:00|          154.0|</span>
<span class="line">|2020-01-01T00:00:58.000+08:00|          156.0|</span>
<span class="line">|2020-01-01T00:01:00.000+08:00|          158.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> consistency<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&quot;window&quot;</span><span class="token operator">=</span><span class="token string">&quot;15&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">01</span>:<span class="token number">00</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------------------------+</span>
<span class="line">|                         Time|consistency(root.test.d1.s1, &quot;window&quot;=&quot;15&quot;)|</span>
<span class="line">+-----------------------------+-------------------------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|                         0.9333333333333333|</span>
<span class="line">|2020-01-01T00:00:32.000+08:00|                                        1.0|</span>
<span class="line">+-----------------------------+-------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="timeliness" tabindex="-1"><a class="header-anchor" href="#timeliness"><span>Timeliness</span></a></h3><h4 id="注册语句-2" tabindex="-1"><a class="header-anchor" href="#注册语句-2"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> timeliness <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dquality.UDTFTimeliness&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-2" tabindex="-1"><a class="header-anchor" href="#函数简介-2"><span>函数简介</span></a></h4><p>本函数用于计算时间序列的时效性。将输入序列划分为若干个连续且不重叠的窗口，分别计算每一个窗口的时效性，并输出窗口第一个数据点的时间戳和窗口的时效性。</p><p><strong>函数名：</strong> TIMELINESS</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>window</code>：窗口大小，它是一个大于0的整数或者一个有单位的正数。前者代表每一个窗口包含的数据点数目，最后一个窗口的数据点数目可能会不足；后者代表窗口的时间跨度，目前支持五种单位，分别是 &#39;ms&#39;（毫秒）、&#39;s&#39;（秒）、&#39;m&#39;（分钟）、&#39;h&#39;（小时）和&#39;d&#39;（天）。缺省情况下，全部输入数据都属于同一个窗口。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为DOUBLE，其中每一个数据点的值的范围都是 [0,1].</p><p><strong>提示：</strong> 只有当窗口内的数据点数目超过10时，才会进行时效性计算。否则，该窗口将被忽略，不做任何输出。</p><h4 id="使用示例-2" tabindex="-1"><a class="header-anchor" href="#使用示例-2"><span>使用示例</span></a></h4><h5 id="参数缺省-2" tabindex="-1"><a class="header-anchor" href="#参数缺省-2"><span>参数缺省</span></a></h5><p>在参数缺省的情况下，本函数将会把全部输入数据都作为同一个窗口计算时效性。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|          101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|          112.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|          118.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          120.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|          124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|            NaN|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> timeliness<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">30</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------------------+</span>
<span class="line">|                         Time|timeliness(root.test.d1.s1)|</span>
<span class="line">+-----------------------------+---------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|         0.9333333333333333|</span>
<span class="line">+-----------------------------+---------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="指定窗口大小-2" tabindex="-1"><a class="header-anchor" href="#指定窗口大小-2"><span>指定窗口大小</span></a></h5><p>在指定窗口大小的情况下，本函数会把输入数据划分为若干个窗口计算时效性。</p><p>输入序列:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|          101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|          112.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|          118.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          120.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|          124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|            NaN|</span>
<span class="line">|2020-01-01T00:00:32.000+08:00|          130.0|</span>
<span class="line">|2020-01-01T00:00:34.000+08:00|          132.0|</span>
<span class="line">|2020-01-01T00:00:36.000+08:00|          134.0|</span>
<span class="line">|2020-01-01T00:00:38.000+08:00|          136.0|</span>
<span class="line">|2020-01-01T00:00:40.000+08:00|          138.0|</span>
<span class="line">|2020-01-01T00:00:42.000+08:00|          140.0|</span>
<span class="line">|2020-01-01T00:00:44.000+08:00|          142.0|</span>
<span class="line">|2020-01-01T00:00:46.000+08:00|          144.0|</span>
<span class="line">|2020-01-01T00:00:48.000+08:00|          146.0|</span>
<span class="line">|2020-01-01T00:00:50.000+08:00|          148.0|</span>
<span class="line">|2020-01-01T00:00:52.000+08:00|          150.0|</span>
<span class="line">|2020-01-01T00:00:54.000+08:00|          152.0|</span>
<span class="line">|2020-01-01T00:00:56.000+08:00|          154.0|</span>
<span class="line">|2020-01-01T00:00:58.000+08:00|          156.0|</span>
<span class="line">|2020-01-01T00:01:00.000+08:00|          158.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> timeliness<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&quot;window&quot;</span><span class="token operator">=</span><span class="token string">&quot;15&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">01</span>:<span class="token number">00</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------------------------------------+</span>
<span class="line">|                         Time|timeliness(root.test.d1.s1, &quot;window&quot;=&quot;15&quot;)|</span>
<span class="line">+-----------------------------+------------------------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|                        0.9333333333333333|</span>
<span class="line">|2020-01-01T00:00:32.000+08:00|                                       1.0|</span>
<span class="line">+-----------------------------+------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="validity" tabindex="-1"><a class="header-anchor" href="#validity"><span>Validity</span></a></h3><h4 id="注册语句-3" tabindex="-1"><a class="header-anchor" href="#注册语句-3"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> validity <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dquality.UDTFValidity&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-3" tabindex="-1"><a class="header-anchor" href="#函数简介-3"><span>函数简介</span></a></h4><p>本函数用于计算时间序列的有效性。将输入序列划分为若干个连续且不重叠的窗口，分别计算每一个窗口的有效性，并输出窗口第一个数据点的时间戳和窗口的有效性。</p><p><strong>函数名：</strong> VALIDITY</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>window</code>：窗口大小，它是一个大于0的整数或者一个有单位的正数。前者代表每一个窗口包含的数据点数目，最后一个窗口的数据点数目可能会不足；后者代表窗口的时间跨度，目前支持五种单位，分别是 &#39;ms&#39;（毫秒）、&#39;s&#39;（秒）、&#39;m&#39;（分钟）、&#39;h&#39;（小时）和&#39;d&#39;（天）。缺省情况下，全部输入数据都属于同一个窗口。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为DOUBLE，其中每一个数据点的值的范围都是 [0,1].</p><p><strong>提示：</strong> 只有当窗口内的数据点数目超过10时，才会进行有效性计算。否则，该窗口将被忽略，不做任何输出。</p><h4 id="使用示例-3" tabindex="-1"><a class="header-anchor" href="#使用示例-3"><span>使用示例</span></a></h4><h5 id="参数缺省-3" tabindex="-1"><a class="header-anchor" href="#参数缺省-3"><span>参数缺省</span></a></h5><p>在参数缺省的情况下，本函数将会把全部输入数据都作为同一个窗口计算有效性。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|          101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|          112.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|          118.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          120.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|          124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|            NaN|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> validity<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">30</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------+</span>
<span class="line">|                         Time|validity(root.test.d1.s1)|</span>
<span class="line">+-----------------------------+-------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|       0.8833333333333333|</span>
<span class="line">+-----------------------------+-------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="指定窗口大小-3" tabindex="-1"><a class="header-anchor" href="#指定窗口大小-3"><span>指定窗口大小</span></a></h5><p>在指定窗口大小的情况下，本函数会把输入数据划分为若干个窗口计算有效性。</p><p>输入序列:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|          101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|          112.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|          118.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          120.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|          124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|            NaN|</span>
<span class="line">|2020-01-01T00:00:32.000+08:00|          130.0|</span>
<span class="line">|2020-01-01T00:00:34.000+08:00|          132.0|</span>
<span class="line">|2020-01-01T00:00:36.000+08:00|          134.0|</span>
<span class="line">|2020-01-01T00:00:38.000+08:00|          136.0|</span>
<span class="line">|2020-01-01T00:00:40.000+08:00|          138.0|</span>
<span class="line">|2020-01-01T00:00:42.000+08:00|          140.0|</span>
<span class="line">|2020-01-01T00:00:44.000+08:00|          142.0|</span>
<span class="line">|2020-01-01T00:00:46.000+08:00|          144.0|</span>
<span class="line">|2020-01-01T00:00:48.000+08:00|          146.0|</span>
<span class="line">|2020-01-01T00:00:50.000+08:00|          148.0|</span>
<span class="line">|2020-01-01T00:00:52.000+08:00|          150.0|</span>
<span class="line">|2020-01-01T00:00:54.000+08:00|          152.0|</span>
<span class="line">|2020-01-01T00:00:56.000+08:00|          154.0|</span>
<span class="line">|2020-01-01T00:00:58.000+08:00|          156.0|</span>
<span class="line">|2020-01-01T00:01:00.000+08:00|          158.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> validity<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&quot;window&quot;</span><span class="token operator">=</span><span class="token string">&quot;15&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">01</span>:<span class="token number">00</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+----------------------------------------+</span>
<span class="line">|                         Time|validity(root.test.d1.s1, &quot;window&quot;=&quot;15&quot;)|</span>
<span class="line">+-----------------------------+----------------------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|                      0.8833333333333333|</span>
<span class="line">|2020-01-01T00:00:32.000+08:00|                                     1.0|</span>
<span class="line">+-----------------------------+----------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="数据画像" tabindex="-1"><a class="header-anchor" href="#数据画像"><span>数据画像</span></a></h2><h3 id="acf" tabindex="-1"><a class="header-anchor" href="#acf"><span>ACF</span></a></h3><h4 id="注册语句-4" tabindex="-1"><a class="header-anchor" href="#注册语句-4"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> acf <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDTFACF&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-4" tabindex="-1"><a class="header-anchor" href="#函数简介-4"><span>函数简介</span></a></h4><p>本函数用于计算时间序列的自相关函数值，即序列与自身之间的互相关函数。</p><p><strong>函数名：</strong> ACF</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>输出序列：</strong> 输出单个序列，类型为 DOUBLE。序列中共包含<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>N</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2N-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>个数据点。</p><p><strong>提示：</strong></p><ul><li>序列中的<code>NaN</code>值会被忽略，在计算中表现为0。</li></ul><h4 id="使用示例-4" tabindex="-1"><a class="header-anchor" href="#使用示例-4"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:01.000+08:00|              1|</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|            NaN|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|              3|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|            NaN|</span>
<span class="line">|2020-01-01T00:00:05.000+08:00|              5|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> acf<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">05</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------+</span>
<span class="line">|                         Time|acf(root.test.d1.s1)|</span>
<span class="line">+-----------------------------+--------------------+</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|                 1.0|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|                 0.0|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00|                 3.6|</span>
<span class="line">|1970-01-01T08:00:00.004+08:00|                 0.0|</span>
<span class="line">|1970-01-01T08:00:00.005+08:00|                 7.0|</span>
<span class="line">|1970-01-01T08:00:00.006+08:00|                 0.0|</span>
<span class="line">|1970-01-01T08:00:00.007+08:00|                 3.6|</span>
<span class="line">|1970-01-01T08:00:00.008+08:00|                 0.0|</span>
<span class="line">|1970-01-01T08:00:00.009+08:00|                 1.0|</span>
<span class="line">+-----------------------------+--------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="distinct" tabindex="-1"><a class="header-anchor" href="#distinct"><span>Distinct</span></a></h3><h4 id="注册语句-5" tabindex="-1"><a class="header-anchor" href="#注册语句-5"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> <span class="token keyword">distinct</span> <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDTFDistinct&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-5" tabindex="-1"><a class="header-anchor" href="#函数简介-5"><span>函数简介</span></a></h4><p>本函数可以返回输入序列中出现的所有不同的元素。</p><p><strong>函数名：</strong> DISTINCT</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型可以是任意的</p><p><strong>输出序列：</strong> 输出单个序列，类型与输入相同。</p><p><strong>提示：</strong></p><ul><li>输出序列的时间戳是无意义的。输出顺序是任意的。</li><li>缺失值和空值将被忽略，但<code>NaN</code>不会被忽略。</li><li>字符串区分大小写</li></ul><h4 id="使用示例-5" tabindex="-1"><a class="header-anchor" href="#使用示例-5"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d2.s2|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T08:00:00.001+08:00|          Hello|</span>
<span class="line">|2020-01-01T08:00:00.002+08:00|          hello|</span>
<span class="line">|2020-01-01T08:00:00.003+08:00|          Hello|</span>
<span class="line">|2020-01-01T08:00:00.004+08:00|          World|</span>
<span class="line">|2020-01-01T08:00:00.005+08:00|          World|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> <span class="token keyword">distinct</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------+</span>
<span class="line">|                         Time|distinct(root.test.d2.s2)|</span>
<span class="line">+-----------------------------+-------------------------+</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|                    Hello|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|                    hello|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00|                    World|</span>
<span class="line">+-----------------------------+-------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="histogram" tabindex="-1"><a class="header-anchor" href="#histogram"><span>Histogram</span></a></h3><h4 id="注册语句-6" tabindex="-1"><a class="header-anchor" href="#注册语句-6"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> histogram <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDTFHistogram&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-6" tabindex="-1"><a class="header-anchor" href="#函数简介-6"><span>函数简介</span></a></h4><p>本函数用于计算单列数值型数据的分布直方图。</p><p><strong>函数名：</strong> HISTOGRAM</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>min</code>：表示所求数据范围的下限，默认值为 -Double.MAX_VALUE。</li><li><code>max</code>：表示所求数据范围的上限，默认值为 Double.MAX_VALUE，<code>start</code>的值必须小于或等于<code>end</code>。</li><li><code>count</code>: 表示直方图分桶的数量，默认值为 1，其值必须为正整数。</li></ul><p><strong>输出序列：</strong> 直方图分桶的值，其中第 i 个桶（从 1 开始计数）表示的数据范围下界为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>n</mi><mo>+</mo><mo stretchy="false">(</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>⋅</mo><mfrac><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mo>−</mo><mi>m</mi><mi>i</mi><mi>n</mi></mrow><mrow><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">min+ (i-1)\cdot\frac{max-min}{count}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">min</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.2007em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8557em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight">x</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">min</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，数据范围上界为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>i</mi><mi>n</mi><mo>+</mo><mi>i</mi><mo>⋅</mo><mfrac><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mo>−</mo><mi>m</mi><mi>i</mi><mi>n</mi></mrow><mrow><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">min+ i \cdot \frac{max-min}{count}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">min</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.2007em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8557em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight">x</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">min</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。</p><p><strong>提示：</strong></p><ul><li>如果某个数据点的数值小于<code>min</code>，它会被放入第 1 个桶；如果某个数据点的数值大于<code>max</code>，它会被放入最后 1 个桶。</li><li>数据中的空值、缺失值和<code>NaN</code>将会被忽略。</li></ul><h4 id="使用示例-6" tabindex="-1"><a class="header-anchor" href="#使用示例-6"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:00.000+08:00|            1.0|</span>
<span class="line">|2020-01-01T00:00:01.000+08:00|            2.0|</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|            3.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|            4.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|            5.0|</span>
<span class="line">|2020-01-01T00:00:05.000+08:00|            6.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|            7.0|</span>
<span class="line">|2020-01-01T00:00:07.000+08:00|            8.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|            9.0|</span>
<span class="line">|2020-01-01T00:00:09.000+08:00|           10.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|           11.0|</span>
<span class="line">|2020-01-01T00:00:11.000+08:00|           12.0|</span>
<span class="line">|2020-01-01T00:00:12.000+08:00|           13.0|</span>
<span class="line">|2020-01-01T00:00:13.000+08:00|           14.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|           15.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|           16.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|           17.0|</span>
<span class="line">|2020-01-01T00:00:17.000+08:00|           18.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|           19.0|</span>
<span class="line">|2020-01-01T00:00:19.000+08:00|           20.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> histogram<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&quot;min&quot;</span><span class="token operator">=</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;max&quot;</span><span class="token operator">=</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;count&quot;</span><span class="token operator">=</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------------------------------------------------------+</span>
<span class="line">|                         Time|histogram(root.test.d1.s1, &quot;min&quot;=&quot;1&quot;, &quot;max&quot;=&quot;20&quot;, &quot;count&quot;=&quot;10&quot;)|</span>
<span class="line">+-----------------------------+---------------------------------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                                                              2|</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|                                                              2|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|                                                              2|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00|                                                              2|</span>
<span class="line">|1970-01-01T08:00:00.004+08:00|                                                              2|</span>
<span class="line">|1970-01-01T08:00:00.005+08:00|                                                              2|</span>
<span class="line">|1970-01-01T08:00:00.006+08:00|                                                              2|</span>
<span class="line">|1970-01-01T08:00:00.007+08:00|                                                              2|</span>
<span class="line">|1970-01-01T08:00:00.008+08:00|                                                              2|</span>
<span class="line">|1970-01-01T08:00:00.009+08:00|                                                              2|</span>
<span class="line">+-----------------------------+---------------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="integral" tabindex="-1"><a class="header-anchor" href="#integral"><span>Integral</span></a></h3><h4 id="注册语句-7" tabindex="-1"><a class="header-anchor" href="#注册语句-7"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> integral <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDAFIntegral&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-7" tabindex="-1"><a class="header-anchor" href="#函数简介-7"><span>函数简介</span></a></h4><p>本函数用于计算时间序列的数值积分，即以时间为横坐标、数值为纵坐标绘制的折线图中折线以下的面积。</p><p><strong>函数名：</strong> INTEGRAL</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>unit</code>：积分求解所用的时间轴单位，取值为 &quot;1S&quot;, &quot;1s&quot;, &quot;1m&quot;, &quot;1H&quot;, &quot;1d&quot;（区分大小写），分别表示以毫秒、秒、分钟、小时、天为单位计算积分。<br> 缺省情况下取 &quot;1s&quot;，以秒为单位。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为 DOUBLE，序列仅包含一个时间戳为 0、值为积分结果的数据点。</p><p><strong>提示：</strong></p><ul><li><p>积分值等于折线图中每相邻两个数据点和时间轴形成的直角梯形的面积之和，不同时间单位下相当于横轴进行不同倍数放缩，得到的积分值可直接按放缩倍数转换。</p></li><li><p>数据中<code>NaN</code>将会被忽略。折线将以临近两个有值数据点为准。</p></li></ul><h4 id="使用示例-7" tabindex="-1"><a class="header-anchor" href="#使用示例-7"><span>使用示例</span></a></h4><h5 id="参数缺省-4" tabindex="-1"><a class="header-anchor" href="#参数缺省-4"><span>参数缺省</span></a></h5><p>缺省情况下积分以1s为时间单位。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:01.000+08:00|              1|</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|              2|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|              5|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|              6|</span>
<span class="line">|2020-01-01T00:00:05.000+08:00|              7|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|              8|</span>
<span class="line">|2020-01-01T00:00:09.000+08:00|            NaN|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|             10|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> integral<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">10</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------+</span>
<span class="line">|                         Time|integral(root.test.d1.s1)|</span>
<span class="line">+-----------------------------+-------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                     57.5|</span>
<span class="line">+-----------------------------+-------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其计算公式为：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mo>×</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mo>+</mo><mn>5</mn><mo stretchy="false">)</mo><mo>×</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>5</mn><mo>+</mo><mn>6</mn><mo stretchy="false">)</mo><mo>×</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>6</mn><mo>+</mo><mn>7</mn><mo stretchy="false">)</mo><mo>×</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>7</mn><mo>+</mo><mn>8</mn><mo stretchy="false">)</mo><mo>×</mo><mn>3</mn><mo>+</mo><mo stretchy="false">(</mo><mn>8</mn><mo>+</mo><mn>10</mn><mo stretchy="false">)</mo><mo>×</mo><mn>2</mn><mo stretchy="false">]</mo><mo>=</mo><mn>57.5</mn></mrow><annotation encoding="application/x-tex"> \frac{1}{2}[(1+2)\times 1 + (2+5) \times 1 + (5+6) \times 1 + (6+7) \times 1 + (7+8) \times 3 + (8+10) \times 2] = 57.5 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">[(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">5</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">6</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">7</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">7</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">10</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">57.5</span></span></span></span></span></p><h5 id="指定时间单位" tabindex="-1"><a class="header-anchor" href="#指定时间单位"><span>指定时间单位</span></a></h5><p>指定以分钟为时间单位。</p><p>输入序列同上，用于查询的 SQL 语句如下：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> integral<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">&quot;unit&quot;</span><span class="token operator">=</span><span class="token string">&quot;1m&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">10</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------+</span>
<span class="line">|                         Time|integral(root.test.d1.s1)|</span>
<span class="line">+-----------------------------+-------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                    0.958|</span>
<span class="line">+-----------------------------+-------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其计算公式为：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><mrow><mn>2</mn><mo>×</mo><mn>60</mn></mrow></mfrac><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mo>×</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mo>+</mo><mn>3</mn><mo stretchy="false">)</mo><mo>×</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>5</mn><mo>+</mo><mn>6</mn><mo stretchy="false">)</mo><mo>×</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>6</mn><mo>+</mo><mn>7</mn><mo stretchy="false">)</mo><mo>×</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>7</mn><mo>+</mo><mn>8</mn><mo stretchy="false">)</mo><mo>×</mo><mn>3</mn><mo>+</mo><mo stretchy="false">(</mo><mn>8</mn><mo>+</mo><mn>10</mn><mo stretchy="false">)</mo><mo>×</mo><mn>2</mn><mo stretchy="false">]</mo><mo>=</mo><mn>0.958</mn></mrow><annotation encoding="application/x-tex"> \frac{1}{2\times 60}[(1+2) \times 1 + (2+3) \times 1 + (5+6) \times 1 + (6+7) \times 1 + (7+8) \times 3 + (8+10) \times 2] = 0.958 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0908em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">60</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">[(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">6</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">7</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">7</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">10</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.958</span></span></span></span></span></p><h3 id="integralavg" tabindex="-1"><a class="header-anchor" href="#integralavg"><span>IntegralAvg</span></a></h3><h4 id="注册语句-8" tabindex="-1"><a class="header-anchor" href="#注册语句-8"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> integralavg <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDAFIntegralAvg&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-8" tabindex="-1"><a class="header-anchor" href="#函数简介-8"><span>函数简介</span></a></h4><p>本函数用于计算时间序列的函数均值，即在相同时间单位下的数值积分除以序列总的时间跨度。更多关于数值积分计算的信息请参考<code>Integral</code>函数。</p><p><strong>函数名：</strong> INTEGRALAVG</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>输出序列：</strong> 输出单个序列，类型为 DOUBLE，序列仅包含一个时间戳为 0、值为时间加权平均结果的数据点。</p><p><strong>提示：</strong></p><ul><li><p>时间加权的平均值等于在任意时间单位<code>unit</code>下计算的数值积分（即折线图中每相邻两个数据点和时间轴形成的直角梯形的面积之和），<br> 除以相同时间单位下输入序列的时间跨度，其值与具体采用的时间单位无关，默认与 IoTDB 时间单位一致。</p></li><li><p>数据中的<code>NaN</code>将会被忽略。折线将以临近两个有值数据点为准。</p></li><li><p>输入序列为空时，函数输出结果为 0；仅有一个数据点时，输出结果为该点数值。</p></li></ul><h4 id="使用示例-8" tabindex="-1"><a class="header-anchor" href="#使用示例-8"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:01.000+08:00|              1|</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|              2|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|              5|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|              6|</span>
<span class="line">|2020-01-01T00:00:05.000+08:00|              7|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|              8|</span>
<span class="line">|2020-01-01T00:00:09.000+08:00|            NaN|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|             10|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> integralavg<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">10</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+----------------------------+</span>
<span class="line">|                         Time|integralavg(root.test.d1.s1)|</span>
<span class="line">+-----------------------------+----------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                        5.75|</span>
<span class="line">+-----------------------------+----------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其计算公式为：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mo>×</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mo>+</mo><mn>5</mn><mo stretchy="false">)</mo><mo>×</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>5</mn><mo>+</mo><mn>6</mn><mo stretchy="false">)</mo><mo>×</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>6</mn><mo>+</mo><mn>7</mn><mo stretchy="false">)</mo><mo>×</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>7</mn><mo>+</mo><mn>8</mn><mo stretchy="false">)</mo><mo>×</mo><mn>3</mn><mo>+</mo><mo stretchy="false">(</mo><mn>8</mn><mo>+</mo><mn>10</mn><mo stretchy="false">)</mo><mo>×</mo><mn>2</mn><mo stretchy="false">]</mo><mi mathvariant="normal">/</mi><mn>10</mn><mo>=</mo><mn>5.75</mn></mrow><annotation encoding="application/x-tex"> \frac{1}{2}[(1+2)\times 1 + (2+5) \times 1 + (5+6) \times 1 + (6+7) \times 1 + (7+8) \times 3 + (8+10) \times 2] / 10 = 5.75 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">[(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">5</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">6</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">7</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">7</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">10</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">]</span><span class="mord">/10</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5.75</span></span></span></span></span></p><h3 id="mad" tabindex="-1"><a class="header-anchor" href="#mad"><span>Mad</span></a></h3><h4 id="注册语句-9" tabindex="-1"><a class="header-anchor" href="#注册语句-9"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> mad <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDAFMad&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-9" tabindex="-1"><a class="header-anchor" href="#函数简介-9"><span>函数简介</span></a></h4><p>本函数用于计算单列数值型数据的精确或近似绝对中位差，绝对中位差为所有数值与其中位数绝对偏移量的中位数。</p><p>如有数据集<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>3</mn><mo separator="true">,</mo><mn>3</mn><mo separator="true">,</mo><mn>5</mn><mo separator="true">,</mo><mn>5</mn><mo separator="true">,</mo><mn>6</mn><mo separator="true">,</mo><mn>7</mn><mo separator="true">,</mo><mn>8</mn><mo separator="true">,</mo><mn>9</mn><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{1,3,3,5,5,6,7,8,9\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">6</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">7</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">8</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">9</span><span class="mclose">}</span></span></span></span>，其中位数为5，所有数值与中位数的偏移量的绝对值为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mn>3</mn><mo separator="true">,</mo><mn>4</mn><mo separator="true">,</mo><mn>4</mn><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{0,0,1,2,2,2,3,4,4\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">4</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">4</span><span class="mclose">}</span></span></span></span>，其中位数为2，故而原数据集的绝对中位差为2。</p><p><strong>函数名：</strong> MAD</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>error</code>：近似绝对中位差的基于数值的误差百分比，取值范围为 [0,1)，默认值为 0。如当<code>error</code>=0.01 时，记精确绝对中位差为a，近似绝对中位差为b，不等式 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.99</mn><mi>a</mi><mo>≤</mo><mi>b</mi><mo>≤</mo><mn>1.01</mn><mi>a</mi></mrow><annotation encoding="application/x-tex">0.99a \le b \le 1.01a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">0.99</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.136em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1.01</span><span class="mord mathnormal">a</span></span></span></span> 成立。当<code>error</code>=0 时，计算结果为精确绝对中位差。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为DOUBLE，序列仅包含一个时间戳为 0、值为绝对中位差的数据点。</p><p><strong>提示：</strong> 数据中的空值、缺失值和<code>NaN</code>将会被忽略。</p><h4 id="使用示例-9" tabindex="-1"><a class="header-anchor" href="#使用示例-9"><span>使用示例</span></a></h4><h5 id="精确查询" tabindex="-1"><a class="header-anchor" href="#精确查询"><span>精确查询</span></a></h5><p>当<code>error</code>参数缺省或为0时，本函数计算精确绝对中位差。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------+</span>
<span class="line">|                         Time|root.test.s1|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|        -2.0|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.600+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.700+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:01.800+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:01.900+08:00|        -2.0|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|         0.0|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line">............</span>
<span class="line">Total line number = 20</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> mad<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------------------------+</span>
<span class="line">|                         Time|median(root.test.s1, &quot;error&quot;=&quot;0&quot;)|</span>
<span class="line">+-----------------------------+---------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                              0.0|</span>
<span class="line">+-----------------------------+---------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="近似查询" tabindex="-1"><a class="header-anchor" href="#近似查询"><span>近似查询</span></a></h5><p>当<code>error</code>参数取值不为 0 时，本函数计算近似绝对中位差。</p><p>输入序列同上，用于查询的 SQL 语句如下：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> mad<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token operator">=</span><span class="token string">&quot;0.01&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------------------------+</span>
<span class="line">|                         Time|mad(root.test.s1, &quot;error&quot;=&quot;0.01&quot;)|</span>
<span class="line">+-----------------------------+---------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|               0.9900000000000001|</span>
<span class="line">+-----------------------------+---------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="median" tabindex="-1"><a class="header-anchor" href="#median"><span>Median</span></a></h3><h4 id="注册语句-10" tabindex="-1"><a class="header-anchor" href="#注册语句-10"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> median <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDAFMedian&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-10" tabindex="-1"><a class="header-anchor" href="#函数简介-10"><span>函数简介</span></a></h4><p>本函数用于计算单列数值型数据的精确或近似中位数。中位数是顺序排列的一组数据中居于中间位置的数；当序列有偶数个时，中位数为中间二者的平均数。</p><p><strong>函数名：</strong> MEDIAN</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>error</code>：近似中位数的基于排名的误差百分比，取值范围 [0,1)，默认值为 0。如当<code>error</code>=0.01 时，计算出的中位数的真实排名百分比在 0.49~0.51 之间。当<code>error</code>=0 时，计算结果为精确中位数。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为 DOUBLE，序列仅包含一个时间戳为 0、值为中位数的数据点。</p><h4 id="使用示例-10" tabindex="-1"><a class="header-anchor" href="#使用示例-10"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------+</span>
<span class="line">|                         Time|root.test.s1|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|        -2.0|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.600+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.700+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:01.800+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:01.900+08:00|        -2.0|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|         0.0|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line">Total line number = 20</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> median<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token operator">=</span><span class="token string">&quot;0.01&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------------------------------+</span>
<span class="line">|                         Time|median(root.test.s1, &quot;error&quot;=&quot;0.01&quot;)|</span>
<span class="line">+-----------------------------+------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                                 0.0|</span>
<span class="line">+-----------------------------+------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="minmax" tabindex="-1"><a class="header-anchor" href="#minmax"><span>MinMax</span></a></h3><h4 id="注册语句-11" tabindex="-1"><a class="header-anchor" href="#注册语句-11"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> minmax <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDTFMinMax&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-11" tabindex="-1"><a class="header-anchor" href="#函数简介-11"><span>函数简介</span></a></h4><p>本函数将输入序列使用 min-max 方法进行标准化。最小值归一至 0，最大值归一至 1.</p><p><strong>函数名：</strong> MINMAX</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>compute</code>：若设置为&quot;batch&quot;，则将数据全部读入后转换；若设置为 &quot;stream&quot;，则需用户提供最大值及最小值进行流式计算转换。默认为 &quot;batch&quot;。</li><li><code>min</code>：使用流式计算时的最小值。</li><li><code>max</code>：使用流式计算时的最大值。</li></ul><p><strong>输出序列</strong>：输出单个序列，类型为 DOUBLE。</p><h4 id="使用示例-11" tabindex="-1"><a class="header-anchor" href="#使用示例-11"><span>使用示例</span></a></h4><h5 id="全数据计算" tabindex="-1"><a class="header-anchor" href="#全数据计算"><span>全数据计算</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------+</span>
<span class="line">|                         Time|root.test.s1|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|        -2.0|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.600+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.700+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:01.800+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:01.900+08:00|        -2.0|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|         0.0|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> minmax<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------+</span>
<span class="line">|                         Time|minmax(root.test.s1)|</span>
<span class="line">+-----------------------------+--------------------+</span>
<span class="line">|1970-01-01T08:00:00.100+08:00| 0.16666666666666666|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00| 0.16666666666666666|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|                0.25|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00| 0.08333333333333333|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00| 0.16666666666666666|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00| 0.16666666666666666|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|                 0.0|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|  0.3333333333333333|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00| 0.16666666666666666|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00| 0.16666666666666666|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|                0.25|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00| 0.08333333333333333|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00| 0.08333333333333333|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|                0.25|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00| 0.16666666666666666|</span>
<span class="line">|1970-01-01T08:00:01.600+08:00| 0.16666666666666666|</span>
<span class="line">|1970-01-01T08:00:01.700+08:00|                 1.0|</span>
<span class="line">|1970-01-01T08:00:01.800+08:00|  0.3333333333333333|</span>
<span class="line">|1970-01-01T08:00:01.900+08:00|                 0.0|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00| 0.16666666666666666|</span>
<span class="line">+-----------------------------+--------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mvavg" tabindex="-1"><a class="header-anchor" href="#mvavg"><span>MvAvg</span></a></h3><h4 id="注册语句-12" tabindex="-1"><a class="header-anchor" href="#注册语句-12"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> mvavg <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDTFMvAvg&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-12" tabindex="-1"><a class="header-anchor" href="#函数简介-12"><span>函数简介</span></a></h4><p>本函数计算序列的移动平均。</p><p><strong>函数名：</strong> MVAVG</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>window</code>：移动窗口的长度。默认值为 10.</li></ul><p><strong>输出序列</strong>：输出单个序列，类型为 DOUBLE。</p><h4 id="使用示例-12" tabindex="-1"><a class="header-anchor" href="#使用示例-12"><span>使用示例</span></a></h4><h5 id="指定窗口长度" tabindex="-1"><a class="header-anchor" href="#指定窗口长度"><span>指定窗口长度</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------+</span>
<span class="line">|                         Time|root.test.s1|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|        -2.0|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.600+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.700+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:01.800+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:01.900+08:00|        -2.0|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|         0.0|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> mvavg<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">&quot;window&quot;</span><span class="token operator">=</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------------------------+</span>
<span class="line">|                         Time|mvavg(root.test.s1, &quot;window&quot;=&quot;3&quot;)|</span>
<span class="line">+-----------------------------+---------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|               0.3333333333333333|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|                              0.0|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|              -0.3333333333333333|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|                              0.0|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|              -0.6666666666666666|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|                              0.0|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|               0.6666666666666666|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|                              0.0|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|               0.3333333333333333|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|                              0.0|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|              -0.6666666666666666|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|                              0.0|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|               0.3333333333333333|</span>
<span class="line">|1970-01-01T08:00:01.600+08:00|                              0.0|</span>
<span class="line">|1970-01-01T08:00:01.700+08:00|               3.3333333333333335|</span>
<span class="line">|1970-01-01T08:00:01.800+08:00|                              4.0|</span>
<span class="line">|1970-01-01T08:00:01.900+08:00|                              0.0|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|              -0.6666666666666666|</span>
<span class="line">+-----------------------------+---------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="pacf" tabindex="-1"><a class="header-anchor" href="#pacf"><span>PACF</span></a></h3><h4 id="注册语句-13" tabindex="-1"><a class="header-anchor" href="#注册语句-13"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> pacf <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDTFPACF&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-13" tabindex="-1"><a class="header-anchor" href="#函数简介-13"><span>函数简介</span></a></h4><p>本函数通过求解 Yule-Walker 方程，计算序列的偏自相关系数。对于特殊的输入序列，方程可能没有解，此时输出<code>NaN</code>。</p><p><strong>函数名：</strong> PACF</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>lag</code>：最大滞后阶数。默认值为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>10</mn><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>10</mn></msub><mi>n</mi><mo separator="true">,</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\min(10\log_{10}n,n-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord">10</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.207em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>表示数据点个数。</li></ul><p><strong>输出序列</strong>：输出单个序列，类型为 DOUBLE。</p><h4 id="使用示例-13" tabindex="-1"><a class="header-anchor" href="#使用示例-13"><span>使用示例</span></a></h4><h5 id="指定滞后阶数" tabindex="-1"><a class="header-anchor" href="#指定滞后阶数"><span>指定滞后阶数</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:01.000+08:00|              1|</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|            NaN|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|              3|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|            NaN|</span>
<span class="line">|2020-01-01T00:00:05.000+08:00|              5|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> pacf<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">&quot;lag&quot;</span><span class="token operator">=</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------------------+</span>
<span class="line">|                         Time|pacf(root.test.d1.s1, &quot;lag&quot;=&quot;5&quot;)|</span>
<span class="line">+-----------------------------+--------------------------------+</span>
<span class="line">|2020-01-01T00:00:01.000+08:00|                             1.0|</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|             -0.5744680851063829|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|              0.3172297297297296|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|             -0.2977686586304181|</span>
<span class="line">|2020-01-01T00:00:05.000+08:00|             -2.0609033521065867|</span>
<span class="line">+-----------------------------+--------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="percentile" tabindex="-1"><a class="header-anchor" href="#percentile"><span>Percentile</span></a></h3><h4 id="注册语句-14" tabindex="-1"><a class="header-anchor" href="#注册语句-14"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> percentile <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDAFPercentile&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-14" tabindex="-1"><a class="header-anchor" href="#函数简介-14"><span>函数简介</span></a></h4><p>本函数用于计算单列数值型数据的精确或近似分位数。</p><p><strong>函数名：</strong> PERCENTILE</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>rank</code>：所求分位数在所有数据中的排名百分比，取值范围为 (0,1]，默认值为 0.5。如当设为 0.5时则计算中位数。</li><li><code>error</code>：近似分位数的基于排名的误差百分比，取值范围为 [0,1)，默认值为0。如<code>rank</code>=0.5 且<code>error</code>=0.01，则计算出的分位数的真实排名百分比在 0.49~0.51之间。当<code>error</code>=0 时，计算结果为精确分位数。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型与输入序列相同。当<code>error</code>=0时，序列仅包含一个时间戳为分位数第一次出现的时间戳、值为分位数的数据点；否则，输出值的时间戳为0。</p><p><strong>提示：</strong> 数据中的空值、缺失值和<code>NaN</code>将会被忽略。</p><h4 id="使用示例-14" tabindex="-1"><a class="header-anchor" href="#使用示例-14"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------+</span>
<span class="line">|                         Time|root.test2.s1|</span>
<span class="line">+-----------------------------+-------------+</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|          0.0|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|          0.0|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|          1.0|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|         -1.0|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|          0.0|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|          0.0|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|         -2.0|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|          2.0|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|          0.0|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|          0.0|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|          1.0|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|         -1.0|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|         -1.0|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|          1.0|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|          0.0|</span>
<span class="line">|1970-01-01T08:00:01.600+08:00|          0.0|</span>
<span class="line">|1970-01-01T08:00:01.700+08:00|         10.0|</span>
<span class="line">|1970-01-01T08:00:01.800+08:00|          2.0|</span>
<span class="line">|1970-01-01T08:00:01.900+08:00|         -2.0|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|          0.0|</span>
<span class="line">+-----------------------------+-------------+</span>
<span class="line">............</span>
<span class="line">Total line number = 20</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> percentile<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">&quot;rank&quot;</span><span class="token operator">=</span><span class="token string">&quot;0.2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token operator">=</span><span class="token string">&quot;0.01&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------------------------------------+</span>
<span class="line">|                         Time|percentile(root.test2.s1, &quot;rank&quot;=&quot;0.2&quot;, &quot;error&quot;=&quot;0.01&quot;)|</span>
<span class="line">+-----------------------------+-------------------------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                                                   -1.0|</span>
<span class="line">+-----------------------------+-------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="quantile" tabindex="-1"><a class="header-anchor" href="#quantile"><span>Quantile</span></a></h3><h4 id="注册语句-15" tabindex="-1"><a class="header-anchor" href="#注册语句-15"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> quantile <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDAFQuantile&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-15" tabindex="-1"><a class="header-anchor" href="#函数简介-15"><span>函数简介</span></a></h4><p>本函数用于计算单列数值型数据的近似分位数。本函数基于KLL sketch算法实现。</p><p><strong>函数名：</strong> QUANTILE</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>rank</code>：所求分位数在所有数据中的排名比，取值范围为 (0,1]，默认值为 0.5。如当设为 0.5时则计算近似中位数。</li><li><code>K</code>：允许维护的KLL sketch大小，最小值为100，默认值为800。如<code>rank</code>=0.5 且<code>K</code>=800，则计算出的分位数的真实排名比有至少99%的可能性在 0.49~0.51之间。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型与输入序列相同。输出值的时间戳为0。</p><p><strong>提示：</strong> 数据中的空值、缺失值和<code>NaN</code>将会被忽略。</p><h4 id="使用示例-15" tabindex="-1"><a class="header-anchor" href="#使用示例-15"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------+</span>
<span class="line">|                         Time|root.test1.s1|</span>
<span class="line">+-----------------------------+-------------+</span>
<span class="line">|2021-03-17T10:32:17.054+08:00|            7|</span>
<span class="line">|2021-03-17T10:32:18.054+08:00|           15|</span>
<span class="line">|2021-03-17T10:32:19.054+08:00|           36|</span>
<span class="line">|2021-03-17T10:32:20.054+08:00|           39|</span>
<span class="line">|2021-03-17T10:32:21.054+08:00|           40|</span>
<span class="line">|2021-03-17T10:32:22.054+08:00|           41|</span>
<span class="line">|2021-03-17T10:32:23.054+08:00|           20|</span>
<span class="line">|2021-03-17T10:32:24.054+08:00|           18|</span>
<span class="line">+-----------------------------+-------------+</span>
<span class="line">............</span>
<span class="line">Total line number = 8</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> quantile<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">&quot;rank&quot;</span><span class="token operator">=</span><span class="token string">&quot;0.2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;K&quot;</span><span class="token operator">=</span><span class="token string">&quot;800&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------------------------------------------+</span>
<span class="line">|                         Time|quantile(root.test1.s1, &quot;rank&quot;=&quot;0.2&quot;, &quot;K&quot;=&quot;800&quot;)|</span>
<span class="line">+-----------------------------+------------------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                               7.000000000000001|</span>
<span class="line">+-----------------------------+------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="period" tabindex="-1"><a class="header-anchor" href="#period"><span>Period</span></a></h3><h4 id="注册语句-16" tabindex="-1"><a class="header-anchor" href="#注册语句-16"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> period <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDAFPeriod&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-16" tabindex="-1"><a class="header-anchor" href="#函数简介-16"><span>函数简介</span></a></h4><p>本函数用于计算单列数值型数据的周期。</p><p><strong>函数名：</strong> PERIOD</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>输出序列：</strong> 输出单个序列，类型为 INT32，序列仅包含一个时间戳为 0、值为周期的数据点。</p><h4 id="使用示例-16" tabindex="-1"><a class="header-anchor" href="#使用示例-16"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d3.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|            1.0|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00|            3.0|</span>
<span class="line">|1970-01-01T08:00:00.004+08:00|            1.0|</span>
<span class="line">|1970-01-01T08:00:00.005+08:00|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.006+08:00|            3.0|</span>
<span class="line">|1970-01-01T08:00:00.007+08:00|            1.0|</span>
<span class="line">|1970-01-01T08:00:00.008+08:00|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.009+08:00|            3.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> period<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d3</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-----------------------+</span>
<span class="line">|                         Time|period(root.test.d3.s1)|</span>
<span class="line">+-----------------------------+-----------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                      3|</span>
<span class="line">+-----------------------------+-----------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="qlb" tabindex="-1"><a class="header-anchor" href="#qlb"><span>QLB</span></a></h3><h4 id="注册语句-17" tabindex="-1"><a class="header-anchor" href="#注册语句-17"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> qlb <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDTFQLB&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-17" tabindex="-1"><a class="header-anchor" href="#函数简介-17"><span>函数简介</span></a></h4><p>本函数对输入序列计算$Q_{LB} $统计量，并计算对应的p值。p值越小表明序列越有可能为非平稳序列。</p><p><strong>函数名：</strong> QLB</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>lag</code>：计算时用到的最大延迟阶数，取值应为 1 至 n-2 之间的整数，n 为序列采样总数。默认取 n-2。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为 DOUBLE。该序列是$Q_{LB} $统计量对应的 p 值，时间标签代表偏移阶数。</p><p><strong>提示：</strong> $Q_{LB} $统计量由自相关系数求得，如需得到统计量而非 p 值，可以使用 ACF 函数。</p><h4 id="使用示例-17" tabindex="-1"><a class="header-anchor" href="#使用示例-17"><span>使用示例</span></a></h4><h5 id="使用默认参数" tabindex="-1"><a class="header-anchor" href="#使用默认参数"><span>使用默认参数</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|1970-01-01T00:00:00.100+08:00|           1.22|</span>
<span class="line">|1970-01-01T00:00:00.200+08:00|          -2.78|</span>
<span class="line">|1970-01-01T00:00:00.300+08:00|           1.53|</span>
<span class="line">|1970-01-01T00:00:00.400+08:00|           0.70|</span>
<span class="line">|1970-01-01T00:00:00.500+08:00|           0.75|</span>
<span class="line">|1970-01-01T00:00:00.600+08:00|          -0.72|</span>
<span class="line">|1970-01-01T00:00:00.700+08:00|          -0.22|</span>
<span class="line">|1970-01-01T00:00:00.800+08:00|           0.28|</span>
<span class="line">|1970-01-01T00:00:00.900+08:00|           0.57|</span>
<span class="line">|1970-01-01T00:00:01.000+08:00|          -0.22|</span>
<span class="line">|1970-01-01T00:00:01.100+08:00|          -0.72|</span>
<span class="line">|1970-01-01T00:00:01.200+08:00|           1.34|</span>
<span class="line">|1970-01-01T00:00:01.300+08:00|          -0.25|</span>
<span class="line">|1970-01-01T00:00:01.400+08:00|           0.17|</span>
<span class="line">|1970-01-01T00:00:01.500+08:00|           2.51|</span>
<span class="line">|1970-01-01T00:00:01.600+08:00|           1.42|</span>
<span class="line">|1970-01-01T00:00:01.700+08:00|          -1.34|</span>
<span class="line">|1970-01-01T00:00:01.800+08:00|          -0.01|</span>
<span class="line">|1970-01-01T00:00:01.900+08:00|          -0.49|</span>
<span class="line">|1970-01-01T00:00:02.000+08:00|           1.63|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> QLB<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------+</span>
<span class="line">|                         Time|QLB(root.test.d1.s1)|</span>
<span class="line">+-----------------------------+--------------------+</span>
<span class="line">|1970-01-01T00:00:00.001+08:00|  0.2168702295315677|</span>
<span class="line">|1970-01-01T00:00:00.002+08:00|  0.3068948509261751|</span>
<span class="line">|1970-01-01T00:00:00.003+08:00|  0.4217859150918444|</span>
<span class="line">|1970-01-01T00:00:00.004+08:00|  0.5114539874276656|</span>
<span class="line">|1970-01-01T00:00:00.005+08:00|  0.6560619525616759|</span>
<span class="line">|1970-01-01T00:00:00.006+08:00|  0.7722398654053280|</span>
<span class="line">|1970-01-01T00:00:00.007+08:00|  0.8532491661465290|</span>
<span class="line">|1970-01-01T00:00:00.008+08:00|  0.9028575017542528|</span>
<span class="line">|1970-01-01T00:00:00.009+08:00|  0.9434989988192729|</span>
<span class="line">|1970-01-01T00:00:00.010+08:00|  0.8950280161464689|</span>
<span class="line">|1970-01-01T00:00:00.011+08:00|  0.7701048398839656|</span>
<span class="line">|1970-01-01T00:00:00.012+08:00|  0.7845536060001281|</span>
<span class="line">|1970-01-01T00:00:00.013+08:00|  0.5943030981705825|</span>
<span class="line">|1970-01-01T00:00:00.014+08:00|  0.4618413512531093|</span>
<span class="line">|1970-01-01T00:00:00.015+08:00|  0.2645948244673964|</span>
<span class="line">|1970-01-01T00:00:00.016+08:00|  0.3167530476666645|</span>
<span class="line">|1970-01-01T00:00:00.017+08:00|  0.2330010780351453|</span>
<span class="line">|1970-01-01T00:00:00.018+08:00|  0.0666611237622325|</span>
<span class="line">+-----------------------------+--------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="resample" tabindex="-1"><a class="header-anchor" href="#resample"><span>Resample</span></a></h3><h4 id="注册语句-18" tabindex="-1"><a class="header-anchor" href="#注册语句-18"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> re_sample <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDTFResample&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-18" tabindex="-1"><a class="header-anchor" href="#函数简介-18"><span>函数简介</span></a></h4><p>本函数对输入序列按照指定的频率进行重采样，包括上采样和下采样。目前，本函数支持的上采样方法包括<code>NaN</code>填充法 (NaN)、前值填充法 (FFill)、后值填充法 (BFill) 以及线性插值法 (Linear)；本函数支持的下采样方法为分组聚合，聚合方法包括最大值 (Max)、最小值 (Min)、首值 (First)、末值 (Last)、平均值 (Mean)和中位数 (Median)。</p><p><strong>函数名：</strong> RESAMPLE</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>every</code>：重采样频率，是一个有单位的正数。目前支持五种单位，分别是 &#39;ms&#39;（毫秒）、&#39;s&#39;（秒）、&#39;m&#39;（分钟）、&#39;h&#39;（小时）和&#39;d&#39;（天）。该参数不允许缺省。</li><li><code>interp</code>：上采样的插值方法，取值为 &#39;NaN&#39;、&#39;FFill&#39;、&#39;BFill&#39; 或 &#39;Linear&#39;。在缺省情况下，使用<code>NaN</code>填充法。</li><li><code>aggr</code>：下采样的聚合方法，取值为 &#39;Max&#39;、&#39;Min&#39;、&#39;First&#39;、&#39;Last&#39;、&#39;Mean&#39; 或 &#39;Median&#39;。在缺省情况下，使用平均数聚合。</li><li><code>start</code>：重采样的起始时间（包含），是一个格式为 &#39;yyyy-MM-dd HH:mm:ss&#39; 的时间字符串。在缺省情况下，使用第一个有效数据点的时间戳。</li><li><code>end</code>：重采样的结束时间（不包含），是一个格式为 &#39;yyyy-MM-dd HH:mm:ss&#39; 的时间字符串。在缺省情况下，使用最后一个有效数据点的时间戳。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为 DOUBLE。该序列按照重采样频率严格等间隔分布。</p><p><strong>提示：</strong> 数据中的<code>NaN</code>将会被忽略。</p><h4 id="使用示例-18" tabindex="-1"><a class="header-anchor" href="#使用示例-18"><span>使用示例</span></a></h4><h5 id="上采样" tabindex="-1"><a class="header-anchor" href="#上采样"><span>上采样</span></a></h5><p>当重采样频率高于数据原始频率时，将会进行上采样。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2021-03-06T16:00:00.000+08:00|           3.09|</span>
<span class="line">|2021-03-06T16:15:00.000+08:00|           3.53|</span>
<span class="line">|2021-03-06T16:30:00.000+08:00|            3.5|</span>
<span class="line">|2021-03-06T16:45:00.000+08:00|           3.51|</span>
<span class="line">|2021-03-06T17:00:00.000+08:00|           3.41|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> resample<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&#39;every&#39;</span><span class="token operator">=</span><span class="token string">&#39;5m&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;interp&#39;</span><span class="token operator">=</span><span class="token string">&#39;linear&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+----------------------------------------------------------+</span>
<span class="line">|                         Time|resample(root.test.d1.s1, &quot;every&quot;=&quot;5m&quot;, &quot;interp&quot;=&quot;linear&quot;)|</span>
<span class="line">+-----------------------------+----------------------------------------------------------+</span>
<span class="line">|2021-03-06T16:00:00.000+08:00|                                        3.0899999141693115|</span>
<span class="line">|2021-03-06T16:05:00.000+08:00|                                        3.2366665999094644|</span>
<span class="line">|2021-03-06T16:10:00.000+08:00|                                        3.3833332856496177|</span>
<span class="line">|2021-03-06T16:15:00.000+08:00|                                        3.5299999713897705|</span>
<span class="line">|2021-03-06T16:20:00.000+08:00|                                        3.5199999809265137|</span>
<span class="line">|2021-03-06T16:25:00.000+08:00|                                         3.509999990463257|</span>
<span class="line">|2021-03-06T16:30:00.000+08:00|                                                       3.5|</span>
<span class="line">|2021-03-06T16:35:00.000+08:00|                                         3.503333330154419|</span>
<span class="line">|2021-03-06T16:40:00.000+08:00|                                         3.506666660308838|</span>
<span class="line">|2021-03-06T16:45:00.000+08:00|                                         3.509999990463257|</span>
<span class="line">|2021-03-06T16:50:00.000+08:00|                                        3.4766666889190674|</span>
<span class="line">|2021-03-06T16:55:00.000+08:00|                                         3.443333387374878|</span>
<span class="line">|2021-03-06T17:00:00.000+08:00|                                        3.4100000858306885|</span>
<span class="line">+-----------------------------+----------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="下采样" tabindex="-1"><a class="header-anchor" href="#下采样"><span>下采样</span></a></h5><p>当重采样频率低于数据原始频率时，将会进行下采样。</p><p>输入序列同上，用于查询的 SQL 语句如下：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> resample<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&#39;every&#39;</span><span class="token operator">=</span><span class="token string">&#39;30m&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;aggr&#39;</span><span class="token operator">=</span><span class="token string">&#39;first&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------------------------------------------+</span>
<span class="line">|                         Time|resample(root.test.d1.s1, &quot;every&quot;=&quot;30m&quot;, &quot;aggr&quot;=&quot;first&quot;)|</span>
<span class="line">+-----------------------------+--------------------------------------------------------+</span>
<span class="line">|2021-03-06T16:00:00.000+08:00|                                      3.0899999141693115|</span>
<span class="line">|2021-03-06T16:30:00.000+08:00|                                                     3.5|</span>
<span class="line">|2021-03-06T17:00:00.000+08:00|                                      3.4100000858306885|</span>
<span class="line">+-----------------------------+--------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="指定重采样时间段" tabindex="-1"><a class="header-anchor" href="#指定重采样时间段"><span>指定重采样时间段</span></a></h6><p>可以使用<code>start</code>和<code>end</code>两个参数指定重采样的时间段，超出实际时间范围的部分会被插值填补。</p><p>输入序列同上，用于查询的 SQL 语句如下：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> resample<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&#39;every&#39;</span><span class="token operator">=</span><span class="token string">&#39;30m&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;start&#39;</span><span class="token operator">=</span><span class="token string">&#39;2021-03-06 15:00:00&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-----------------------------------------------------------------------+</span>
<span class="line">|                         Time|resample(root.test.d1.s1, &quot;every&quot;=&quot;30m&quot;, &quot;start&quot;=&quot;2021-03-06 15:00:00&quot;)|</span>
<span class="line">+-----------------------------+-----------------------------------------------------------------------+</span>
<span class="line">|2021-03-06T15:00:00.000+08:00|                                                                    NaN|</span>
<span class="line">|2021-03-06T15:30:00.000+08:00|                                                                    NaN|</span>
<span class="line">|2021-03-06T16:00:00.000+08:00|                                                      3.309999942779541|</span>
<span class="line">|2021-03-06T16:30:00.000+08:00|                                                     3.5049999952316284|</span>
<span class="line">|2021-03-06T17:00:00.000+08:00|                                                     3.4100000858306885|</span>
<span class="line">+-----------------------------+-----------------------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sample" tabindex="-1"><a class="header-anchor" href="#sample"><span>Sample</span></a></h3><h4 id="注册语句-19" tabindex="-1"><a class="header-anchor" href="#注册语句-19"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> sample <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDTFSample&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-19" tabindex="-1"><a class="header-anchor" href="#函数简介-19"><span>函数简介</span></a></h4><p>本函数对输入序列进行采样，即从输入序列中选取指定数量的数据点并输出。目前，本函数支持三种采样方法：<strong>蓄水池采样法 (reservoir sampling)</strong> 对数据进行随机采样，所有数据点被采样的概率相同；<strong>等距采样法 (isometric sampling)</strong> 按照相等的索引间隔对数据进行采样，<strong>最大三角采样法 (triangle sampling)</strong> 对所有数据会按采样率分桶，每个桶内会计算数据点间三角形面积，并保留面积最大的点，该算法通常用于数据的可视化展示中，采用过程可以保证一些关键的突变点在采用中得到保留，更多抽样算法细节可以阅读论文 <a href="http://skemman.is/stream/get/1946/15343/37285/3/SS_MSthesis.pdf" target="_blank" rel="noopener noreferrer">here</a>。</p><p><strong>函数名：</strong> SAMPLE</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型可以是任意的。</p><p><strong>参数：</strong></p><ul><li><code>method</code>：采样方法，取值为 &#39;reservoir&#39;，&#39;isometric&#39; 或 &#39;triangle&#39; 。在缺省情况下，采用蓄水池采样法。</li><li><code>k</code>：采样数，它是一个正整数，在缺省情况下为 1。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型与输入序列相同。该序列的长度为采样数，序列中的每一个数据点都来自于输入序列。</p><p><strong>提示：</strong> 如果采样数大于序列长度，那么输入序列中所有的数据点都会被输出。</p><h4 id="使用示例-19" tabindex="-1"><a class="header-anchor" href="#使用示例-19"><span>使用示例</span></a></h4><h5 id="蓄水池采样" tabindex="-1"><a class="header-anchor" href="#蓄水池采样"><span>蓄水池采样</span></a></h5><p>当<code>method</code>参数为 &#39;reservoir&#39; 或缺省时，采用蓄水池采样法对输入序列进行采样。由于该采样方法具有随机性，下面展示的输出序列只是一种可能的结果。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:01.000+08:00|            1.0|</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|            2.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|            3.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|            4.0|</span>
<span class="line">|2020-01-01T00:00:05.000+08:00|            5.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|            6.0|</span>
<span class="line">|2020-01-01T00:00:07.000+08:00|            7.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|            8.0|</span>
<span class="line">|2020-01-01T00:00:09.000+08:00|            9.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|           10.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> sample<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&#39;method&#39;</span><span class="token operator">=</span><span class="token string">&#39;reservoir&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;k&#39;</span><span class="token operator">=</span><span class="token string">&#39;5&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------------------------------------------------+</span>
<span class="line">|                         Time|sample(root.test.d1.s1, &quot;method&quot;=&quot;reservoir&quot;, &quot;k&quot;=&quot;5&quot;)|</span>
<span class="line">+-----------------------------+------------------------------------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|                                                   2.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|                                                   3.0|</span>
<span class="line">|2020-01-01T00:00:05.000+08:00|                                                   5.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|                                                   8.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|                                                  10.0|</span>
<span class="line">+-----------------------------+------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="等距采样" tabindex="-1"><a class="header-anchor" href="#等距采样"><span>等距采样</span></a></h5><p>当<code>method</code>参数为 &#39;isometric&#39; 时，采用等距采样法对输入序列进行采样。</p><p>输入序列同上，用于查询的 SQL 语句如下：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> sample<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&#39;method&#39;</span><span class="token operator">=</span><span class="token string">&#39;isometric&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;k&#39;</span><span class="token operator">=</span><span class="token string">&#39;5&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------------------------------------------------+</span>
<span class="line">|                         Time|sample(root.test.d1.s1, &quot;method&quot;=&quot;isometric&quot;, &quot;k&quot;=&quot;5&quot;)|</span>
<span class="line">+-----------------------------+------------------------------------------------------+</span>
<span class="line">|2020-01-01T00:00:01.000+08:00|                                                   1.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|                                                   3.0|</span>
<span class="line">|2020-01-01T00:00:05.000+08:00|                                                   5.0|</span>
<span class="line">|2020-01-01T00:00:07.000+08:00|                                                   7.0|</span>
<span class="line">|2020-01-01T00:00:09.000+08:00|                                                   9.0|</span>
<span class="line">+-----------------------------+------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="segment" tabindex="-1"><a class="header-anchor" href="#segment"><span>Segment</span></a></h3><h4 id="注册语句-20" tabindex="-1"><a class="header-anchor" href="#注册语句-20"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> segment <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDTFSegment&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-20" tabindex="-1"><a class="header-anchor" href="#函数简介-20"><span>函数简介</span></a></h4><p>本函数按照数据的线性变化趋势将数据划分为多个子序列，返回分段直线拟合后的子序列首值或所有拟合值。</p><p><strong>函数名：</strong> SEGMENT</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><p><code>output</code>：&quot;all&quot; 输出所有拟合值；&quot;first&quot; 输出子序列起点拟合值。默认为 &quot;first&quot;。</p></li><li><p><code>error</code>：判定存在线性趋势的误差允许阈值。误差的定义为子序列进行线性拟合的误差的绝对值的均值。默认为 0.1.</p></li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为 DOUBLE。</p><p><strong>提示：</strong> 函数默认所有数据等时间间隔分布。函数读取所有数据，若原始数据过多，请先进行降采样处理。拟合采用自底向上方法，子序列的尾值可能会被认作子序列首值输出。</p><h4 id="使用示例-20" tabindex="-1"><a class="header-anchor" href="#使用示例-20"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------+</span>
<span class="line">|                         Time|root.test.s1|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|         5.0|</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|         3.0|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|         4.0|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|         5.0|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|         6.0|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|         7.0|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|         8.0|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|         9.0|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|         9.1|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|         9.2|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|         9.3|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|         9.4|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|         9.5|</span>
<span class="line">|1970-01-01T08:00:01.600+08:00|         9.6|</span>
<span class="line">|1970-01-01T08:00:01.700+08:00|         9.7|</span>
<span class="line">|1970-01-01T08:00:01.800+08:00|         9.8|</span>
<span class="line">|1970-01-01T08:00:01.900+08:00|         9.9|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:02.100+08:00|         8.0|</span>
<span class="line">|1970-01-01T08:00:02.200+08:00|         6.0|</span>
<span class="line">|1970-01-01T08:00:02.300+08:00|         4.0|</span>
<span class="line">|1970-01-01T08:00:02.400+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:02.500+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:02.600+08:00|        -2.0|</span>
<span class="line">|1970-01-01T08:00:02.700+08:00|        -4.0|</span>
<span class="line">|1970-01-01T08:00:02.800+08:00|        -6.0|</span>
<span class="line">|1970-01-01T08:00:02.900+08:00|        -8.0|</span>
<span class="line">|1970-01-01T08:00:03.000+08:00|       -10.0|</span>
<span class="line">|1970-01-01T08:00:03.100+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:03.200+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:03.300+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:03.400+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:03.500+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:03.600+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:03.700+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:03.800+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:03.900+08:00|        10.0|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> segment<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&quot;error&quot;</span><span class="token operator">=</span><span class="token string">&quot;0.1&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------------------------------+</span>
<span class="line">|                         Time|segment(root.test.s1, &quot;error&quot;=&quot;0.1&quot;)|</span>
<span class="line">+-----------------------------+------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                                 5.0|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|                                 1.0|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|                                 9.0|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|                                10.0|</span>
<span class="line">|1970-01-01T08:00:03.000+08:00|                               -10.0|</span>
<span class="line">|1970-01-01T08:00:03.200+08:00|                                10.0|</span>
<span class="line">+-----------------------------+------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="skew" tabindex="-1"><a class="header-anchor" href="#skew"><span>Skew</span></a></h3><h4 id="注册语句-21" tabindex="-1"><a class="header-anchor" href="#注册语句-21"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> skew <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDAFSkew&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-21" tabindex="-1"><a class="header-anchor" href="#函数简介-21"><span>函数简介</span></a></h4><p>本函数用于计算单列数值型数据的总体偏度</p><p><strong>函数名：</strong> SKEW</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>输出序列：</strong> 输出单个序列，类型为 DOUBLE，序列仅包含一个时间戳为 0、值为总体偏度的数据点。</p><p><strong>提示：</strong> 数据中的空值、缺失值和<code>NaN</code>将会被忽略。</p><h4 id="使用示例-21" tabindex="-1"><a class="header-anchor" href="#使用示例-21"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:00.000+08:00|            1.0|</span>
<span class="line">|2020-01-01T00:00:01.000+08:00|            2.0|</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|            3.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|            4.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|            5.0|</span>
<span class="line">|2020-01-01T00:00:05.000+08:00|            6.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|            7.0|</span>
<span class="line">|2020-01-01T00:00:07.000+08:00|            8.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|            9.0|</span>
<span class="line">|2020-01-01T00:00:09.000+08:00|           10.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|           10.0|</span>
<span class="line">|2020-01-01T00:00:11.000+08:00|           10.0|</span>
<span class="line">|2020-01-01T00:00:12.000+08:00|           10.0|</span>
<span class="line">|2020-01-01T00:00:13.000+08:00|           10.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|           10.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|           10.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|           10.0|</span>
<span class="line">|2020-01-01T00:00:17.000+08:00|           10.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|           10.0|</span>
<span class="line">|2020-01-01T00:00:19.000+08:00|           10.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> skew<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-----------------------+</span>
<span class="line">|                         Time|  skew(root.test.d1.s1)|</span>
<span class="line">+-----------------------------+-----------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|    -0.9998427402292644|</span>
<span class="line">+-----------------------------+-----------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="spline" tabindex="-1"><a class="header-anchor" href="#spline"><span>Spline</span></a></h3><h4 id="注册语句-22" tabindex="-1"><a class="header-anchor" href="#注册语句-22"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> spline <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDTFSpline&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-22" tabindex="-1"><a class="header-anchor" href="#函数简介-22"><span>函数简介</span></a></h4><p>本函数提供对原始序列进行三次样条曲线拟合后的插值重采样。</p><p><strong>函数名：</strong> SPLINE</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>points</code>：重采样个数。</li></ul><p><strong>输出序列</strong>：输出单个序列，类型为 DOUBLE。</p><p><strong>提示</strong>：输出序列保留输入序列的首尾值，等时间间隔采样。仅当输入点个数不少于 4 个时才计算插值。</p><h4 id="使用示例-22" tabindex="-1"><a class="header-anchor" href="#使用示例-22"><span>使用示例</span></a></h4><h5 id="指定插值个数" tabindex="-1"><a class="header-anchor" href="#指定插值个数"><span>指定插值个数</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------+</span>
<span class="line">|                         Time|root.test.s1|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|         1.2|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|         1.7|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|         2.1|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|         1.8|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|         1.2|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|         1.6|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> spline<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">&quot;points&quot;</span><span class="token operator">=</span><span class="token string">&quot;151&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------------------------------+</span>
<span class="line">|                         Time|spline(root.test.s1, &quot;points&quot;=&quot;151&quot;)|</span>
<span class="line">+-----------------------------+------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                                 0.0|</span>
<span class="line">|1970-01-01T08:00:00.010+08:00|                 0.04870000251134237|</span>
<span class="line">|1970-01-01T08:00:00.020+08:00|                 0.09680000495910646|</span>
<span class="line">|1970-01-01T08:00:00.030+08:00|                 0.14430000734329226|</span>
<span class="line">|1970-01-01T08:00:00.040+08:00|                 0.19120000966389972|</span>
<span class="line">|1970-01-01T08:00:00.050+08:00|                 0.23750001192092896|</span>
<span class="line">|1970-01-01T08:00:00.060+08:00|                  0.2832000141143799|</span>
<span class="line">|1970-01-01T08:00:00.070+08:00|                 0.32830001624425253|</span>
<span class="line">|1970-01-01T08:00:00.080+08:00|                  0.3728000183105469|</span>
<span class="line">|1970-01-01T08:00:00.090+08:00|                   0.416700020313263|</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|                  0.4600000222524008|</span>
<span class="line">|1970-01-01T08:00:00.110+08:00|                  0.5027000241279602|</span>
<span class="line">|1970-01-01T08:00:00.120+08:00|                  0.5448000259399414|</span>
<span class="line">|1970-01-01T08:00:00.130+08:00|                  0.5863000276883443|</span>
<span class="line">|1970-01-01T08:00:00.140+08:00|                   0.627200029373169|</span>
<span class="line">|1970-01-01T08:00:00.150+08:00|                  0.6675000309944153|</span>
<span class="line">|1970-01-01T08:00:00.160+08:00|                  0.7072000325520833|</span>
<span class="line">|1970-01-01T08:00:00.170+08:00|                  0.7463000340461731|</span>
<span class="line">|1970-01-01T08:00:00.180+08:00|                  0.7848000354766846|</span>
<span class="line">|1970-01-01T08:00:00.190+08:00|                  0.8227000368436178|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|                  0.8600000381469728|</span>
<span class="line">|1970-01-01T08:00:00.210+08:00|                  0.8967000393867494|</span>
<span class="line">|1970-01-01T08:00:00.220+08:00|                  0.9328000405629477|</span>
<span class="line">|1970-01-01T08:00:00.230+08:00|                  0.9683000416755676|</span>
<span class="line">|1970-01-01T08:00:00.240+08:00|                  1.0032000427246095|</span>
<span class="line">|1970-01-01T08:00:00.250+08:00|                   1.037500043710073|</span>
<span class="line">|1970-01-01T08:00:00.260+08:00|                   1.071200044631958|</span>
<span class="line">|1970-01-01T08:00:00.270+08:00|                  1.1043000454902647|</span>
<span class="line">|1970-01-01T08:00:00.280+08:00|                  1.1368000462849934|</span>
<span class="line">|1970-01-01T08:00:00.290+08:00|                  1.1687000470161437|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|                  1.2000000476837158|</span>
<span class="line">|1970-01-01T08:00:00.310+08:00|                  1.2307000483103594|</span>
<span class="line">|1970-01-01T08:00:00.320+08:00|                  1.2608000489139557|</span>
<span class="line">|1970-01-01T08:00:00.330+08:00|                  1.2903000494873524|</span>
<span class="line">|1970-01-01T08:00:00.340+08:00|                  1.3192000500233967|</span>
<span class="line">|1970-01-01T08:00:00.350+08:00|                  1.3475000505149364|</span>
<span class="line">|1970-01-01T08:00:00.360+08:00|                  1.3752000509548186|</span>
<span class="line">|1970-01-01T08:00:00.370+08:00|                   1.402300051335891|</span>
<span class="line">|1970-01-01T08:00:00.380+08:00|                  1.4288000516510009|</span>
<span class="line">|1970-01-01T08:00:00.390+08:00|                  1.4547000518929958|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|                   1.480000052054723|</span>
<span class="line">|1970-01-01T08:00:00.410+08:00|                  1.5047000521290301|</span>
<span class="line">|1970-01-01T08:00:00.420+08:00|                  1.5288000521087646|</span>
<span class="line">|1970-01-01T08:00:00.430+08:00|                  1.5523000519867738|</span>
<span class="line">|1970-01-01T08:00:00.440+08:00|                   1.575200051755905|</span>
<span class="line">|1970-01-01T08:00:00.450+08:00|                   1.597500051409006|</span>
<span class="line">|1970-01-01T08:00:00.460+08:00|                   1.619200050938924|</span>
<span class="line">|1970-01-01T08:00:00.470+08:00|                  1.6403000503385066|</span>
<span class="line">|1970-01-01T08:00:00.480+08:00|                   1.660800049600601|</span>
<span class="line">|1970-01-01T08:00:00.490+08:00|                   1.680700048718055|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|                  1.7000000476837158|</span>
<span class="line">|1970-01-01T08:00:00.510+08:00|                  1.7188475466453037|</span>
<span class="line">|1970-01-01T08:00:00.520+08:00|                  1.7373800457262996|</span>
<span class="line">|1970-01-01T08:00:00.530+08:00|                  1.7555825448831923|</span>
<span class="line">|1970-01-01T08:00:00.540+08:00|                  1.7734400440724702|</span>
<span class="line">|1970-01-01T08:00:00.550+08:00|                   1.790937543250622|</span>
<span class="line">|1970-01-01T08:00:00.560+08:00|                  1.8080600423741364|</span>
<span class="line">|1970-01-01T08:00:00.570+08:00|                  1.8247925413995016|</span>
<span class="line">|1970-01-01T08:00:00.580+08:00|                  1.8411200402832066|</span>
<span class="line">|1970-01-01T08:00:00.590+08:00|                  1.8570275389817397|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|                  1.8725000374515897|</span>
<span class="line">|1970-01-01T08:00:00.610+08:00|                  1.8875225356492449|</span>
<span class="line">|1970-01-01T08:00:00.620+08:00|                   1.902080033531194|</span>
<span class="line">|1970-01-01T08:00:00.630+08:00|                  1.9161575310539258|</span>
<span class="line">|1970-01-01T08:00:00.640+08:00|                  1.9297400281739288|</span>
<span class="line">|1970-01-01T08:00:00.650+08:00|                  1.9428125248476913|</span>
<span class="line">|1970-01-01T08:00:00.660+08:00|                  1.9553600210317021|</span>
<span class="line">|1970-01-01T08:00:00.670+08:00|                    1.96736751668245|</span>
<span class="line">|1970-01-01T08:00:00.680+08:00|                  1.9788200117564232|</span>
<span class="line">|1970-01-01T08:00:00.690+08:00|                  1.9897025062101101|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|                                 2.0|</span>
<span class="line">|1970-01-01T08:00:00.710+08:00|                  2.0097024933913334|</span>
<span class="line">|1970-01-01T08:00:00.720+08:00|                  2.0188199867081615|</span>
<span class="line">|1970-01-01T08:00:00.730+08:00|                   2.027367479995188|</span>
<span class="line">|1970-01-01T08:00:00.740+08:00|                  2.0353599732971155|</span>
<span class="line">|1970-01-01T08:00:00.750+08:00|                  2.0428124666586482|</span>
<span class="line">|1970-01-01T08:00:00.760+08:00|                   2.049739960124489|</span>
<span class="line">|1970-01-01T08:00:00.770+08:00|                   2.056157453739342|</span>
<span class="line">|1970-01-01T08:00:00.780+08:00|                    2.06207994754791|</span>
<span class="line">|1970-01-01T08:00:00.790+08:00|                   2.067522441594897|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|                   2.072499935925006|</span>
<span class="line">|1970-01-01T08:00:00.810+08:00|                    2.07702743058294|</span>
<span class="line">|1970-01-01T08:00:00.820+08:00|                   2.081119925613404|</span>
<span class="line">|1970-01-01T08:00:00.830+08:00|                     2.0847924210611|</span>
<span class="line">|1970-01-01T08:00:00.840+08:00|                  2.0880599169707317|</span>
<span class="line">|1970-01-01T08:00:00.850+08:00|                  2.0909374133870027|</span>
<span class="line">|1970-01-01T08:00:00.860+08:00|                  2.0934399103546166|</span>
<span class="line">|1970-01-01T08:00:00.870+08:00|                  2.0955824079182768|</span>
<span class="line">|1970-01-01T08:00:00.880+08:00|                  2.0973799061226863|</span>
<span class="line">|1970-01-01T08:00:00.890+08:00|                   2.098847405012549|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|                  2.0999999046325684|</span>
<span class="line">|1970-01-01T08:00:00.910+08:00|                  2.1005574051201332|</span>
<span class="line">|1970-01-01T08:00:00.920+08:00|                  2.1002599065303778|</span>
<span class="line">|1970-01-01T08:00:00.930+08:00|                  2.0991524087846245|</span>
<span class="line">|1970-01-01T08:00:00.940+08:00|                  2.0972799118041947|</span>
<span class="line">|1970-01-01T08:00:00.950+08:00|                  2.0946874155104105|</span>
<span class="line">|1970-01-01T08:00:00.960+08:00|                  2.0914199198245944|</span>
<span class="line">|1970-01-01T08:00:00.970+08:00|                  2.0875224246680673|</span>
<span class="line">|1970-01-01T08:00:00.980+08:00|                   2.083039929962151|</span>
<span class="line">|1970-01-01T08:00:00.990+08:00|                  2.0780174356281687|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|                  2.0724999415874406|</span>
<span class="line">|1970-01-01T08:00:01.010+08:00|                    2.06653244776129|</span>
<span class="line">|1970-01-01T08:00:01.020+08:00|                   2.060159954071038|</span>
<span class="line">|1970-01-01T08:00:01.030+08:00|                   2.053427460438006|</span>
<span class="line">|1970-01-01T08:00:01.040+08:00|                   2.046379966783517|</span>
<span class="line">|1970-01-01T08:00:01.050+08:00|                  2.0390624730288924|</span>
<span class="line">|1970-01-01T08:00:01.060+08:00|                   2.031519979095454|</span>
<span class="line">|1970-01-01T08:00:01.070+08:00|                  2.0237974849045237|</span>
<span class="line">|1970-01-01T08:00:01.080+08:00|                   2.015939990377423|</span>
<span class="line">|1970-01-01T08:00:01.090+08:00|                  2.0079924954354746|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|                                 2.0|</span>
<span class="line">|1970-01-01T08:00:01.110+08:00|                  1.9907018211101906|</span>
<span class="line">|1970-01-01T08:00:01.120+08:00|                  1.9788509124245144|</span>
<span class="line">|1970-01-01T08:00:01.130+08:00|                  1.9645127287932083|</span>
<span class="line">|1970-01-01T08:00:01.140+08:00|                  1.9477527250665083|</span>
<span class="line">|1970-01-01T08:00:01.150+08:00|                  1.9286363560946513|</span>
<span class="line">|1970-01-01T08:00:01.160+08:00|                  1.9072290767278735|</span>
<span class="line">|1970-01-01T08:00:01.170+08:00|                  1.8835963418164114|</span>
<span class="line">|1970-01-01T08:00:01.180+08:00|                  1.8578036062105014|</span>
<span class="line">|1970-01-01T08:00:01.190+08:00|                  1.8299163247603802|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|                  1.7999999523162842|</span>
<span class="line">|1970-01-01T08:00:01.210+08:00|                  1.7623635841923329|</span>
<span class="line">|1970-01-01T08:00:01.220+08:00|                  1.7129696477516976|</span>
<span class="line">|1970-01-01T08:00:01.230+08:00|                  1.6543635959181928|</span>
<span class="line">|1970-01-01T08:00:01.240+08:00|                  1.5890908816156328|</span>
<span class="line">|1970-01-01T08:00:01.250+08:00|                  1.5196969577678319|</span>
<span class="line">|1970-01-01T08:00:01.260+08:00|                  1.4487272772986044|</span>
<span class="line">|1970-01-01T08:00:01.270+08:00|                  1.3787272931317647|</span>
<span class="line">|1970-01-01T08:00:01.280+08:00|                  1.3122424581911272|</span>
<span class="line">|1970-01-01T08:00:01.290+08:00|                   1.251818225400506|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|                  1.2000000476837158|</span>
<span class="line">|1970-01-01T08:00:01.310+08:00|                  1.1548000470995912|</span>
<span class="line">|1970-01-01T08:00:01.320+08:00|                  1.1130667107899999|</span>
<span class="line">|1970-01-01T08:00:01.330+08:00|                  1.0756000393033045|</span>
<span class="line">|1970-01-01T08:00:01.340+08:00|                   1.043200033187868|</span>
<span class="line">|1970-01-01T08:00:01.350+08:00|                   1.016666692992053|</span>
<span class="line">|1970-01-01T08:00:01.360+08:00|                  0.9968000192642223|</span>
<span class="line">|1970-01-01T08:00:01.370+08:00|                  0.9844000125527389|</span>
<span class="line">|1970-01-01T08:00:01.380+08:00|                  0.9802666734059655|</span>
<span class="line">|1970-01-01T08:00:01.390+08:00|                  0.9852000023722649|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|                                 1.0|</span>
<span class="line">|1970-01-01T08:00:01.410+08:00|                   1.023999999165535|</span>
<span class="line">|1970-01-01T08:00:01.420+08:00|                  1.0559999990463256|</span>
<span class="line">|1970-01-01T08:00:01.430+08:00|                  1.0959999996423722|</span>
<span class="line">|1970-01-01T08:00:01.440+08:00|                  1.1440000009536744|</span>
<span class="line">|1970-01-01T08:00:01.450+08:00|                  1.2000000029802322|</span>
<span class="line">|1970-01-01T08:00:01.460+08:00|                   1.264000005722046|</span>
<span class="line">|1970-01-01T08:00:01.470+08:00|                  1.3360000091791153|</span>
<span class="line">|1970-01-01T08:00:01.480+08:00|                  1.4160000133514405|</span>
<span class="line">|1970-01-01T08:00:01.490+08:00|                  1.5040000182390214|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|                   1.600000023841858|</span>
<span class="line">+-----------------------------+------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="spread" tabindex="-1"><a class="header-anchor" href="#spread"><span>Spread</span></a></h3><h4 id="注册语句-23" tabindex="-1"><a class="header-anchor" href="#注册语句-23"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> spread <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDAFSpread&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-23" tabindex="-1"><a class="header-anchor" href="#函数简介-23"><span>函数简介</span></a></h4><p>本函数用于计算时间序列的极差，即最大值减去最小值的结果。</p><p><strong>函数名：</strong> SPREAD</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>输出序列：</strong> 输出单个序列，类型与输入相同，序列仅包含一个时间戳为 0 、值为极差的数据点。</p><p><strong>提示：</strong> 数据中的空值、缺失值和<code>NaN</code>将会被忽略。</p><h4 id="使用示例-23" tabindex="-1"><a class="header-anchor" href="#使用示例-23"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|          101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|          112.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|          118.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          120.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|          124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|            NaN|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> spread<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">30</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-----------------------+</span>
<span class="line">|                         Time|spread(root.test.d1.s1)|</span>
<span class="line">+-----------------------------+-----------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                   26.0|</span>
<span class="line">+-----------------------------+-----------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="zscore" tabindex="-1"><a class="header-anchor" href="#zscore"><span>ZScore</span></a></h3><h4 id="注册语句-24" tabindex="-1"><a class="header-anchor" href="#注册语句-24"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> zscore <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dprofile.UDTFZScore&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-24" tabindex="-1"><a class="header-anchor" href="#函数简介-24"><span>函数简介</span></a></h4><p>本函数将输入序列使用z-score方法进行归一化。</p><p><strong>函数名：</strong> ZSCORE</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>compute</code>：若设置为 &quot;batch&quot;，则将数据全部读入后转换；若设置为 &quot;stream&quot;，则需用户提供均值及方差进行流式计算转换。默认为 &quot;batch&quot;。</li><li><code>avg</code>：使用流式计算时的均值。</li><li><code>sd</code>：使用流式计算时的标准差。</li></ul><p><strong>输出序列</strong>：输出单个序列，类型为 DOUBLE。</p><h4 id="使用示例-24" tabindex="-1"><a class="header-anchor" href="#使用示例-24"><span>使用示例</span></a></h4><h5 id="全数据计算-1" tabindex="-1"><a class="header-anchor" href="#全数据计算-1"><span>全数据计算</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------+</span>
<span class="line">|                         Time|root.test.s1|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|        -2.0|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.600+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.700+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:01.800+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:01.900+08:00|        -2.0|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|         0.0|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> zscore<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------+</span>
<span class="line">|                         Time|zscore(root.test.s1)|</span>
<span class="line">+-----------------------------+--------------------+</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|-0.20672455764868078|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|-0.20672455764868078|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00| 0.20672455764868078|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00| -0.6201736729460423|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|-0.20672455764868078|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|-0.20672455764868078|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|  -1.033622788243404|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|  0.6201736729460423|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|-0.20672455764868078|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|-0.20672455764868078|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00| 0.20672455764868078|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00| -0.6201736729460423|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00| -0.6201736729460423|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00| 0.20672455764868078|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|-0.20672455764868078|</span>
<span class="line">|1970-01-01T08:00:01.600+08:00|-0.20672455764868078|</span>
<span class="line">|1970-01-01T08:00:01.700+08:00|  3.9277665953249348|</span>
<span class="line">|1970-01-01T08:00:01.800+08:00|  0.6201736729460423|</span>
<span class="line">|1970-01-01T08:00:01.900+08:00|  -1.033622788243404|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|-0.20672455764868078|</span>
<span class="line">+-----------------------------+--------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="异常检测" tabindex="-1"><a class="header-anchor" href="#异常检测"><span>异常检测</span></a></h2><h3 id="iqr" tabindex="-1"><a class="header-anchor" href="#iqr"><span>IQR</span></a></h3><h4 id="注册语句-25" tabindex="-1"><a class="header-anchor" href="#注册语句-25"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> iqr <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.anomaly.UDTFIQR&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-25" tabindex="-1"><a class="header-anchor" href="#函数简介-25"><span>函数简介</span></a></h4><p>本函数用于检验超出上下四分位数1.5倍IQR的数据分布异常。</p><p><strong>函数名：</strong> IQR</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>method</code>：若设置为 &quot;batch&quot;，则将数据全部读入后检测；若设置为 &quot;stream&quot;，则需用户提供上下四分位数进行流式检测。默认为 &quot;batch&quot;。</li><li><code>q1</code>：使用流式计算时的下四分位数。</li><li><code>q3</code>：使用流式计算时的上四分位数。</li></ul><p><strong>输出序列</strong>：输出单个序列，类型为 DOUBLE。</p><p><strong>说明</strong>：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>Q</mi><mi>R</mi><mo>=</mo><msub><mi>Q</mi><mn>3</mn></msub><mo>−</mo><msub><mi>Q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">IQR=Q_3-Q_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.00773em;">QR</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><h4 id="使用示例-25" tabindex="-1"><a class="header-anchor" href="#使用示例-25"><span>使用示例</span></a></h4><h5 id="全数据计算-2" tabindex="-1"><a class="header-anchor" href="#全数据计算-2"><span>全数据计算</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------+</span>
<span class="line">|                         Time|root.test.s1|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|        -2.0|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|        -1.0|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|         1.0|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.600+08:00|         0.0|</span>
<span class="line">|1970-01-01T08:00:01.700+08:00|        10.0|</span>
<span class="line">|1970-01-01T08:00:01.800+08:00|         2.0|</span>
<span class="line">|1970-01-01T08:00:01.900+08:00|        -2.0|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|         0.0|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> iqr<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-----------------+</span>
<span class="line">|                         Time|iqr(root.test.s1)|</span>
<span class="line">+-----------------------------+-----------------+</span>
<span class="line">|1970-01-01T08:00:01.700+08:00|             10.0|</span>
<span class="line">+-----------------------------+-----------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ksigma" tabindex="-1"><a class="header-anchor" href="#ksigma"><span>KSigma</span></a></h3><h4 id="注册语句-26" tabindex="-1"><a class="header-anchor" href="#注册语句-26"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> ksigma <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.anomaly.UDTFKSigma&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-26" tabindex="-1"><a class="header-anchor" href="#函数简介-26"><span>函数简介</span></a></h4><p>本函数利用动态 K-Sigma 算法进行异常检测。在一个窗口内，与平均值的差距超过k倍标准差的数据将被视作异常并输出。</p><p><strong>函数名：</strong> KSIGMA</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>k</code>：在动态 K-Sigma 算法中，分布异常的标准差倍数阈值，默认值为 3。</li><li><code>window</code>：动态 K-Sigma 算法的滑动窗口大小，默认值为 10000。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型与输入序列相同。</p><p><strong>提示：</strong> k 应大于 0，否则将不做输出。</p><h4 id="使用示例-26" tabindex="-1"><a class="header-anchor" href="#使用示例-26"><span>使用示例</span></a></h4><h5 id="指定k" tabindex="-1"><a class="header-anchor" href="#指定k"><span>指定k</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|            0.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|           50.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          150.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          200.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          200.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|          200.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          200.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          200.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          200.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|          150.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|           50.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|            0.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|            NaN|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> ksigma<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&quot;k&quot;</span><span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">30</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------------------------+</span>
<span class="line">|Time                         |ksigma(root.test.d1.s1,&quot;k&quot;=&quot;3.0&quot;)|</span>
<span class="line">+-----------------------------+---------------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|                              0.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|                             50.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|                             50.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|                              0.0|</span>
<span class="line">+-----------------------------+---------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lof" tabindex="-1"><a class="header-anchor" href="#lof"><span>LOF</span></a></h3><h4 id="注册语句-27" tabindex="-1"><a class="header-anchor" href="#注册语句-27"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> LOF <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.anomaly.UDTFLOF&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-27" tabindex="-1"><a class="header-anchor" href="#函数简介-27"><span>函数简介</span></a></h4><p>本函数使用局部离群点检测方法用于查找序列的密度异常。将根据提供的第k距离数及局部离群点因子(lof)阈值，判断输入数据是否为离群点，即异常，并输出各点的 LOF 值。</p><p><strong>函数名：</strong> LOF</p><p><strong>输入序列：</strong> 多个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>method</code>:使用的检测方法。默认为 default，以高维数据计算。设置为 series，将一维时间序列转换为高维数据计算。</li><li><code>k</code>:使用第k距离计算局部离群点因子.默认为 3。</li><li><code>window</code>:每次读取数据的窗口长度。默认为 10000.</li><li><code>windowsize</code>:使用series方法时，转化高维数据的维数，即单个窗口的大小。默认为 5。</li></ul><p><strong>输出序列：</strong> 输出单时间序列，类型为DOUBLE。</p><p><strong>提示：</strong> 不完整的数据行会被忽略，不参与计算，也不标记为离群点。</p><h4 id="使用示例-27" tabindex="-1"><a class="header-anchor" href="#使用示例-27"><span>使用示例</span></a></h4><h5 id="默认参数" tabindex="-1"><a class="header-anchor" href="#默认参数"><span>默认参数</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|root.test.d1.s2|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|            0.0|            0.0|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|            0.0|            1.0|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|            1.0|            1.0|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|            1.0|            0.0|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|            0.0|           -1.0|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|           -1.0|           -1.0|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|           -1.0|            0.0|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|            2.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|            0.0|           null|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> lof<span class="token punctuation">(</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span><span class="token operator">&lt;</span><span class="token number">1000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------------------+</span>
<span class="line">|                         Time|lof(root.test.d1.s1, root.test.d1.s2)|</span>
<span class="line">+-----------------------------+-------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|                   3.8274824267668244|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|                   3.0117631741126156|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|                    2.838155437762879|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|                   3.0117631741126156|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|                     2.73518261244453|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|                    2.371440975708148|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|                     2.73518261244453|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|                   1.7561416374270742|</span>
<span class="line">+-----------------------------+-------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="诊断一维时间序列" tabindex="-1"><a class="header-anchor" href="#诊断一维时间序列"><span>诊断一维时间序列</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|            1.0|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|            3.0|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|            4.0|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|            5.0|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|            6.0|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|            7.0|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|            8.0|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|            9.0|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|           10.0|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|           11.0|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|           12.0|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|           13.0|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|           14.0|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|           15.0|</span>
<span class="line">|1970-01-01T08:00:01.600+08:00|           16.0|</span>
<span class="line">|1970-01-01T08:00:01.700+08:00|           17.0|</span>
<span class="line">|1970-01-01T08:00:01.800+08:00|           18.0|</span>
<span class="line">|1970-01-01T08:00:01.900+08:00|           19.0|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|           20.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> lof<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">&quot;method&quot;</span><span class="token operator">=</span><span class="token string">&quot;series&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span><span class="token operator">&lt;</span><span class="token number">1000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------+</span>
<span class="line">|                         Time|lof(root.test.d1.s1)|</span>
<span class="line">+-----------------------------+--------------------+</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|    3.77777777777778|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|    4.32727272727273|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|    4.85714285714286|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|    5.40909090909091|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|    5.94999999999999|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|    6.43243243243243|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|    6.79999999999999|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|                 7.0|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|                 7.0|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|    6.79999999999999|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|    6.43243243243243|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|    5.94999999999999|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|    5.40909090909091|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|    4.85714285714286|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|    4.32727272727273|</span>
<span class="line">|1970-01-01T08:00:01.600+08:00|    3.77777777777778|</span>
<span class="line">+-----------------------------+--------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="missdetect" tabindex="-1"><a class="header-anchor" href="#missdetect"><span>MissDetect</span></a></h3><h4 id="注册语句-28" tabindex="-1"><a class="header-anchor" href="#注册语句-28"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> missdetect <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.anomaly.UDTFMissDetect&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-28" tabindex="-1"><a class="header-anchor" href="#函数简介-28"><span>函数简介</span></a></h4><p>本函数用于检测数据中的缺失异常。在一些数据中，缺失数据会被线性插值填补，在数据中出现完美的线性片段，且这些片段往往长度较大。本函数通过在数据中发现这些完美线性片段来检测缺失异常。</p><p><strong>函数名：</strong> MISSDETECT</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>minlen</code>：被标记为异常的完美线性片段的最小长度，是一个大于等于 10 的整数，默认值为 10。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为 BOOLEAN，即该数据点是否为缺失异常。</p><p><strong>提示：</strong> 数据中的<code>NaN</code>将会被忽略。</p><h4 id="使用示例-28" tabindex="-1"><a class="header-anchor" href="#使用示例-28"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d2.s2|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2021-07-01T12:00:00.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:01.000+08:00|            1.0|</span>
<span class="line">|2021-07-01T12:00:02.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:03.000+08:00|            1.0|</span>
<span class="line">|2021-07-01T12:00:04.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:05.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:06.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:07.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:08.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:09.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:10.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:11.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:12.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:13.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:14.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:15.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:16.000+08:00|            1.0|</span>
<span class="line">|2021-07-01T12:00:17.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:18.000+08:00|            1.0|</span>
<span class="line">|2021-07-01T12:00:19.000+08:00|            0.0|</span>
<span class="line">|2021-07-01T12:00:20.000+08:00|            1.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> missdetect<span class="token punctuation">(</span>s2<span class="token punctuation">,</span><span class="token string">&#39;minlen&#39;</span><span class="token operator">=</span><span class="token string">&#39;10&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------------------------------------+</span>
<span class="line">|                         Time|missdetect(root.test.d2.s2, &quot;minlen&quot;=&quot;10&quot;)|</span>
<span class="line">+-----------------------------+------------------------------------------+</span>
<span class="line">|2021-07-01T12:00:00.000+08:00|                                     false|</span>
<span class="line">|2021-07-01T12:00:01.000+08:00|                                     false|</span>
<span class="line">|2021-07-01T12:00:02.000+08:00|                                     false|</span>
<span class="line">|2021-07-01T12:00:03.000+08:00|                                     false|</span>
<span class="line">|2021-07-01T12:00:04.000+08:00|                                      true|</span>
<span class="line">|2021-07-01T12:00:05.000+08:00|                                      true|</span>
<span class="line">|2021-07-01T12:00:06.000+08:00|                                      true|</span>
<span class="line">|2021-07-01T12:00:07.000+08:00|                                      true|</span>
<span class="line">|2021-07-01T12:00:08.000+08:00|                                      true|</span>
<span class="line">|2021-07-01T12:00:09.000+08:00|                                      true|</span>
<span class="line">|2021-07-01T12:00:10.000+08:00|                                      true|</span>
<span class="line">|2021-07-01T12:00:11.000+08:00|                                      true|</span>
<span class="line">|2021-07-01T12:00:12.000+08:00|                                      true|</span>
<span class="line">|2021-07-01T12:00:13.000+08:00|                                      true|</span>
<span class="line">|2021-07-01T12:00:14.000+08:00|                                      true|</span>
<span class="line">|2021-07-01T12:00:15.000+08:00|                                      true|</span>
<span class="line">|2021-07-01T12:00:16.000+08:00|                                     false|</span>
<span class="line">|2021-07-01T12:00:17.000+08:00|                                     false|</span>
<span class="line">|2021-07-01T12:00:18.000+08:00|                                     false|</span>
<span class="line">|2021-07-01T12:00:19.000+08:00|                                     false|</span>
<span class="line">|2021-07-01T12:00:20.000+08:00|                                     false|</span>
<span class="line">+-----------------------------+------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="range" tabindex="-1"><a class="header-anchor" href="#range"><span>Range</span></a></h3><h4 id="注册语句-29" tabindex="-1"><a class="header-anchor" href="#注册语句-29"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> range <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.anomaly.UDTFRange&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-29" tabindex="-1"><a class="header-anchor" href="#函数简介-29"><span>函数简介</span></a></h4><p>本函数用于查找时间序列的范围异常。将根据提供的上界与下界，判断输入数据是否越界，即异常，并输出所有异常点为新的时间序列。</p><p><strong>函数名：</strong> RANGE</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>lower_bound</code>:范围异常检测的下界。</li><li><code>upper_bound</code>:范围异常检测的上界。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型与输入序列相同。</p><p><strong>提示：</strong> 应满足<code>upper_bound</code>大于<code>lower_bound</code>，否则将不做输出。</p><h4 id="使用示例-29" tabindex="-1"><a class="header-anchor" href="#使用示例-29"><span>使用示例</span></a></h4><h5 id="指定上界与下界" tabindex="-1"><a class="header-anchor" href="#指定上界与下界"><span>指定上界与下界</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|          101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|          112.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|          118.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          120.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|          124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|            NaN|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> range<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&quot;lower_bound&quot;</span><span class="token operator">=</span><span class="token string">&quot;101.0&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;upper_bound&quot;</span><span class="token operator">=</span><span class="token string">&quot;125.0&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">30</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------------------------------------------------------------+</span>
<span class="line">|Time                         |range(root.test.d1.s1,&quot;lower_bound&quot;=&quot;101.0&quot;,&quot;upper_bound&quot;=&quot;125.0&quot;)|</span>
<span class="line">+-----------------------------+------------------------------------------------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|                                                             100.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|                                                             126.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|                                                             126.0|</span>
<span class="line">+-----------------------------+------------------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="twosidedfilter" tabindex="-1"><a class="header-anchor" href="#twosidedfilter"><span>TwoSidedFilter</span></a></h3><h4 id="注册语句-30" tabindex="-1"><a class="header-anchor" href="#注册语句-30"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> twosidedfilter <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.anomaly.UDTFTwoSidedFilter&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-30" tabindex="-1"><a class="header-anchor" href="#函数简介-30"><span>函数简介</span></a></h4><p>本函数基于双边窗口检测法对输入序列中的异常点进行过滤。</p><p><strong>函数名：</strong> TWOSIDEDFILTER</p><p><strong>输出序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>输出序列：</strong> 输出单个序列，类型与输入相同，是输入序列去除异常点后的结果。</p><p><strong>参数：</strong></p><ul><li><code>len</code>：双边窗口检测法中的窗口大小，取值范围为正整数，默认值为 5.如当<code>len</code>=3 时，算法向前、向后各取长度为3的窗口，在窗口中计算异常度。</li><li><code>threshold</code>：异常度的阈值，取值范围为(0,1)，默认值为 0.3。阈值越高，函数对于异常度的判定标准越严格。</li></ul><h4 id="使用示例-30" tabindex="-1"><a class="header-anchor" href="#使用示例-30"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------+</span>
<span class="line">|                         Time|root.test.s0|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|      2002.0|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|      1946.0|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|      1958.0|</span>
<span class="line">|1970-01-01T08:00:03.000+08:00|      2012.0|</span>
<span class="line">|1970-01-01T08:00:04.000+08:00|      2051.0|</span>
<span class="line">|1970-01-01T08:00:05.000+08:00|      1898.0|</span>
<span class="line">|1970-01-01T08:00:06.000+08:00|      2014.0|</span>
<span class="line">|1970-01-01T08:00:07.000+08:00|      2052.0|</span>
<span class="line">|1970-01-01T08:00:08.000+08:00|      1935.0|</span>
<span class="line">|1970-01-01T08:00:09.000+08:00|      1901.0|</span>
<span class="line">|1970-01-01T08:00:10.000+08:00|      1972.0|</span>
<span class="line">|1970-01-01T08:00:11.000+08:00|      1969.0|</span>
<span class="line">|1970-01-01T08:00:12.000+08:00|      1984.0|</span>
<span class="line">|1970-01-01T08:00:13.000+08:00|      2018.0|</span>
<span class="line">|1970-01-01T08:00:37.000+08:00|      1484.0|</span>
<span class="line">|1970-01-01T08:00:38.000+08:00|      1055.0|</span>
<span class="line">|1970-01-01T08:00:39.000+08:00|      1050.0|</span>
<span class="line">|1970-01-01T08:01:05.000+08:00|      1023.0|</span>
<span class="line">|1970-01-01T08:01:06.000+08:00|      1056.0|</span>
<span class="line">|1970-01-01T08:01:07.000+08:00|       978.0|</span>
<span class="line">|1970-01-01T08:01:08.000+08:00|      1050.0|</span>
<span class="line">|1970-01-01T08:01:09.000+08:00|      1123.0|</span>
<span class="line">|1970-01-01T08:01:10.000+08:00|      1150.0|</span>
<span class="line">|1970-01-01T08:01:11.000+08:00|      1034.0|</span>
<span class="line">|1970-01-01T08:01:12.000+08:00|       950.0|</span>
<span class="line">|1970-01-01T08:01:13.000+08:00|      1059.0|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> TwoSidedFilter<span class="token punctuation">(</span>s0<span class="token punctuation">,</span> <span class="token string">&#39;len&#39;</span><span class="token operator">=</span><span class="token string">&#39;5&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;threshold&#39;</span><span class="token operator">=</span><span class="token string">&#39;0.3&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------+</span>
<span class="line">|                         Time|root.test.s0|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|      2002.0|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|      1946.0|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|      1958.0|</span>
<span class="line">|1970-01-01T08:00:03.000+08:00|      2012.0|</span>
<span class="line">|1970-01-01T08:00:04.000+08:00|      2051.0|</span>
<span class="line">|1970-01-01T08:00:05.000+08:00|      1898.0|</span>
<span class="line">|1970-01-01T08:00:06.000+08:00|      2014.0|</span>
<span class="line">|1970-01-01T08:00:07.000+08:00|      2052.0|</span>
<span class="line">|1970-01-01T08:00:08.000+08:00|      1935.0|</span>
<span class="line">|1970-01-01T08:00:09.000+08:00|      1901.0|</span>
<span class="line">|1970-01-01T08:00:10.000+08:00|      1972.0|</span>
<span class="line">|1970-01-01T08:00:11.000+08:00|      1969.0|</span>
<span class="line">|1970-01-01T08:00:12.000+08:00|      1984.0|</span>
<span class="line">|1970-01-01T08:00:13.000+08:00|      2018.0|</span>
<span class="line">|1970-01-01T08:01:05.000+08:00|      1023.0|</span>
<span class="line">|1970-01-01T08:01:06.000+08:00|      1056.0|</span>
<span class="line">|1970-01-01T08:01:07.000+08:00|       978.0|</span>
<span class="line">|1970-01-01T08:01:08.000+08:00|      1050.0|</span>
<span class="line">|1970-01-01T08:01:09.000+08:00|      1123.0|</span>
<span class="line">|1970-01-01T08:01:10.000+08:00|      1150.0|</span>
<span class="line">|1970-01-01T08:01:11.000+08:00|      1034.0|</span>
<span class="line">|1970-01-01T08:01:12.000+08:00|       950.0|</span>
<span class="line">|1970-01-01T08:01:13.000+08:00|      1059.0|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="outlier" tabindex="-1"><a class="header-anchor" href="#outlier"><span>Outlier</span></a></h3><h4 id="注册语句-31" tabindex="-1"><a class="header-anchor" href="#注册语句-31"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> outlier <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.anomaly.UDTFOutlier&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-31" tabindex="-1"><a class="header-anchor" href="#函数简介-31"><span>函数简介</span></a></h4><p>本函数用于检测基于距离的异常点。在当前窗口中，如果一个点距离阈值范围内的邻居数量（包括它自己）少于密度阈值，则该点是异常点。</p><p><strong>函数名：</strong> OUTLIER</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>r</code>：基于距离异常检测中的距离阈值。</li><li><code>k</code>：基于距离异常检测中的密度阈值。</li><li><code>w</code>：用于指定滑动窗口的大小。</li><li><code>s</code>：用于指定滑动窗口的步长。</li></ul><p><strong>输出序列</strong>：输出单个序列，类型与输入序列相同。</p><h4 id="使用示例-31" tabindex="-1"><a class="header-anchor" href="#使用示例-31"><span>使用示例</span></a></h4><h5 id="指定查询参数" tabindex="-1"><a class="header-anchor" href="#指定查询参数"><span>指定查询参数</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------+</span>
<span class="line">|                         Time|root.test.s1|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line">|2020-01-04T23:59:55.000+08:00|        56.0|</span>
<span class="line">|2020-01-04T23:59:56.000+08:00|        55.1|</span>
<span class="line">|2020-01-04T23:59:57.000+08:00|        54.2|</span>
<span class="line">|2020-01-04T23:59:58.000+08:00|        56.3|</span>
<span class="line">|2020-01-04T23:59:59.000+08:00|        59.0|</span>
<span class="line">|2020-01-05T00:00:00.000+08:00|        60.0|</span>
<span class="line">|2020-01-05T00:00:01.000+08:00|        60.5|</span>
<span class="line">|2020-01-05T00:00:02.000+08:00|        64.5|</span>
<span class="line">|2020-01-05T00:00:03.000+08:00|        69.0|</span>
<span class="line">|2020-01-05T00:00:04.000+08:00|        64.2|</span>
<span class="line">|2020-01-05T00:00:05.000+08:00|        62.3|</span>
<span class="line">|2020-01-05T00:00:06.000+08:00|        58.0|</span>
<span class="line">|2020-01-05T00:00:07.000+08:00|        58.9|</span>
<span class="line">|2020-01-05T00:00:08.000+08:00|        52.0|</span>
<span class="line">|2020-01-05T00:00:09.000+08:00|        62.3|</span>
<span class="line">|2020-01-05T00:00:10.000+08:00|        61.0|</span>
<span class="line">|2020-01-05T00:00:11.000+08:00|        64.2|</span>
<span class="line">|2020-01-05T00:00:12.000+08:00|        61.8|</span>
<span class="line">|2020-01-05T00:00:13.000+08:00|        64.0|</span>
<span class="line">|2020-01-05T00:00:14.000+08:00|        63.0|</span>
<span class="line">+-----------------------------+------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> outlier<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&quot;r&quot;</span><span class="token operator">=</span><span class="token string">&quot;5.0&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;k&quot;</span><span class="token operator">=</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;w&quot;</span><span class="token operator">=</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;s&quot;</span><span class="token operator">=</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------------------------------------------+</span>
<span class="line">|                         Time|outlier(root.test.s1,&quot;r&quot;=&quot;5.0&quot;,&quot;k&quot;=&quot;4&quot;,&quot;w&quot;=&quot;10&quot;,&quot;s&quot;=&quot;5&quot;)|</span>
<span class="line">+-----------------------------+--------------------------------------------------------+</span>
<span class="line">|2020-01-05T00:00:03.000+08:00|                                                    69.0|</span>
<span class="line">+-----------------------------+--------------------------------------------------------+</span>
<span class="line">|2020-01-05T00:00:08.000+08:00|                                                    52.0|</span>
<span class="line">+-----------------------------+--------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mastertrain" tabindex="-1"><a class="header-anchor" href="#mastertrain"><span>MasterTrain</span></a></h3><h4 id="函数简介-32" tabindex="-1"><a class="header-anchor" href="#函数简介-32"><span>函数简介</span></a></h4><p>本函数基于主数据训练VAR预测模型。将根据提供的主数据判断时间序列中的数据点是否为错误值，并由连续p+1个非错误值作为训练样本训练VAR模型，输出训练后的模型参数。</p><p><strong>函数名：</strong> MasterTrain</p><p><strong>输入序列：</strong> 支持多个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>p</code>:模型阶数。</li><li><code>eta</code>:错误值判定阈值，在缺省情况下，算法根据3-sigma原则自动估计该参数。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为DOUBLE。</p><p><strong>安装方式：</strong></p><ul><li>从IoTDB代码仓库下载<code>research/master-detector</code>分支代码到本地</li><li>在根目录运行 <code>mvn spotless:apply</code></li><li>在根目录运行 <code>mvn clean package -pl library-udf -DskipTests -am -P get-jar-with-dependencies</code> 编译项目</li><li>将 <code>./library-UDF/target/library-udf-1.2.0-SNAPSHOT-jar-with-dependencies.jar</code>复制到IoTDB服务器的<code>./ext/udf/</code> 路径下。</li><li>启动 IoTDB服务器，在客户端中执行 <code>create function MasterTrain as org.apache.iotdb.library.anomaly.UDTFMasterTrain&#39;</code>。</li></ul><h4 id="使用示例-32" tabindex="-1"><a class="header-anchor" href="#使用示例-32"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------+------------+--------------+--------------+</span>
<span class="line">|                         Time|root.test.lo|root.test.la|root.test.m_la|root.test.m_lo|</span>
<span class="line">+-----------------------------+------------+------------+--------------+--------------+</span>
<span class="line">|1970-01-01T08:00:00.001+08:00| 39.99982556|  116.327274|   116.3271939|   39.99984748|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00| 39.99983865|  116.327305|   116.3272269|   39.99984748|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00| 40.00019038| 116.3273291|   116.3272634|   39.99984769|</span>
<span class="line">|1970-01-01T08:00:00.004+08:00| 39.99982556|  116.327342|   116.3273015|    39.9998483|</span>
<span class="line">|1970-01-01T08:00:00.005+08:00| 39.99982991| 116.3273744|    116.327339|   39.99984892|</span>
<span class="line">|1970-01-01T08:00:00.006+08:00| 39.99982716| 116.3274117|   116.3273759|   39.99984892|</span>
<span class="line">|1970-01-01T08:00:00.007+08:00|  39.9998259| 116.3274396|   116.3274163|   39.99984953|</span>
<span class="line">|1970-01-01T08:00:00.008+08:00| 39.99982597| 116.3274668|   116.3274525|   39.99985014|</span>
<span class="line">|1970-01-01T08:00:00.009+08:00| 39.99982226| 116.3275026|   116.3274915|   39.99985076|</span>
<span class="line">|1970-01-01T08:00:00.010+08:00| 39.99980988| 116.3274967|   116.3275235|   39.99985137|</span>
<span class="line">|1970-01-01T08:00:00.011+08:00| 39.99984873| 116.3274929|   116.3275611|   39.99985199|</span>
<span class="line">|1970-01-01T08:00:00.012+08:00| 39.99981589| 116.3274745|   116.3275974|    39.9998526|</span>
<span class="line">|1970-01-01T08:00:00.013+08:00|  39.9998259| 116.3275095|   116.3276338|   39.99985384|</span>
<span class="line">|1970-01-01T08:00:00.014+08:00| 39.99984873| 116.3274787|   116.3276695|   39.99985446|</span>
<span class="line">|1970-01-01T08:00:00.015+08:00|  39.9998343| 116.3274693|   116.3277045|   39.99985569|</span>
<span class="line">|1970-01-01T08:00:00.016+08:00| 39.99983316| 116.3274941|   116.3277389|   39.99985631|</span>
<span class="line">|1970-01-01T08:00:00.017+08:00| 39.99983311| 116.3275401|   116.3277747|   39.99985693|</span>
<span class="line">|1970-01-01T08:00:00.018+08:00| 39.99984113| 116.3275713|   116.3278041|   39.99985756|</span>
<span class="line">|1970-01-01T08:00:00.019+08:00| 39.99983602| 116.3276003|   116.3278379|   39.99985818|</span>
<span class="line">|1970-01-01T08:00:00.020+08:00|  39.9998355| 116.3276308|   116.3278723|    39.9998588|</span>
<span class="line">|1970-01-01T08:00:00.021+08:00| 40.00012176| 116.3276107|   116.3279026|   39.99985942|</span>
<span class="line">|1970-01-01T08:00:00.022+08:00|  39.9998404| 116.3276684|          null|          null|</span>
<span class="line">|1970-01-01T08:00:00.023+08:00| 39.99983942| 116.3277016|          null|          null|</span>
<span class="line">|1970-01-01T08:00:00.024+08:00| 39.99984113| 116.3277284|          null|          null|</span>
<span class="line">|1970-01-01T08:00:00.025+08:00| 39.99984283| 116.3277562|          null|          null|</span>
<span class="line">+-----------------------------+------------+------------+--------------+--------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> MasterTrain<span class="token punctuation">(</span>lo<span class="token punctuation">,</span>la<span class="token punctuation">,</span>m_lo<span class="token punctuation">,</span>m_la<span class="token punctuation">,</span><span class="token string">&#39;p&#39;</span><span class="token operator">=</span><span class="token string">&#39;3&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;eta&#39;</span><span class="token operator">=</span><span class="token string">&#39;1.0&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------------------------------------------------------------------------------------+</span>
<span class="line">|                         Time|MasterTrain(root.test.lo, root.test.la, root.test.m_lo, root.test.m_la, &quot;p&quot;=&quot;3&quot;, &quot;eta&quot;=&quot;1.0&quot;)|</span>
<span class="line">+-----------------------------+---------------------------------------------------------------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|                                                                          0.13656607660463288|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|                                                                           0.8291884323013894|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00|                                                                          0.05012816073171693|</span>
<span class="line">|1970-01-01T08:00:00.004+08:00|                                                                          -0.5495287787485761|</span>
<span class="line">|1970-01-01T08:00:00.005+08:00|                                                                          0.03740486307345578|</span>
<span class="line">|1970-01-01T08:00:00.006+08:00|                                                                           1.0500132150475212|</span>
<span class="line">|1970-01-01T08:00:00.007+08:00|                                                                          0.04583944643116993|</span>
<span class="line">|1970-01-01T08:00:00.008+08:00|                                                                         -0.07863708480736269|</span>
<span class="line">+-----------------------------+---------------------------------------------------------------------------------------------+</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="masterdetect" tabindex="-1"><a class="header-anchor" href="#masterdetect"><span>MasterDetect</span></a></h3><h4 id="函数简介-33" tabindex="-1"><a class="header-anchor" href="#函数简介-33"><span>函数简介</span></a></h4><p>本函数基于主数据检测并修复时间序列中的错误值。将根据提供的主数据判断时间序列中的数据点是否为错误值，并由MasterTrain训练的模型进行时间序列预测，错误值将由预测值及主数据共同修复。</p><p><strong>函数名：</strong> MasterDetect</p><p><strong>输入序列：</strong> 支持多个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>p</code>:模型阶数。</li><li><code>k</code>：主数据中的近邻数量，正整数， 在缺省情况下，算法根据主数据中的k个近邻的元组距离自动估计该参数。</li><li><code>eta</code>:错误值判定阈值，在缺省情况下，算法根据3-sigma原则自动估计该参数。</li><li><code>beta</code>:异常值判定阈值，在缺省情况下，算法根据3-sigma原则自动估计该参数。</li><li><code>output_type</code>:输出结果类型，可选&#39;repair&#39;或&#39;anomaly&#39;，即输出修复结果或异常检测结果，在缺省情况下默认为&#39;repair&#39;。</li><li><code>output_column</code>：输出列的序号，默认为1，即输出第一列的修复结果。</li></ul><p><strong>安装方式：</strong></p><ul><li>从IoTDB代码仓库下载<code>research/master-detector</code>分支代码到本地</li><li>在根目录运行 <code>mvn spotless:apply</code></li><li>在根目录运行 <code>mvn clean package -pl library-udf -DskipTests -am -P get-jar-with-dependencies</code> 编译项目</li><li>将 <code>./library-UDF/target/library-udf-1.2.0-SNAPSHOT-jar-with-dependencies.jar</code>复制到IoTDB服务器的<code>./ext/udf/</code> 路径下。</li><li>启动 IoTDB服务器，在客户端中执行 <code>create function MasterDetect as &#39;org.apache.iotdb.library.anomaly.UDTFMasterDetect&#39;</code>。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型与输入数据中对应列的类型相同，序列为输入列修复后的结果。</p><h4 id="使用示例-33" tabindex="-1"><a class="header-anchor" href="#使用示例-33"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------+------------+--------------+--------------+--------------------+</span>
<span class="line">|                         Time|root.test.lo|root.test.la|root.test.m_la|root.test.m_lo|     root.test.model|</span>
<span class="line">+-----------------------------+------------+------------+--------------+--------------+--------------------+</span>
<span class="line">|1970-01-01T08:00:00.001+08:00| 39.99982556|  116.327274|   116.3271939|   39.99984748| 0.13656607660463288|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00| 39.99983865|  116.327305|   116.3272269|   39.99984748|  0.8291884323013894|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00| 40.00019038| 116.3273291|   116.3272634|   39.99984769| 0.05012816073171693|</span>
<span class="line">|1970-01-01T08:00:00.004+08:00| 39.99982556|  116.327342|   116.3273015|    39.9998483| -0.5495287787485761|</span>
<span class="line">|1970-01-01T08:00:00.005+08:00| 39.99982991| 116.3273744|    116.327339|   39.99984892| 0.03740486307345578|</span>
<span class="line">|1970-01-01T08:00:00.006+08:00| 39.99982716| 116.3274117|   116.3273759|   39.99984892|  1.0500132150475212|</span>
<span class="line">|1970-01-01T08:00:00.007+08:00|  39.9998259| 116.3274396|   116.3274163|   39.99984953| 0.04583944643116993|</span>
<span class="line">|1970-01-01T08:00:00.008+08:00| 39.99982597| 116.3274668|   116.3274525|   39.99985014|-0.07863708480736269|</span>
<span class="line">|1970-01-01T08:00:00.009+08:00| 39.99982226| 116.3275026|   116.3274915|   39.99985076|                null|</span>
<span class="line">|1970-01-01T08:00:00.010+08:00| 39.99980988| 116.3274967|   116.3275235|   39.99985137|                null|</span>
<span class="line">|1970-01-01T08:00:00.011+08:00| 39.99984873| 116.3274929|   116.3275611|   39.99985199|                null|</span>
<span class="line">|1970-01-01T08:00:00.012+08:00| 39.99981589| 116.3274745|   116.3275974|    39.9998526|                null|</span>
<span class="line">|1970-01-01T08:00:00.013+08:00|  39.9998259| 116.3275095|   116.3276338|   39.99985384|                null|</span>
<span class="line">|1970-01-01T08:00:00.014+08:00| 39.99984873| 116.3274787|   116.3276695|   39.99985446|                null|</span>
<span class="line">|1970-01-01T08:00:00.015+08:00|  39.9998343| 116.3274693|   116.3277045|   39.99985569|                null|</span>
<span class="line">|1970-01-01T08:00:00.016+08:00| 39.99983316| 116.3274941|   116.3277389|   39.99985631|                null|</span>
<span class="line">|1970-01-01T08:00:00.017+08:00| 39.99983311| 116.3275401|   116.3277747|   39.99985693|                null|</span>
<span class="line">|1970-01-01T08:00:00.018+08:00| 39.99984113| 116.3275713|   116.3278041|   39.99985756|                null|</span>
<span class="line">|1970-01-01T08:00:00.019+08:00| 39.99983602| 116.3276003|   116.3278379|   39.99985818|                null|</span>
<span class="line">|1970-01-01T08:00:00.020+08:00|  39.9998355| 116.3276308|   116.3278723|    39.9998588|                null|</span>
<span class="line">|1970-01-01T08:00:00.021+08:00| 40.00012176| 116.3276107|   116.3279026|   39.99985942|                null|</span>
<span class="line">|1970-01-01T08:00:00.022+08:00|  39.9998404| 116.3276684|          null|          null|                null|</span>
<span class="line">|1970-01-01T08:00:00.023+08:00| 39.99983942| 116.3277016|          null|          null|                null|</span>
<span class="line">|1970-01-01T08:00:00.024+08:00| 39.99984113| 116.3277284|          null|          null|                null|</span>
<span class="line">|1970-01-01T08:00:00.025+08:00| 39.99984283| 116.3277562|          null|          null|                null|</span>
<span class="line">+-----------------------------+------------+------------+--------------+--------------+--------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="修复" tabindex="-1"><a class="header-anchor" href="#修复"><span>修复</span></a></h5><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> MasterDetect<span class="token punctuation">(</span>lo<span class="token punctuation">,</span>la<span class="token punctuation">,</span>m_lo<span class="token punctuation">,</span>m_la<span class="token punctuation">,</span>model<span class="token punctuation">,</span><span class="token string">&#39;output_type&#39;</span><span class="token operator">=</span><span class="token string">&#39;repair&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;p&#39;</span><span class="token operator">=</span><span class="token string">&#39;3&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;k&#39;</span><span class="token operator">=</span><span class="token string">&#39;3&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;eta&#39;</span><span class="token operator">=</span><span class="token string">&#39;1.0&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------------------------------------------------------------------------+</span>
<span class="line">|                         Time|MasterDetect(lo,la,m_lo,m_la,model,&#39;output_type&#39;=&#39;repair&#39;,&#39;p&#39;=&#39;3&#39;,&#39;k&#39;=&#39;3&#39;,&#39;eta&#39;=&#39;1.0&#39;)|</span>
<span class="line">+-----------------------------+--------------------------------------------------------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|                                                                            116.327274|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|                                                                            116.327305|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00|                                                                           116.3273291|</span>
<span class="line">|1970-01-01T08:00:00.004+08:00|                                                                            116.327342|</span>
<span class="line">|1970-01-01T08:00:00.005+08:00|                                                                           116.3273744|</span>
<span class="line">|1970-01-01T08:00:00.006+08:00|                                                                           116.3274117|</span>
<span class="line">|1970-01-01T08:00:00.007+08:00|                                                                           116.3274396|</span>
<span class="line">|1970-01-01T08:00:00.008+08:00|                                                                           116.3274668|</span>
<span class="line">|1970-01-01T08:00:00.009+08:00|                                                                           116.3275026|</span>
<span class="line">|1970-01-01T08:00:00.010+08:00|                                                                           116.3274967|</span>
<span class="line">|1970-01-01T08:00:00.011+08:00|                                                                           116.3274929|</span>
<span class="line">|1970-01-01T08:00:00.012+08:00|                                                                           116.3274745|</span>
<span class="line">|1970-01-01T08:00:00.013+08:00|                                                                           116.3275095|</span>
<span class="line">|1970-01-01T08:00:00.014+08:00|                                                                           116.3274787|</span>
<span class="line">|1970-01-01T08:00:00.015+08:00|                                                                           116.3274693|</span>
<span class="line">|1970-01-01T08:00:00.016+08:00|                                                                           116.3274941|</span>
<span class="line">|1970-01-01T08:00:00.017+08:00|                                                                           116.3275401|</span>
<span class="line">|1970-01-01T08:00:00.018+08:00|                                                                           116.3275713|</span>
<span class="line">|1970-01-01T08:00:00.019+08:00|                                                                           116.3276003|</span>
<span class="line">|1970-01-01T08:00:00.020+08:00|                                                                           116.3276308|</span>
<span class="line">|1970-01-01T08:00:00.021+08:00|                                                                           116.3276338|</span>
<span class="line">|1970-01-01T08:00:00.022+08:00|                                                                           116.3276684|</span>
<span class="line">|1970-01-01T08:00:00.023+08:00|                                                                           116.3277016|</span>
<span class="line">|1970-01-01T08:00:00.024+08:00|                                                                           116.3277284|</span>
<span class="line">|1970-01-01T08:00:00.025+08:00|                                                                           116.3277562|</span>
<span class="line">+-----------------------------+--------------------------------------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="异常检测-1" tabindex="-1"><a class="header-anchor" href="#异常检测-1"><span>异常检测</span></a></h5><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> MasterDetect<span class="token punctuation">(</span>lo<span class="token punctuation">,</span>la<span class="token punctuation">,</span>m_lo<span class="token punctuation">,</span>m_la<span class="token punctuation">,</span>model<span class="token punctuation">,</span><span class="token string">&#39;output_type&#39;</span><span class="token operator">=</span><span class="token string">&#39;anomaly&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;p&#39;</span><span class="token operator">=</span><span class="token string">&#39;3&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;k&#39;</span><span class="token operator">=</span><span class="token string">&#39;3&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;eta&#39;</span><span class="token operator">=</span><span class="token string">&#39;1.0&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------------------------------------------------------------------------------+</span>
<span class="line">|                         Time|MasterDetect(lo,la,m_lo,m_la,model,&#39;output_type&#39;=&#39;anomaly&#39;,&#39;p&#39;=&#39;3&#39;,&#39;k&#39;=&#39;3&#39;,&#39;eta&#39;=&#39;1.0&#39;)|</span>
<span class="line">+-----------------------------+---------------------------------------------------------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.004+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.005+08:00|                                                                                   true|</span>
<span class="line">|1970-01-01T08:00:00.006+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.007+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.008+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.009+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.010+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.011+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.012+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.013+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.014+08:00|                                                                                   true|</span>
<span class="line">|1970-01-01T08:00:00.015+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.016+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.017+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.018+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.019+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.020+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.021+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.022+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.023+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.024+08:00|                                                                                  false|</span>
<span class="line">|1970-01-01T08:00:00.025+08:00|                                                                                  false|</span>
<span class="line">+-----------------------------+---------------------------------------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="频域分析" tabindex="-1"><a class="header-anchor" href="#频域分析"><span>频域分析</span></a></h2><h3 id="conv" tabindex="-1"><a class="header-anchor" href="#conv"><span>Conv</span></a></h3><h4 id="注册语句-32" tabindex="-1"><a class="header-anchor" href="#注册语句-32"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> conv <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.frequency.UDTFConv&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-34" tabindex="-1"><a class="header-anchor" href="#函数简介-34"><span>函数简介</span></a></h4><p>本函数对两个输入序列进行卷积，即多项式乘法。</p><p><strong>函数名：</strong> CONV</p><p><strong>输入序列：</strong> 仅支持两个输入序列，类型均为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>输出序列：</strong> 输出单个序列，类型为DOUBLE，它是两个序列卷积的结果。序列的时间戳从0开始，仅用于表示顺序。</p><p><strong>提示：</strong> 输入序列中的<code>NaN</code>将被忽略。</p><h4 id="使用示例-34" tabindex="-1"><a class="header-anchor" href="#使用示例-34"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|                         Time|root.test.d2.s1|root.test.d2.s2|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|            1.0|            7.0|</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|            0.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|            1.0|           null|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> conv<span class="token punctuation">(</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------------------------+</span>
<span class="line">|                         Time|conv(root.test.d2.s1, root.test.d2.s2)|</span>
<span class="line">+-----------------------------+--------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                                   7.0|</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|                                   2.0|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|                                   7.0|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00|                                   2.0|</span>
<span class="line">+-----------------------------+--------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="deconv" tabindex="-1"><a class="header-anchor" href="#deconv"><span>Deconv</span></a></h3><h4 id="注册语句-33" tabindex="-1"><a class="header-anchor" href="#注册语句-33"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> deconv <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.frequency.UDTFDeconv&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-35" tabindex="-1"><a class="header-anchor" href="#函数简介-35"><span>函数简介</span></a></h4><p>本函数对两个输入序列进行去卷积，即多项式除法运算。</p><p><strong>函数名：</strong> DECONV</p><p><strong>输入序列：</strong> 仅支持两个输入序列，类型均为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>result</code>：去卷积的结果，取值为&#39;quotient&#39;或&#39;remainder&#39;，分别对应于去卷积的商和余数。在缺省情况下，输出去卷积的商。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为DOUBLE。它是将第二个序列从第一个序列中去卷积（第一个序列除以第二个序列）的结果。序列的时间戳从0开始，仅用于表示顺序。</p><p><strong>提示：</strong> 输入序列中的<code>NaN</code>将被忽略。</p><h4 id="使用示例-35" tabindex="-1"><a class="header-anchor" href="#使用示例-35"><span>使用示例</span></a></h4><h5 id="计算去卷积的商" tabindex="-1"><a class="header-anchor" href="#计算去卷积的商"><span>计算去卷积的商</span></a></h5><p>当<code>result</code>参数缺省或为&#39;quotient&#39;时，本函数计算去卷积的商。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|                         Time|root.test.d2.s3|root.test.d2.s2|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|            8.0|            7.0|</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|            2.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|            7.0|           null|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00|            2.0|           null|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> deconv<span class="token punctuation">(</span>s3<span class="token punctuation">,</span>s2<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+----------------------------------------+</span>
<span class="line">|                         Time|deconv(root.test.d2.s3, root.test.d2.s2)|</span>
<span class="line">+-----------------------------+----------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                                     1.0|</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|                                     0.0|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|                                     1.0|</span>
<span class="line">+-----------------------------+----------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="计算去卷积的余数" tabindex="-1"><a class="header-anchor" href="#计算去卷积的余数"><span>计算去卷积的余数</span></a></h5><p>当<code>result</code>参数为&#39;remainder&#39;时，本函数计算去卷积的余数。输入序列同上，用于查询的SQL语句如下：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> deconv<span class="token punctuation">(</span>s3<span class="token punctuation">,</span>s2<span class="token punctuation">,</span><span class="token string">&#39;result&#39;</span><span class="token operator">=</span><span class="token string">&#39;remainder&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------------------------------------------------+</span>
<span class="line">|                         Time|deconv(root.test.d2.s3, root.test.d2.s2, &quot;result&quot;=&quot;remainder&quot;)|</span>
<span class="line">+-----------------------------+--------------------------------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                                                           1.0|</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|                                                           0.0|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|                                                           0.0|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00|                                                           0.0|</span>
<span class="line">+-----------------------------+--------------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dwt" tabindex="-1"><a class="header-anchor" href="#dwt"><span>DWT</span></a></h3><h4 id="注册语句-34" tabindex="-1"><a class="header-anchor" href="#注册语句-34"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> dwt <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.frequency.UDTFDWT&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-36" tabindex="-1"><a class="header-anchor" href="#函数简介-36"><span>函数简介</span></a></h4><p>本函数对输入序列进行一维离散小波变换。</p><p><strong>函数名：</strong> DWT</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>method</code>：小波滤波的类型，提供&#39;Haar&#39;, &#39;DB4&#39;, &#39;DB6&#39;, &#39;DB8&#39;，其中DB指代Daubechies。若不设置该参数，则用户需提供小波滤波的系数。不区分大小写。</li><li><code>coef</code>：小波滤波的系数。若提供该参数，请使用英文逗号&#39;,&#39;分割各项，不添加空格或其它符号。</li><li><code>layer</code>：进行变换的次数，最终输出的向量个数等同于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">layer+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">yer</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>.默认取1。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为DOUBLE，长度与输入相等。</p><p><strong>提示：</strong> 输入序列长度必须为2的整数次幂。</p><h4 id="使用示例-36" tabindex="-1"><a class="header-anchor" href="#使用示例-36"><span>使用示例</span></a></h4><h5 id="haar变换" tabindex="-1"><a class="header-anchor" href="#haar变换"><span>Haar变换</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|            0.0|</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|            0.2|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|            1.5|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|            1.2|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|            0.6|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|            1.7|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|            0.8|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|            2.5|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|            2.1|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|            0.0|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|            2.0|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|            1.8|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|            1.2|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|            1.0|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|            1.6|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> dwt<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&quot;method&quot;</span><span class="token operator">=</span><span class="token string">&quot;haar&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------------------+</span>
<span class="line">|                         Time|dwt(root.test.d1.s1, &quot;method&quot;=&quot;haar&quot;)|</span>
<span class="line">+-----------------------------+-------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                  0.14142135834465192|</span>
<span class="line">|1970-01-01T08:00:00.100+08:00|                    1.909188342921157|</span>
<span class="line">|1970-01-01T08:00:00.200+08:00|                   1.6263456473052773|</span>
<span class="line">|1970-01-01T08:00:00.300+08:00|                   1.9798989957517026|</span>
<span class="line">|1970-01-01T08:00:00.400+08:00|                    3.252691126023161|</span>
<span class="line">|1970-01-01T08:00:00.500+08:00|                    1.414213562373095|</span>
<span class="line">|1970-01-01T08:00:00.600+08:00|                   2.1213203435596424|</span>
<span class="line">|1970-01-01T08:00:00.700+08:00|                   1.8384776479437628|</span>
<span class="line">|1970-01-01T08:00:00.800+08:00|                 -0.14142135834465192|</span>
<span class="line">|1970-01-01T08:00:00.900+08:00|                  0.21213200063848547|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|                  -0.7778174761639416|</span>
<span class="line">|1970-01-01T08:00:01.100+08:00|                  -0.8485281289944873|</span>
<span class="line">|1970-01-01T08:00:01.200+08:00|                   0.2828427799095765|</span>
<span class="line">|1970-01-01T08:00:01.300+08:00|                   -1.414213562373095|</span>
<span class="line">|1970-01-01T08:00:01.400+08:00|                  0.42426400127697095|</span>
<span class="line">|1970-01-01T08:00:01.500+08:00|                 -0.42426408557066786|</span>
<span class="line">+-----------------------------+-------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="fft" tabindex="-1"><a class="header-anchor" href="#fft"><span>FFT</span></a></h3><h4 id="注册语句-35" tabindex="-1"><a class="header-anchor" href="#注册语句-35"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> fft <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.frequency.UDTFFFT&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-37" tabindex="-1"><a class="header-anchor" href="#函数简介-37"><span>函数简介</span></a></h4><p>本函数对输入序列进行快速傅里叶变换。</p><p><strong>函数名：</strong> FFT</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>method</code>：傅里叶变换的类型，取值为&#39;uniform&#39;或&#39;nonuniform&#39;，缺省情况下为&#39;uniform&#39;。当取值为&#39;uniform&#39;时，时间戳将被忽略，所有数据点都将被视作等距的，并应用等距快速傅里叶算法；当取值为&#39;nonuniform&#39;时，将根据时间戳应用非等距快速傅里叶算法（未实现）。</li><li><code>result</code>：傅里叶变换的结果，取值为&#39;real&#39;、&#39;imag&#39;、&#39;abs&#39;或&#39;angle&#39;，分别对应于变换结果的实部、虚部、模和幅角。在缺省情况下，输出变换的模。</li><li><code>compress</code>：压缩参数，取值范围(0,1]，是有损压缩时保留的能量比例。在缺省情况下，不进行压缩。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为DOUBLE，长度与输入相等。序列的时间戳从0开始，仅用于表示顺序。</p><p><strong>提示：</strong> 输入序列中的<code>NaN</code>将被忽略。</p><h4 id="使用示例-37" tabindex="-1"><a class="header-anchor" href="#使用示例-37"><span>使用示例</span></a></h4><h5 id="等距傅里叶变换" tabindex="-1"><a class="header-anchor" href="#等距傅里叶变换"><span>等距傅里叶变换</span></a></h5><p>当<code>type</code>参数缺省或为&#39;uniform&#39;时，本函数进行等距傅里叶变换。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|       2.902113|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|      1.1755705|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|     -2.1755705|</span>
<span class="line">|1970-01-01T08:00:03.000+08:00|     -1.9021131|</span>
<span class="line">|1970-01-01T08:00:04.000+08:00|            1.0|</span>
<span class="line">|1970-01-01T08:00:05.000+08:00|      1.9021131|</span>
<span class="line">|1970-01-01T08:00:06.000+08:00|      0.1755705|</span>
<span class="line">|1970-01-01T08:00:07.000+08:00|     -1.1755705|</span>
<span class="line">|1970-01-01T08:00:08.000+08:00|      -0.902113|</span>
<span class="line">|1970-01-01T08:00:09.000+08:00|            0.0|</span>
<span class="line">|1970-01-01T08:00:10.000+08:00|       0.902113|</span>
<span class="line">|1970-01-01T08:00:11.000+08:00|      1.1755705|</span>
<span class="line">|1970-01-01T08:00:12.000+08:00|     -0.1755705|</span>
<span class="line">|1970-01-01T08:00:13.000+08:00|     -1.9021131|</span>
<span class="line">|1970-01-01T08:00:14.000+08:00|           -1.0|</span>
<span class="line">|1970-01-01T08:00:15.000+08:00|      1.9021131|</span>
<span class="line">|1970-01-01T08:00:16.000+08:00|      2.1755705|</span>
<span class="line">|1970-01-01T08:00:17.000+08:00|     -1.1755705|</span>
<span class="line">|1970-01-01T08:00:18.000+08:00|      -2.902113|</span>
<span class="line">|1970-01-01T08:00:19.000+08:00|            0.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> fft<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+----------------------+</span>
<span class="line">|                         Time|  fft(root.test.d1.s1)|</span>
<span class="line">+-----------------------------+----------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                   0.0|</span>
<span class="line">|1970-01-01T08:00:00.001+08:00| 1.2727111142703152E-8|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|  2.385520799101839E-7|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00|  8.723291723972645E-8|</span>
<span class="line">|1970-01-01T08:00:00.004+08:00|    19.999999960195904|</span>
<span class="line">|1970-01-01T08:00:00.005+08:00|     9.999999850988388|</span>
<span class="line">|1970-01-01T08:00:00.006+08:00| 3.2260694930700566E-7|</span>
<span class="line">|1970-01-01T08:00:00.007+08:00|  8.723291605373329E-8|</span>
<span class="line">|1970-01-01T08:00:00.008+08:00|  1.108657103979944E-7|</span>
<span class="line">|1970-01-01T08:00:00.009+08:00| 1.2727110997246171E-8|</span>
<span class="line">|1970-01-01T08:00:00.010+08:00|1.9852334701272664E-23|</span>
<span class="line">|1970-01-01T08:00:00.011+08:00| 1.2727111194499847E-8|</span>
<span class="line">|1970-01-01T08:00:00.012+08:00|  1.108657103979944E-7|</span>
<span class="line">|1970-01-01T08:00:00.013+08:00|  8.723291785769131E-8|</span>
<span class="line">|1970-01-01T08:00:00.014+08:00|  3.226069493070057E-7|</span>
<span class="line">|1970-01-01T08:00:00.015+08:00|     9.999999850988388|</span>
<span class="line">|1970-01-01T08:00:00.016+08:00|    19.999999960195904|</span>
<span class="line">|1970-01-01T08:00:00.017+08:00|  8.723291747109068E-8|</span>
<span class="line">|1970-01-01T08:00:00.018+08:00| 2.3855207991018386E-7|</span>
<span class="line">|1970-01-01T08:00:00.019+08:00| 1.2727112069910878E-8|</span>
<span class="line">+-----------------------------+----------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注：输入序列服从<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>2</mn><mi>π</mi><mi>t</mi><mi mathvariant="normal">/</mi><mn>4</mn><mo stretchy="false">)</mo><mo>+</mo><mn>2</mn><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>2</mn><mi>π</mi><mi>t</mi><mi mathvariant="normal">/</mi><mn>5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y=sin(2\pi t/4)+2sin(2\pi t/5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord mathnormal">t</span><span class="mord">/4</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord mathnormal">t</span><span class="mord">/5</span><span class="mclose">)</span></span></span></span>，长度为20，因此在输出序列中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">k=4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">k=5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5</span></span></span></span>处有尖峰。</p><h5 id="等距傅里叶变换并压缩" tabindex="-1"><a class="header-anchor" href="#等距傅里叶变换并压缩"><span>等距傅里叶变换并压缩</span></a></h5><p>输入序列同上，用于查询的SQL语句如下：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> fft<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">&#39;result&#39;</span><span class="token operator">=</span><span class="token string">&#39;real&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;compress&#39;</span><span class="token operator">=</span><span class="token string">&#39;0.99&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fft<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">&#39;result&#39;</span><span class="token operator">=</span><span class="token string">&#39;imag&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;compress&#39;</span><span class="token operator">=</span><span class="token string">&#39;0.99&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+----------------------+----------------------+</span>
<span class="line">|                         Time|  fft(root.test.d1.s1,|  fft(root.test.d1.s1,|</span>
<span class="line">|                             |      &quot;result&quot;=&quot;real&quot;,|      &quot;result&quot;=&quot;imag&quot;,|</span>
<span class="line">|                             |    &quot;compress&quot;=&quot;0.99&quot;)|    &quot;compress&quot;=&quot;0.99&quot;)|</span>
<span class="line">+-----------------------------+----------------------+----------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                   0.0|                   0.0|</span>
<span class="line">|1970-01-01T08:00:00.001+08:00| -3.932894010461041E-9| 1.2104201863039066E-8|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|-1.4021739447490164E-7| 1.9299268669082926E-7|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00| -7.057291240286645E-8|  5.127422242345858E-8|</span>
<span class="line">|1970-01-01T08:00:00.004+08:00|    19.021130288047125|    -6.180339875198807|</span>
<span class="line">|1970-01-01T08:00:00.005+08:00|     9.999999850988388| 3.501852745067114E-16|</span>
<span class="line">|1970-01-01T08:00:00.019+08:00| -3.932894898639461E-9|-1.2104202549376264E-8|</span>
<span class="line">+-----------------------------+----------------------+----------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注：基于傅里叶变换结果的共轭性质，压缩结果只保留前一半；根据给定的压缩参数，从低频到高频保留数据点，直到保留的能量比例超过该值；保留最后一个数据点以表示序列长度。</p><h3 id="highpass" tabindex="-1"><a class="header-anchor" href="#highpass"><span>HighPass</span></a></h3><h4 id="注册语句-36" tabindex="-1"><a class="header-anchor" href="#注册语句-36"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> highpass <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.frequency.UDTFHighPass&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-38" tabindex="-1"><a class="header-anchor" href="#函数简介-38"><span>函数简介</span></a></h4><p>本函数对输入序列进行高通滤波，提取高于截止频率的分量。输入序列的时间戳将被忽略，所有数据点都将被视作等距的。</p><p><strong>函数名：</strong> HIGHPASS</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>wpass</code>：归一化后的截止频率，取值为(0,1)，不可缺省。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为DOUBLE，它是滤波后的序列，长度与时间戳均与输入一致。</p><p><strong>提示：</strong> 输入序列中的<code>NaN</code>将被忽略。</p><h4 id="使用示例-38" tabindex="-1"><a class="header-anchor" href="#使用示例-38"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|       2.902113|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|      1.1755705|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|     -2.1755705|</span>
<span class="line">|1970-01-01T08:00:03.000+08:00|     -1.9021131|</span>
<span class="line">|1970-01-01T08:00:04.000+08:00|            1.0|</span>
<span class="line">|1970-01-01T08:00:05.000+08:00|      1.9021131|</span>
<span class="line">|1970-01-01T08:00:06.000+08:00|      0.1755705|</span>
<span class="line">|1970-01-01T08:00:07.000+08:00|     -1.1755705|</span>
<span class="line">|1970-01-01T08:00:08.000+08:00|      -0.902113|</span>
<span class="line">|1970-01-01T08:00:09.000+08:00|            0.0|</span>
<span class="line">|1970-01-01T08:00:10.000+08:00|       0.902113|</span>
<span class="line">|1970-01-01T08:00:11.000+08:00|      1.1755705|</span>
<span class="line">|1970-01-01T08:00:12.000+08:00|     -0.1755705|</span>
<span class="line">|1970-01-01T08:00:13.000+08:00|     -1.9021131|</span>
<span class="line">|1970-01-01T08:00:14.000+08:00|           -1.0|</span>
<span class="line">|1970-01-01T08:00:15.000+08:00|      1.9021131|</span>
<span class="line">|1970-01-01T08:00:16.000+08:00|      2.1755705|</span>
<span class="line">|1970-01-01T08:00:17.000+08:00|     -1.1755705|</span>
<span class="line">|1970-01-01T08:00:18.000+08:00|      -2.902113|</span>
<span class="line">|1970-01-01T08:00:19.000+08:00|            0.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> highpass<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&#39;wpass&#39;</span><span class="token operator">=</span><span class="token string">&#39;0.45&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-----------------------------------------+</span>
<span class="line">|                         Time|highpass(root.test.d1.s1, &quot;wpass&quot;=&quot;0.45&quot;)|</span>
<span class="line">+-----------------------------+-----------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                       0.9999999534830373|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|                    1.7462829277628608E-8|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|                      -0.9999999593178128|</span>
<span class="line">|1970-01-01T08:00:03.000+08:00|                   -4.1115269056426626E-8|</span>
<span class="line">|1970-01-01T08:00:04.000+08:00|                       0.9999999925494194|</span>
<span class="line">|1970-01-01T08:00:05.000+08:00|                     3.328126513330016E-8|</span>
<span class="line">|1970-01-01T08:00:06.000+08:00|                      -1.0000000183304454|</span>
<span class="line">|1970-01-01T08:00:07.000+08:00|                    6.260191433311374E-10|</span>
<span class="line">|1970-01-01T08:00:08.000+08:00|                       1.0000000018134796|</span>
<span class="line">|1970-01-01T08:00:09.000+08:00|                   -3.097210911744423E-17|</span>
<span class="line">|1970-01-01T08:00:10.000+08:00|                      -1.0000000018134794|</span>
<span class="line">|1970-01-01T08:00:11.000+08:00|                   -6.260191627862097E-10|</span>
<span class="line">|1970-01-01T08:00:12.000+08:00|                       1.0000000183304454|</span>
<span class="line">|1970-01-01T08:00:13.000+08:00|                    -3.328126501424346E-8|</span>
<span class="line">|1970-01-01T08:00:14.000+08:00|                      -0.9999999925494196|</span>
<span class="line">|1970-01-01T08:00:15.000+08:00|                     4.111526915498874E-8|</span>
<span class="line">|1970-01-01T08:00:16.000+08:00|                       0.9999999593178128|</span>
<span class="line">|1970-01-01T08:00:17.000+08:00|                   -1.7462829341296528E-8|</span>
<span class="line">|1970-01-01T08:00:18.000+08:00|                      -0.9999999534830369|</span>
<span class="line">|1970-01-01T08:00:19.000+08:00|                   -1.035237222742873E-16|</span>
<span class="line">+-----------------------------+-----------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注：输入序列服从<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>2</mn><mi>π</mi><mi>t</mi><mi mathvariant="normal">/</mi><mn>4</mn><mo stretchy="false">)</mo><mo>+</mo><mn>2</mn><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>2</mn><mi>π</mi><mi>t</mi><mi mathvariant="normal">/</mi><mn>5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y=sin(2\pi t/4)+2sin(2\pi t/5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord mathnormal">t</span><span class="mord">/4</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord mathnormal">t</span><span class="mord">/5</span><span class="mclose">)</span></span></span></span>，长度为20，因此高通滤波之后的输出序列服从<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>2</mn><mi>π</mi><mi>t</mi><mi mathvariant="normal">/</mi><mn>4</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y=sin(2\pi t/4)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord mathnormal">t</span><span class="mord">/4</span><span class="mclose">)</span></span></span></span>。</p><h3 id="ifft" tabindex="-1"><a class="header-anchor" href="#ifft"><span>IFFT</span></a></h3><h4 id="注册语句-37" tabindex="-1"><a class="header-anchor" href="#注册语句-37"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> ifft <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.frequency.UDTFIFFT&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-39" tabindex="-1"><a class="header-anchor" href="#函数简介-39"><span>函数简介</span></a></h4><p>本函数将输入的两个序列作为实部和虚部视作一个复数，进行逆快速傅里叶变换，并输出结果的实部。输入数据的格式参见<code>FFT</code>函数的输出，并支持以<code>FFT</code>函数压缩后的输出作为本函数的输入。</p><p><strong>函数名：</strong> IFFT</p><p><strong>输入序列：</strong> 仅支持两个输入序列，类型均为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>start</code>：输出序列的起始时刻，是一个格式为&#39;yyyy-MM-dd HH:mm:ss&#39;的时间字符串。在缺省情况下，为&#39;1970-01-01 08:00:00&#39;。</li><li><code>interval</code>：输出序列的时间间隔，是一个有单位的正数。目前支持五种单位，分别是&#39;ms&#39;（毫秒）、&#39;s&#39;（秒）、&#39;m&#39;（分钟）、&#39;h&#39;（小时）和&#39;d&#39;（天）。在缺省情况下，为1s。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为DOUBLE。该序列是一个等距时间序列，它的值是将两个输入序列依次作为实部和虚部进行逆快速傅里叶变换的结果。</p><p><strong>提示：</strong> 如果某行数据中包含空值或<code>NaN</code>，该行数据将会被忽略。</p><h4 id="使用示例-39" tabindex="-1"><a class="header-anchor" href="#使用示例-39"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+----------------------+----------------------+</span>
<span class="line">|                         Time|       root.test.d1.re|       root.test.d1.im|</span>
<span class="line">+-----------------------------+----------------------+----------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                   0.0|                   0.0|</span>
<span class="line">|1970-01-01T08:00:00.001+08:00| -3.932894010461041E-9| 1.2104201863039066E-8|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|-1.4021739447490164E-7| 1.9299268669082926E-7|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00| -7.057291240286645E-8|  5.127422242345858E-8|</span>
<span class="line">|1970-01-01T08:00:00.004+08:00|    19.021130288047125|    -6.180339875198807|</span>
<span class="line">|1970-01-01T08:00:00.005+08:00|     9.999999850988388| 3.501852745067114E-16|</span>
<span class="line">|1970-01-01T08:00:00.019+08:00| -3.932894898639461E-9|-1.2104202549376264E-8|</span>
<span class="line">+-----------------------------+----------------------+----------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> ifft<span class="token punctuation">(</span>re<span class="token punctuation">,</span> im<span class="token punctuation">,</span> <span class="token string">&#39;interval&#39;</span><span class="token operator">=</span><span class="token string">&#39;1m&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;start&#39;</span><span class="token operator">=</span><span class="token string">&#39;2021-01-01 00:00:00&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------------------------------------+</span>
<span class="line">|                         Time|ifft(root.test.d1.re, root.test.d1.im, &quot;interval&quot;=&quot;1m&quot;,|</span>
<span class="line">|                             |                         &quot;start&quot;=&quot;2021-01-01 00:00:00&quot;)|</span>
<span class="line">+-----------------------------+-------------------------------------------------------+</span>
<span class="line">|2021-01-01T00:00:00.000+08:00|                                      2.902112992431231|</span>
<span class="line">|2021-01-01T00:01:00.000+08:00|                                     1.1755704705132448|</span>
<span class="line">|2021-01-01T00:02:00.000+08:00|                                     -2.175570513757101|</span>
<span class="line">|2021-01-01T00:03:00.000+08:00|                                    -1.9021130389094498|</span>
<span class="line">|2021-01-01T00:04:00.000+08:00|                                     0.9999999925494194|</span>
<span class="line">|2021-01-01T00:05:00.000+08:00|                                      1.902113046743454|</span>
<span class="line">|2021-01-01T00:06:00.000+08:00|                                    0.17557053610884188|</span>
<span class="line">|2021-01-01T00:07:00.000+08:00|                                    -1.1755704886020932|</span>
<span class="line">|2021-01-01T00:08:00.000+08:00|                                    -0.9021130371347148|</span>
<span class="line">|2021-01-01T00:09:00.000+08:00|                                  3.552713678800501E-16|</span>
<span class="line">|2021-01-01T00:10:00.000+08:00|                                     0.9021130371347154|</span>
<span class="line">|2021-01-01T00:11:00.000+08:00|                                     1.1755704886020932|</span>
<span class="line">|2021-01-01T00:12:00.000+08:00|                                   -0.17557053610884144|</span>
<span class="line">|2021-01-01T00:13:00.000+08:00|                                     -1.902113046743454|</span>
<span class="line">|2021-01-01T00:14:00.000+08:00|                                    -0.9999999925494196|</span>
<span class="line">|2021-01-01T00:15:00.000+08:00|                                     1.9021130389094498|</span>
<span class="line">|2021-01-01T00:16:00.000+08:00|                                     2.1755705137571004|</span>
<span class="line">|2021-01-01T00:17:00.000+08:00|                                    -1.1755704705132448|</span>
<span class="line">|2021-01-01T00:18:00.000+08:00|                                     -2.902112992431231|</span>
<span class="line">|2021-01-01T00:19:00.000+08:00|                                 -3.552713678800501E-16|</span>
<span class="line">+-----------------------------+-------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lowpass" tabindex="-1"><a class="header-anchor" href="#lowpass"><span>LowPass</span></a></h3><h4 id="注册语句-38" tabindex="-1"><a class="header-anchor" href="#注册语句-38"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> lowpass <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.frequency.UDTFLowPass&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-40" tabindex="-1"><a class="header-anchor" href="#函数简介-40"><span>函数简介</span></a></h4><p>本函数对输入序列进行低通滤波，提取低于截止频率的分量。输入序列的时间戳将被忽略，所有数据点都将被视作等距的。</p><p><strong>函数名：</strong> LOWPASS</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>wpass</code>：归一化后的截止频率，取值为(0,1)，不可缺省。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为DOUBLE，它是滤波后的序列，长度与时间戳均与输入一致。</p><p><strong>提示：</strong> 输入序列中的<code>NaN</code>将被忽略。</p><h4 id="使用示例-40" tabindex="-1"><a class="header-anchor" href="#使用示例-40"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|       2.902113|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|      1.1755705|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|     -2.1755705|</span>
<span class="line">|1970-01-01T08:00:03.000+08:00|     -1.9021131|</span>
<span class="line">|1970-01-01T08:00:04.000+08:00|            1.0|</span>
<span class="line">|1970-01-01T08:00:05.000+08:00|      1.9021131|</span>
<span class="line">|1970-01-01T08:00:06.000+08:00|      0.1755705|</span>
<span class="line">|1970-01-01T08:00:07.000+08:00|     -1.1755705|</span>
<span class="line">|1970-01-01T08:00:08.000+08:00|      -0.902113|</span>
<span class="line">|1970-01-01T08:00:09.000+08:00|            0.0|</span>
<span class="line">|1970-01-01T08:00:10.000+08:00|       0.902113|</span>
<span class="line">|1970-01-01T08:00:11.000+08:00|      1.1755705|</span>
<span class="line">|1970-01-01T08:00:12.000+08:00|     -0.1755705|</span>
<span class="line">|1970-01-01T08:00:13.000+08:00|     -1.9021131|</span>
<span class="line">|1970-01-01T08:00:14.000+08:00|           -1.0|</span>
<span class="line">|1970-01-01T08:00:15.000+08:00|      1.9021131|</span>
<span class="line">|1970-01-01T08:00:16.000+08:00|      2.1755705|</span>
<span class="line">|1970-01-01T08:00:17.000+08:00|     -1.1755705|</span>
<span class="line">|1970-01-01T08:00:18.000+08:00|      -2.902113|</span>
<span class="line">|1970-01-01T08:00:19.000+08:00|            0.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> lowpass<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&#39;wpass&#39;</span><span class="token operator">=</span><span class="token string">&#39;0.45&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+----------------------------------------+</span>
<span class="line">|                         Time|lowpass(root.test.d1.s1, &quot;wpass&quot;=&quot;0.45&quot;)|</span>
<span class="line">+-----------------------------+----------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                      1.9021130073323922|</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|                      1.1755704705132448|</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|                     -1.1755705286582614|</span>
<span class="line">|1970-01-01T08:00:03.000+08:00|                     -1.9021130389094498|</span>
<span class="line">|1970-01-01T08:00:04.000+08:00|                    7.450580419288145E-9|</span>
<span class="line">|1970-01-01T08:00:05.000+08:00|                       1.902113046743454|</span>
<span class="line">|1970-01-01T08:00:06.000+08:00|                      1.1755705212076808|</span>
<span class="line">|1970-01-01T08:00:07.000+08:00|                     -1.1755704886020932|</span>
<span class="line">|1970-01-01T08:00:08.000+08:00|                     -1.9021130222335536|</span>
<span class="line">|1970-01-01T08:00:09.000+08:00|                   3.552713678800501E-16|</span>
<span class="line">|1970-01-01T08:00:10.000+08:00|                      1.9021130222335536|</span>
<span class="line">|1970-01-01T08:00:11.000+08:00|                      1.1755704886020932|</span>
<span class="line">|1970-01-01T08:00:12.000+08:00|                     -1.1755705212076801|</span>
<span class="line">|1970-01-01T08:00:13.000+08:00|                      -1.902113046743454|</span>
<span class="line">|1970-01-01T08:00:14.000+08:00|                    -7.45058112983088E-9|</span>
<span class="line">|1970-01-01T08:00:15.000+08:00|                      1.9021130389094498|</span>
<span class="line">|1970-01-01T08:00:16.000+08:00|                      1.1755705286582616|</span>
<span class="line">|1970-01-01T08:00:17.000+08:00|                     -1.1755704705132448|</span>
<span class="line">|1970-01-01T08:00:18.000+08:00|                     -1.9021130073323924|</span>
<span class="line">|1970-01-01T08:00:19.000+08:00|                  -2.664535259100376E-16|</span>
<span class="line">+-----------------------------+----------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注：输入序列服从<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>2</mn><mi>π</mi><mi>t</mi><mi mathvariant="normal">/</mi><mn>4</mn><mo stretchy="false">)</mo><mo>+</mo><mn>2</mn><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>2</mn><mi>π</mi><mi>t</mi><mi mathvariant="normal">/</mi><mn>5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y=sin(2\pi t/4)+2sin(2\pi t/5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord mathnormal">t</span><span class="mord">/4</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord mathnormal">t</span><span class="mord">/5</span><span class="mclose">)</span></span></span></span>，长度为20，因此低通滤波之后的输出序列服从<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>2</mn><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>2</mn><mi>π</mi><mi>t</mi><mi mathvariant="normal">/</mi><mn>5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y=2sin(2\pi t/5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord mathnormal">t</span><span class="mord">/5</span><span class="mclose">)</span></span></span></span>。</p><h2 id="envelope" tabindex="-1"><a class="header-anchor" href="#envelope"><span>Envelope</span></a></h2><h3 id="函数简介-41" tabindex="-1"><a class="header-anchor" href="#函数简介-41"><span>函数简介</span></a></h3><p>本函数通过输入一维浮点数数组和用户指定的调制频率，实现对信号的解调和包络提取。解调的目标是从复杂的信号中提取感兴趣的部分，使其更易理解。比如通过解调可以找到信号的包络，即振幅的变化趋势。</p><p><strong>函数名：</strong> Envelope</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>frequency</code>：频率（选填，正数。不填此参数，系统会基于序列对应时间的时间间隔来推断频率）。</li><li><code>amplification</code>: 扩增倍数（选填，正整数。输出Time列的结果为正整数的集合，不会输出小数。当频率小1时，可通过此参数对频率进行扩增以展示正常的结果）。</li></ul><p><strong>输出序列：</strong></p><ul><li><p><code>Time</code>： 该列返回的值的含义是频率而并非时间，如果输出的格式为时间格式（如：1970-01-01T08:00:19.000+08:00），请将其转为时间戳值。</p></li><li><p><code>Envelope(Path, &#39;frequency&#39;=&#39;{frequency}&#39;)</code>：输出单个序列，类型为DOUBLE，它是包络分析之后的结果。</p></li></ul><p><strong>提示：</strong> 当解调的原始序列的值不连续时，本函数会视为连续处理，建议被分析的时间序列是一段值完整的时间序列。同时建议指定开始时间与结束时间。</p><h3 id="使用示例-41" tabindex="-1"><a class="header-anchor" href="#使用示例-41"><span>使用示例</span></a></h3><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|1970-01-01T08:00:01.000+08:00|       1.0     |</span>
<span class="line">|1970-01-01T08:00:02.000+08:00|       2.0     |</span>
<span class="line">|1970-01-01T08:00:03.000+08:00|       3.0     |</span>
<span class="line">|1970-01-01T08:00:04.000+08:00|       4.0     |</span>
<span class="line">|1970-01-01T08:00:05.000+08:00|       5.0     |</span>
<span class="line">|1970-01-01T08:00:06.000+08:00|       6.0     |</span>
<span class="line">|1970-01-01T08:00:07.000+08:00|       7.0     |</span>
<span class="line">|1970-01-01T08:00:08.000+08:00|       8.0     |</span>
<span class="line">|1970-01-01T08:00:09.000+08:00|       9.0     |</span>
<span class="line">|1970-01-01T08:00:10.000+08:00|       10.0    |</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">set</span> time_display_type<span class="token operator">=</span>long<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">select</span> envelope<span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span>envelope<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&#39;frequency&#39;</span><span class="token operator">=</span><span class="token string">&#39;1000&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>envelope<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&#39;amplification&#39;</span><span class="token operator">=</span><span class="token string">&#39;10&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+----+-------------------------+---------------------------------------------+-----------------------------------------------+</span>
<span class="line">|Time|envelope(root.test.d1.s1)|envelope(root.test.d1.s1, &quot;frequency&quot;=&quot;1000&quot;)|envelope(root.test.d1.s1, &quot;amplification&quot;=&quot;10&quot;)|</span>
<span class="line">+----+-------------------------+---------------------------------------------+-----------------------------------------------+</span>
<span class="line">|   0|        6.284350808484124|                            6.284350808484124|                              6.284350808484124|</span>
<span class="line">| 100|       1.5581923657404393|                           1.5581923657404393|                                           null|</span>
<span class="line">| 200|       0.8503211038340728|                           0.8503211038340728|                                           null|</span>
<span class="line">| 300|        0.512808785945551|                            0.512808785945551|                                           null|</span>
<span class="line">| 400|      0.26361156774506744|                          0.26361156774506744|                                           null|</span>
<span class="line">|1000|                     null|                                         null|                             1.5581923657404393|</span>
<span class="line">|2000|                     null|                                         null|                             0.8503211038340728|</span>
<span class="line">|3000|                     null|                                         null|                              0.512808785945551|</span>
<span class="line">|4000|                     null|                                         null|                            0.26361156774506744|</span>
<span class="line">+----+-------------------------+---------------------------------------------+-----------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="数据匹配" tabindex="-1"><a class="header-anchor" href="#数据匹配"><span>数据匹配</span></a></h2><h3 id="cov" tabindex="-1"><a class="header-anchor" href="#cov"><span>Cov</span></a></h3><h4 id="注册语句-39" tabindex="-1"><a class="header-anchor" href="#注册语句-39"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> cov <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dmatch.UDAFCov&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-42" tabindex="-1"><a class="header-anchor" href="#函数简介-42"><span>函数简介</span></a></h4><p>本函数用于计算两列数值型数据的总体协方差。</p><p><strong>函数名：</strong> COV</p><p><strong>输入序列：</strong> 仅支持两个输入序列，类型均为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>输出序列：</strong> 输出单个序列，类型为 DOUBLE。序列仅包含一个时间戳为 0、值为总体协方差的数据点。</p><p><strong>提示：</strong></p><ul><li>如果某行数据中包含空值、缺失值或<code>NaN</code>，该行数据将会被忽略；</li><li>如果数据中所有的行都被忽略，函数将会输出<code>NaN</code>。</li></ul><h4 id="使用示例-42" tabindex="-1"><a class="header-anchor" href="#使用示例-42"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|                         Time|root.test.d2.s1|root.test.d2.s2|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          100.0|          101.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|          101.0|           null|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          102.0|          101.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          104.0|          102.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          126.0|          102.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          108.0|          103.0|</span>
<span class="line">|2020-01-01T00:00:12.000+08:00|           null|          103.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|          112.0|          104.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          113.0|           null|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          114.0|          104.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          116.0|          105.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|          118.0|          105.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          100.0|          106.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|          124.0|          108.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|          126.0|          108.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|            NaN|          108.0|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> cov<span class="token punctuation">(</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------------------+</span>
<span class="line">|                         Time|cov(root.test.d2.s1, root.test.d2.s2)|</span>
<span class="line">+-----------------------------+-------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                   12.291666666666666|</span>
<span class="line">+-----------------------------+-------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dtw" tabindex="-1"><a class="header-anchor" href="#dtw"><span>Dtw</span></a></h3><h4 id="注册语句-40" tabindex="-1"><a class="header-anchor" href="#注册语句-40"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> dtw <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dmatch.UDAFDtw&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-43" tabindex="-1"><a class="header-anchor" href="#函数简介-43"><span>函数简介</span></a></h4><p>本函数用于计算两列数值型数据的 DTW 距离。</p><p><strong>函数名：</strong> DTW</p><p><strong>输入序列：</strong> 仅支持两个输入序列，类型均为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>输出序列：</strong> 输出单个序列，类型为 DOUBLE。序列仅包含一个时间戳为 0、值为两个时间序列的 DTW 距离值。</p><p><strong>提示：</strong></p><ul><li>如果某行数据中包含空值、缺失值或<code>NaN</code>，该行数据将会被忽略；</li><li>如果数据中所有的行都被忽略，函数将会输出 0。</li></ul><h4 id="使用示例-43" tabindex="-1"><a class="header-anchor" href="#使用示例-43"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|                         Time|root.test.d2.s1|root.test.d2.s2|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.004+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.005+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.006+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.007+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.008+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.009+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.010+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.011+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.012+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.013+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.014+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.015+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.016+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.017+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.018+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.019+08:00|            1.0|            2.0|</span>
<span class="line">|1970-01-01T08:00:00.020+08:00|            1.0|            2.0|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> dtw<span class="token punctuation">(</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------------------+</span>
<span class="line">|                         Time|dtw(root.test.d2.s1, root.test.d2.s2)|</span>
<span class="line">+-----------------------------+-------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                                 20.0|</span>
<span class="line">+-----------------------------+-------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="pearson" tabindex="-1"><a class="header-anchor" href="#pearson"><span>Pearson</span></a></h3><h4 id="注册语句-41" tabindex="-1"><a class="header-anchor" href="#注册语句-41"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> pearson <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dmatch.UDAFPearson&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-44" tabindex="-1"><a class="header-anchor" href="#函数简介-44"><span>函数简介</span></a></h4><p>本函数用于计算两列数值型数据的皮尔森相关系数。</p><p><strong>函数名：</strong> PEARSON</p><p><strong>输入序列：</strong> 仅支持两个输入序列，类型均为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>输出序列：</strong> 输出单个序列，类型为 DOUBLE。序列仅包含一个时间戳为 0、值为皮尔森相关系数的数据点。</p><p><strong>提示：</strong></p><ul><li>如果某行数据中包含空值、缺失值或<code>NaN</code>，该行数据将会被忽略；</li><li>如果数据中所有的行都被忽略，函数将会输出<code>NaN</code>。</li></ul><h4 id="使用示例-44" tabindex="-1"><a class="header-anchor" href="#使用示例-44"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|                         Time|root.test.d2.s1|root.test.d2.s2|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          100.0|          101.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|          101.0|           null|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          102.0|          101.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          104.0|          102.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          126.0|          102.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          108.0|          103.0|</span>
<span class="line">|2020-01-01T00:00:12.000+08:00|           null|          103.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|          112.0|          104.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          113.0|           null|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          114.0|          104.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          116.0|          105.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|          118.0|          105.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          100.0|          106.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|          124.0|          108.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|          126.0|          108.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|            NaN|          108.0|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> pearson<span class="token punctuation">(</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-----------------------------------------+</span>
<span class="line">|                         Time|pearson(root.test.d2.s1, root.test.d2.s2)|</span>
<span class="line">+-----------------------------+-----------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.000+08:00|                       0.5630881927754872|</span>
<span class="line">+-----------------------------+-----------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ptnsym" tabindex="-1"><a class="header-anchor" href="#ptnsym"><span>PtnSym</span></a></h3><h4 id="注册语句-42" tabindex="-1"><a class="header-anchor" href="#注册语句-42"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> ptnsym <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dmatch.UDTFPtnSym&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-45" tabindex="-1"><a class="header-anchor" href="#函数简介-45"><span>函数简介</span></a></h4><p>本函数用于寻找序列中所有对称度小于阈值的对称子序列。对称度通过 DTW 计算，值越小代表序列对称性越高。</p><p><strong>函数名：</strong> PTNSYM</p><p><strong>输入序列：</strong> 仅支持一个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>window</code>：对称子序列的长度，是一个正整数，默认值为 10。</li><li><code>threshold</code>：对称度阈值，是一个非负数，只有对称度小于等于该值的对称子序列才会被输出。在缺省情况下，所有的子序列都会被输出。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为 DOUBLE。序列中的每一个数据点对应于一个对称子序列，时间戳为子序列的起始时刻，值为对称度。</p><h4 id="使用示例-45" tabindex="-1"><a class="header-anchor" href="#使用示例-45"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s4|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2021-01-01T12:00:00.000+08:00|            1.0|</span>
<span class="line">|2021-01-01T12:00:01.000+08:00|            2.0|</span>
<span class="line">|2021-01-01T12:00:02.000+08:00|            3.0|</span>
<span class="line">|2021-01-01T12:00:03.000+08:00|            2.0|</span>
<span class="line">|2021-01-01T12:00:04.000+08:00|            1.0|</span>
<span class="line">|2021-01-01T12:00:05.000+08:00|            1.0|</span>
<span class="line">|2021-01-01T12:00:06.000+08:00|            1.0|</span>
<span class="line">|2021-01-01T12:00:07.000+08:00|            1.0|</span>
<span class="line">|2021-01-01T12:00:08.000+08:00|            2.0|</span>
<span class="line">|2021-01-01T12:00:09.000+08:00|            3.0|</span>
<span class="line">|2021-01-01T12:00:10.000+08:00|            2.0|</span>
<span class="line">|2021-01-01T12:00:11.000+08:00|            1.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> ptnsym<span class="token punctuation">(</span>s4<span class="token punctuation">,</span> <span class="token string">&#39;window&#39;</span><span class="token operator">=</span><span class="token string">&#39;5&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;threshold&#39;</span><span class="token operator">=</span><span class="token string">&#39;0&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------------------------------------------------+</span>
<span class="line">|                         Time|ptnsym(root.test.d1.s4, &quot;window&quot;=&quot;5&quot;, &quot;threshold&quot;=&quot;0&quot;)|</span>
<span class="line">+-----------------------------+------------------------------------------------------+</span>
<span class="line">|2021-01-01T12:00:00.000+08:00|                                                   0.0|</span>
<span class="line">|2021-01-01T12:00:07.000+08:00|                                                   0.0|</span>
<span class="line">+-----------------------------+------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="xcorr" tabindex="-1"><a class="header-anchor" href="#xcorr"><span>XCorr</span></a></h3><h4 id="注册语句-43" tabindex="-1"><a class="header-anchor" href="#注册语句-43"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> xcorr <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dmatch.UDTFXCorr&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-46" tabindex="-1"><a class="header-anchor" href="#函数简介-46"><span>函数简介</span></a></h4><p>本函数用于计算两条时间序列的互相关函数值，<br> 对离散序列而言，互相关函数可以表示为</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>C</mi><mi>R</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>∑</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><msub><mi>S</mi><mn>1</mn></msub><mo stretchy="false">[</mo><mi>m</mi><mo stretchy="false">]</mo><msub><mi>S</mi><mn>2</mn></msub><mo stretchy="false">[</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex"> CR(n) = \frac{1}{N} \sum_{m=1}^N S_1[m]S_2[m+n] </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">CR</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.0954em;vertical-align:-1.2671em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8829em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2671em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal">m</span><span class="mclose">]</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mclose">]</span></span></span></span></span></p><p>常用于表征两条序列在不同对齐条件下的相似度。</p><p><strong>函数名：</strong> XCORR</p><p><strong>输入序列：</strong> 仅支持两个输入序列，类型均为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>输出序列：</strong> 输出单个序列，类型为 DOUBLE。序列中共包含<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>N</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2N-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>个数据点，<br> 其中正中心的值为两条序列按照预先对齐的结果计算的互相关系数（即等于以上公式的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>R</mi><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">CR(0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">CR</span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span></span></span></span>），<br> 前半部分的值表示将后一条输入序列向前平移时计算的互相关系数，<br> 直至两条序列没有重合的数据点（不包含完全分离时的结果<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>R</mi><mo stretchy="false">(</mo><mo>−</mo><mi>N</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">CR(-N)=0.0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">CR</span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.0</span></span></span></span>），<br> 后半部分类似。<br> 用公式可表示为（所有序列的索引从1开始计数）：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>O</mi><mi>S</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mi>C</mi><mi>R</mi><mo stretchy="false">(</mo><mo>−</mo><mi>N</mi><mo>+</mo><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>∑</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></munderover><msub><mi>S</mi><mn>1</mn></msub><mo stretchy="false">[</mo><mi>m</mi><mo stretchy="false">]</mo><msub><mi>S</mi><mn>2</mn></msub><mo stretchy="false">[</mo><mi>N</mi><mo>−</mo><mi>i</mi><mo>+</mo><mi>m</mi><mo stretchy="false">]</mo><mo separator="true">,</mo><mtext> </mtext><mi>i</mi><mi>f</mi><mtext> </mtext><mi>i</mi><mo>&lt;</mo><mo>=</mo><mi>N</mi></mrow><annotation encoding="application/x-tex"> OS[i] = CR(-N+i) = \frac{1}{N} \sum_{m=1}^{i} S_1[m]S_2[N-i+m],\ if\ i &lt;= N </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">OS</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">CR</span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.0788em;vertical-align:-1.2671em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8117em;"><span style="top:-1.8829em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2671em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal">m</span><span class="mclose">]</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></span></p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>O</mi><mi>S</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mi>C</mi><mi>R</mi><mo stretchy="false">(</mo><mi>i</mi><mo>−</mo><mi>N</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>∑</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mrow><mn>2</mn><mi>N</mi><mo>−</mo><mi>i</mi></mrow></munderover><msub><mi>S</mi><mn>1</mn></msub><mo stretchy="false">[</mo><mi>i</mi><mo>−</mo><mi>N</mi><mo>+</mo><mi>m</mi><mo stretchy="false">]</mo><msub><mi>S</mi><mn>2</mn></msub><mo stretchy="false">[</mo><mi>m</mi><mo stretchy="false">]</mo><mo separator="true">,</mo><mtext> </mtext><mi>i</mi><mi>f</mi><mtext> </mtext><mi>i</mi><mo>&gt;</mo><mi>N</mi></mrow><annotation encoding="application/x-tex"> OS[i] = CR(i-N) = \frac{1}{N} \sum_{m=1}^{2N-i} S_1[i-N+m]S_2[m],\ if\ i &gt; N </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">OS</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">CR</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.0954em;vertical-align:-1.2671em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8829em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2671em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mclose">]</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal">m</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></span></p><p><strong>提示：</strong></p><ul><li>两条序列中的<code>null</code> 和<code>NaN</code> 值会被忽略，在计算中表现为 0。</li></ul><h4 id="使用示例-46" tabindex="-1"><a class="header-anchor" href="#使用示例-46"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|root.test.d1.s2|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|2020-01-01T00:00:01.000+08:00|           null|              6|</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|              2|              7|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|              3|            NaN|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|              4|              9|</span>
<span class="line">|2020-01-01T00:00:05.000+08:00|              5|             10|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> xcorr<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">05</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------------------------------+</span>
<span class="line">|                         Time|xcorr(root.test.d1.s1, root.test.d1.s2)|</span>
<span class="line">+-----------------------------+---------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|                                    0.0|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|                                    4.0|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00|                                    9.6|</span>
<span class="line">|1970-01-01T08:00:00.004+08:00|                                   13.4|</span>
<span class="line">|1970-01-01T08:00:00.005+08:00|                                   20.0|</span>
<span class="line">|1970-01-01T08:00:00.006+08:00|                                   15.6|</span>
<span class="line">|1970-01-01T08:00:00.007+08:00|                                    9.2|</span>
<span class="line">|1970-01-01T08:00:00.008+08:00|                                   11.8|</span>
<span class="line">|1970-01-01T08:00:00.009+08:00|                                    6.0|</span>
<span class="line">+-----------------------------+---------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="数据修复" tabindex="-1"><a class="header-anchor" href="#数据修复"><span>数据修复</span></a></h2><h3 id="timestamprepair" tabindex="-1"><a class="header-anchor" href="#timestamprepair"><span>TimestampRepair</span></a></h3><h4 id="注册语句-44" tabindex="-1"><a class="header-anchor" href="#注册语句-44"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> timestamprepair <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.drepair.UDTFTimestampRepair&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="函数简介-47" tabindex="-1"><a class="header-anchor" href="#函数简介-47"><span>函数简介</span></a></h3><p>本函数用于时间戳修复。根据给定的标准时间间隔，采用最小化修复代价的方法，通过对数据时间戳的微调，将原本时间戳间隔不稳定的数据修复为严格等间隔的数据。在未给定标准时间间隔的情况下，本函数将使用时间间隔的中位数 (median)、众数 (mode) 或聚类中心 (cluster) 来推算标准时间间隔。</p><p><strong>函数名：</strong> TIMESTAMPREPAIR</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>interval</code>: 标准时间间隔（单位是毫秒），是一个正整数。在缺省情况下，将根据指定的方法推算。</li><li><code>method</code>：推算标准时间间隔的方法，取值为 &#39;median&#39;, &#39;mode&#39; 或 &#39;cluster&#39;，仅在<code>interval</code>缺省时有效。在缺省情况下，将使用中位数方法进行推算。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型与输入序列相同。该序列是修复后的输入序列。</p><h3 id="使用示例-47" tabindex="-1"><a class="header-anchor" href="#使用示例-47"><span>使用示例</span></a></h3><h4 id="指定标准时间间隔" tabindex="-1"><a class="header-anchor" href="#指定标准时间间隔"><span>指定标准时间间隔</span></a></h4><p>在给定<code>interval</code>参数的情况下，本函数将按照指定的标准时间间隔进行修复。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d2.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2021-07-01T12:00:00.000+08:00|            1.0|</span>
<span class="line">|2021-07-01T12:00:10.000+08:00|            2.0|</span>
<span class="line">|2021-07-01T12:00:19.000+08:00|            3.0|</span>
<span class="line">|2021-07-01T12:00:30.000+08:00|            4.0|</span>
<span class="line">|2021-07-01T12:00:40.000+08:00|            5.0|</span>
<span class="line">|2021-07-01T12:00:50.000+08:00|            6.0|</span>
<span class="line">|2021-07-01T12:01:01.000+08:00|            7.0|</span>
<span class="line">|2021-07-01T12:01:11.000+08:00|            8.0|</span>
<span class="line">|2021-07-01T12:01:21.000+08:00|            9.0|</span>
<span class="line">|2021-07-01T12:01:31.000+08:00|           10.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> timestamprepair<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&#39;interval&#39;</span><span class="token operator">=</span><span class="token string">&#39;10000&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+----------------------------------------------------+</span>
<span class="line">|                         Time|timestamprepair(root.test.d2.s1, &quot;interval&quot;=&quot;10000&quot;)|</span>
<span class="line">+-----------------------------+----------------------------------------------------+</span>
<span class="line">|2021-07-01T12:00:00.000+08:00|                                                 1.0|</span>
<span class="line">|2021-07-01T12:00:10.000+08:00|                                                 2.0|</span>
<span class="line">|2021-07-01T12:00:20.000+08:00|                                                 3.0|</span>
<span class="line">|2021-07-01T12:00:30.000+08:00|                                                 4.0|</span>
<span class="line">|2021-07-01T12:00:40.000+08:00|                                                 5.0|</span>
<span class="line">|2021-07-01T12:00:50.000+08:00|                                                 6.0|</span>
<span class="line">|2021-07-01T12:01:00.000+08:00|                                                 7.0|</span>
<span class="line">|2021-07-01T12:01:10.000+08:00|                                                 8.0|</span>
<span class="line">|2021-07-01T12:01:20.000+08:00|                                                 9.0|</span>
<span class="line">|2021-07-01T12:01:30.000+08:00|                                                10.0|</span>
<span class="line">+-----------------------------+----------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="自动推算标准时间间隔" tabindex="-1"><a class="header-anchor" href="#自动推算标准时间间隔"><span>自动推算标准时间间隔</span></a></h4><p>如果<code>interval</code>参数没有给定，本函数将按照推算的标准时间间隔进行修复。</p><p>输入序列同上，用于查询的 SQL 语句如下：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> timestamprepair<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------------------+</span>
<span class="line">|                         Time|timestamprepair(root.test.d2.s1)|</span>
<span class="line">+-----------------------------+--------------------------------+</span>
<span class="line">|2021-07-01T12:00:00.000+08:00|                             1.0|</span>
<span class="line">|2021-07-01T12:00:10.000+08:00|                             2.0|</span>
<span class="line">|2021-07-01T12:00:20.000+08:00|                             3.0|</span>
<span class="line">|2021-07-01T12:00:30.000+08:00|                             4.0|</span>
<span class="line">|2021-07-01T12:00:40.000+08:00|                             5.0|</span>
<span class="line">|2021-07-01T12:00:50.000+08:00|                             6.0|</span>
<span class="line">|2021-07-01T12:01:00.000+08:00|                             7.0|</span>
<span class="line">|2021-07-01T12:01:10.000+08:00|                             8.0|</span>
<span class="line">|2021-07-01T12:01:20.000+08:00|                             9.0|</span>
<span class="line">|2021-07-01T12:01:30.000+08:00|                            10.0|</span>
<span class="line">+-----------------------------+--------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="valuefill" tabindex="-1"><a class="header-anchor" href="#valuefill"><span>ValueFill</span></a></h3><h4 id="注册语句-45" tabindex="-1"><a class="header-anchor" href="#注册语句-45"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> valuefill <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.drepair.UDTFValueFill&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-48" tabindex="-1"><a class="header-anchor" href="#函数简介-48"><span>函数简介</span></a></h4><p><strong>函数名：</strong> ValueFill</p><p><strong>输入序列：</strong> 单列时序数据，类型为INT32 / INT64 / FLOAT / DOUBLE</p><p><strong>参数：</strong></p><ul><li><code>method</code>: {&quot;mean&quot;, &quot;previous&quot;, &quot;linear&quot;, &quot;likelihood&quot;, &quot;AR&quot;, &quot;MA&quot;, &quot;SCREEN&quot;}, 默认为 &quot;linear&quot;。其中，“mean” 指使用均值填补的方法； “previous&quot; 指使用前值填补方法；“linear&quot; 指使用线性插值填补方法；“likelihood” 为基于速度的正态分布的极大似然估计方法；“AR” 指自回归的填补方法；“MA” 指滑动平均的填补方法；&quot;SCREEN&quot; 指约束填补方法；缺省情况下使用 “linear”。</li></ul><p><strong>输出序列：</strong> 填补后的单维序列。</p><p><strong>备注：</strong> AR 模型采用 AR(1)，时序列需满足自相关条件，否则将输出单个数据点 (0, 0.0).</p><h4 id="使用示例-48" tabindex="-1"><a class="header-anchor" href="#使用示例-48"><span>使用示例</span></a></h4><h5 id="使用-linear-方法进行填补" tabindex="-1"><a class="header-anchor" href="#使用-linear-方法进行填补"><span>使用 linear 方法进行填补</span></a></h5><p>当<code>method</code>缺省或取值为 &#39;linear&#39; 时，本函数将使用线性插值方法进行填补。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d2.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|            NaN|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|          101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|            NaN|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|            NaN|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|            NaN|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|          124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|          128.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> valuefill<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-----------------------+</span>
<span class="line">|                         Time|valuefill(root.test.d2)|</span>
<span class="line">+-----------------------------+-----------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|                    NaN|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|                  101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|                  102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|                  104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|                  126.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|                  108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|                  108.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|                  113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|                  114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|                  116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|                  118.7|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|                  121.3|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|                  124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|                  126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|                  128.0|</span>
<span class="line">+-----------------------------+-----------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="使用-previous-方法进行填补" tabindex="-1"><a class="header-anchor" href="#使用-previous-方法进行填补"><span>使用 previous 方法进行填补</span></a></h5><p>当<code>method</code>取值为 &#39;previous&#39; 时，本函数将使前值填补方法进行数值填补。</p><p>输入序列同上，用于查询的 SQL 语句如下：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> valuefill<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&quot;method&quot;</span><span class="token operator">=</span><span class="token string">&quot;previous&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------------------------+</span>
<span class="line">|                         Time|valuefill(root.test.d2,&quot;method&quot;=&quot;previous&quot;)|</span>
<span class="line">+-----------------------------+-------------------------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|                                        NaN|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|                                      101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|                                      102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|                                      104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|                                      126.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|                                      108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|                                      110.5|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|                                      113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|                                      114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|                                      116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|                                      116.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|                                      116.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|                                      124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|                                      126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|                                      128.0|</span>
<span class="line">+-----------------------------+-------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="valuerepair" tabindex="-1"><a class="header-anchor" href="#valuerepair"><span>ValueRepair</span></a></h3><h4 id="注册语句-46" tabindex="-1"><a class="header-anchor" href="#注册语句-46"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> valuerepair <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.drepair.UDTFValueRepair&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-49" tabindex="-1"><a class="header-anchor" href="#函数简介-49"><span>函数简介</span></a></h4><p>本函数用于对时间序列的数值进行修复。目前，本函数支持两种修复方法：<strong>Screen</strong> 是一种基于速度阈值的方法，在最小改动的前提下使得所有的速度符合阈值要求；<strong>LsGreedy</strong> 是一种基于速度变化似然的方法，将速度变化建模为高斯分布，并采用贪心算法极大化似然函数。</p><p><strong>函数名：</strong> VALUEREPAIR</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>method</code>：修复时采用的方法，取值为 &#39;Screen&#39; 或 &#39;LsGreedy&#39;. 在缺省情况下，使用 Screen 方法进行修复。</li><li><code>minSpeed</code>：该参数仅在使用 Screen 方法时有效。当速度小于该值时会被视作数值异常点加以修复。在缺省情况下为中位数减去三倍绝对中位差。</li><li><code>maxSpeed</code>：该参数仅在使用 Screen 方法时有效。当速度大于该值时会被视作数值异常点加以修复。在缺省情况下为中位数加上三倍绝对中位差。</li><li><code>center</code>：该参数仅在使用 LsGreedy 方法时有效。对速度变化分布建立的高斯模型的中心。在缺省情况下为 0。</li><li><code>sigma</code> ：该参数仅在使用 LsGreedy 方法时有效。对速度变化分布建立的高斯模型的标准差。在缺省情况下为绝对中位差。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型与输入序列相同。该序列是修复后的输入序列。</p><p><strong>提示：</strong> 输入序列中的<code>NaN</code>在修复之前会先进行线性插值填补。</p><h4 id="使用示例-49" tabindex="-1"><a class="header-anchor" href="#使用示例-49"><span>使用示例</span></a></h4><h5 id="使用-screen-方法进行修复" tabindex="-1"><a class="header-anchor" href="#使用-screen-方法进行修复"><span>使用 Screen 方法进行修复</span></a></h5><p>当<code>method</code>缺省或取值为 &#39;Screen&#39; 时，本函数将使用 Screen 方法进行数值修复。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d2.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|          101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|          104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|          112.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|          113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|          116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|          118.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|          124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|          126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|            NaN|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> valuerepair<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+----------------------------+</span>
<span class="line">|                         Time|valuerepair(root.test.d2.s1)|</span>
<span class="line">+-----------------------------+----------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|                       100.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|                       101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|                       102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|                       104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|                       106.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|                       108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|                       112.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|                       113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|                       114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|                       116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|                       118.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|                       120.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|                       124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|                       126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|                       128.0|</span>
<span class="line">+-----------------------------+----------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="使用-lsgreedy-方法进行修复" tabindex="-1"><a class="header-anchor" href="#使用-lsgreedy-方法进行修复"><span>使用 LsGreedy 方法进行修复</span></a></h5><p>当<code>method</code>取值为 &#39;LsGreedy&#39; 时，本函数将使用 LsGreedy 方法进行数值修复。</p><p>输入序列同上，用于查询的 SQL 语句如下：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> valuerepair<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&#39;method&#39;</span><span class="token operator">=</span><span class="token string">&#39;LsGreedy&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------------------------------+</span>
<span class="line">|                         Time|valuerepair(root.test.d2.s1, &quot;method&quot;=&quot;LsGreedy&quot;)|</span>
<span class="line">+-----------------------------+-------------------------------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|                                            100.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|                                            101.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|                                            102.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|                                            104.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|                                            106.0|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|                                            108.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|                                            112.0|</span>
<span class="line">|2020-01-01T00:00:15.000+08:00|                                            113.0|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|                                            114.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|                                            116.0|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|                                            118.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|                                            120.0|</span>
<span class="line">|2020-01-01T00:00:26.000+08:00|                                            124.0|</span>
<span class="line">|2020-01-01T00:00:28.000+08:00|                                            126.0|</span>
<span class="line">|2020-01-01T00:00:30.000+08:00|                                            128.0|</span>
<span class="line">+-----------------------------+-------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="masterrepair" tabindex="-1"><a class="header-anchor" href="#masterrepair"><span>MasterRepair</span></a></h3><h4 id="函数简介-50" tabindex="-1"><a class="header-anchor" href="#函数简介-50"><span>函数简介</span></a></h4><p>本函数实现基于主数据的时间序列数据修复。</p><p>**函数名：**MasterRepair</p><p><strong>输入序列：</strong> 支持多个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>omega</code>：算法窗口大小，非负整数（单位为毫秒）， 在缺省情况下，算法根据不同时间差下的两个元组距离自动估计该参数。</li><li><code>eta</code>：算法距离阈值，正数， 在缺省情况下，算法根据窗口中元组的距离分布自动估计该参数。</li><li><code>k</code>：主数据中的近邻数量，正整数， 在缺省情况下，算法根据主数据中的k个近邻的元组距离自动估计该参数。</li><li><code>output_column</code>：输出列的序号，默认输出第一列的修复结果。</li></ul><p>**输出序列：**输出单个序列，类型与输入数据中对应列的类型相同，序列为输入列修复后的结果。</p><h4 id="使用示例-50" tabindex="-1"><a class="header-anchor" href="#使用示例-50"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------+------------+------------+------------+------------+------------+</span>
<span class="line">|                         Time|root.test.t1|root.test.t2|root.test.t3|root.test.m1|root.test.m2|root.test.m3|</span>
<span class="line">+-----------------------------+------------+------------+------------+------------+------------+------------+</span>
<span class="line">|2021-07-01T12:00:01.000+08:00|        1704|     1154.55|       0.195|        1704|     1154.55|       0.195|</span>
<span class="line">|2021-07-01T12:00:02.000+08:00|        1702|     1152.30|       0.193|        1702|     1152.30|       0.193|</span>
<span class="line">|2021-07-01T12:00:03.000+08:00|        1702|     1148.65|       0.192|        1702|     1148.65|       0.192|</span>
<span class="line">|2021-07-01T12:00:04.000+08:00|        1701|     1145.20|       0.194|        1701|     1145.20|       0.194|</span>
<span class="line">|2021-07-01T12:00:07.000+08:00|        1703|     1150.55|       0.195|        1703|     1150.55|       0.195|</span>
<span class="line">|2021-07-01T12:00:08.000+08:00|        1694|     1151.55|       0.193|        1704|     1151.55|       0.193|</span>
<span class="line">|2021-07-01T12:01:09.000+08:00|        1705|     1153.55|       0.194|        1705|     1153.55|       0.194|</span>
<span class="line">|2021-07-01T12:01:10.000+08:00|        1706|     1152.30|       0.190|        1706|     1152.30|       0.190|</span>
<span class="line">+-----------------------------+------------+------------+------------+------------+------------+------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> MasterRepair<span class="token punctuation">(</span>t1<span class="token punctuation">,</span>t2<span class="token punctuation">,</span>t3<span class="token punctuation">,</span>m1<span class="token punctuation">,</span>m2<span class="token punctuation">,</span>m3<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------------------------------------------------------------------------+</span>
<span class="line">|                         Time|MasterRepair(root.test.t1,root.test.t2,root.test.t3,root.test.m1,root.test.m2,root.test.m3)|</span>
<span class="line">+-----------------------------+-------------------------------------------------------------------------------------------+</span>
<span class="line">|2021-07-01T12:00:01.000+08:00|                                                                                       1704|</span>
<span class="line">|2021-07-01T12:00:02.000+08:00|                                                                                       1702|</span>
<span class="line">|2021-07-01T12:00:03.000+08:00|                                                                                       1702|</span>
<span class="line">|2021-07-01T12:00:04.000+08:00|                                                                                       1701|</span>
<span class="line">|2021-07-01T12:00:07.000+08:00|                                                                                       1703|</span>
<span class="line">|2021-07-01T12:00:08.000+08:00|                                                                                       1704|</span>
<span class="line">|2021-07-01T12:01:09.000+08:00|                                                                                       1705|</span>
<span class="line">|2021-07-01T12:01:10.000+08:00|                                                                                       1706|</span>
<span class="line">+-----------------------------+-------------------------------------------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="seasonalrepair" tabindex="-1"><a class="header-anchor" href="#seasonalrepair"><span>SeasonalRepair</span></a></h3><h4 id="函数简介-51" tabindex="-1"><a class="header-anchor" href="#函数简介-51"><span>函数简介</span></a></h4><p>本函数用于对周期性时间序列的数值进行基于分解的修复。目前，本函数支持两种方法：<strong>Classical</strong>使用经典分解方法得到的残差项检测数值的异常波动，并使用滑动平均修复序列；<strong>Improved</strong>使用改进的分解方法得到的残差项检测数值的异常波动，并使用滑动中值修复序列。</p><p><strong>函数名：</strong> SEASONALREPAIR</p><p><strong>输入序列：</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数：</strong></p><ul><li><code>method</code>：修复时采用的分解方法，取值为&#39;Classical&#39;或&#39;Improved&#39;。在缺省情况下，使用经典分解方法进行修复。</li><li><code>period</code>：序列的周期。</li><li><code>k</code>：残差项的范围阈值，用来限制残差项偏离中心的程度。在缺省情况下为9。</li><li><code>max_iter</code>：算法的最大迭代次数。在缺省情况下为10。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型与输入序列相同。该序列是修复后的输入序列。</p><p><strong>提示：</strong> 输入序列中的<code>NaN</code>在修复之前会先进行线性插值填补。</p><h4 id="使用示例-51" tabindex="-1"><a class="header-anchor" href="#使用示例-51"><span>使用示例</span></a></h4><h5 id="使用经典分解方法进行修复" tabindex="-1"><a class="header-anchor" href="#使用经典分解方法进行修复"><span>使用经典分解方法进行修复</span></a></h5><p>当<code>method</code>缺省或取值为&#39;Classical&#39;时，本函数将使用经典分解方法进行数值修复。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d2.s1|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|          100.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|          120.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|           80.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|          100.5|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|          119.5|</span>
<span class="line">|2020-01-01T00:00:12.000+08:00|          101.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|           99.5|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|          119.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|           80.5|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|           99.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|          121.0|</span>
<span class="line">|2020-01-01T00:00:24.000+08:00|           79.5|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> seasonalrepair<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&#39;period&#39;</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&#39;k&#39;</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------------------------------------+</span>
<span class="line">|                         Time|seasonalrepair(root.test.d2.s1, &#39;period&#39;=4, &#39;k&#39;=2)|</span>
<span class="line">+-----------------------------+--------------------------------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|                                             100.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|                                             120.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|                                              80.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|                                             100.5|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|                                             119.5|</span>
<span class="line">|2020-01-01T00:00:12.000+08:00|                                              87.0|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|                                              99.5|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|                                             119.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|                                              80.5|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|                                              99.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|                                             121.0|</span>
<span class="line">|2020-01-01T00:00:24.000+08:00|                                              79.5|</span>
<span class="line">+-----------------------------+--------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="使用改进的分解方法进行修复" tabindex="-1"><a class="header-anchor" href="#使用改进的分解方法进行修复"><span>使用改进的分解方法进行修复</span></a></h5><p>当<code>method</code>取值为&#39;Improved&#39;时，本函数将使用改进的分解方法进行数值修复。</p><p>输入序列同上，用于查询的SQL语句如下：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> seasonalrepair<span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">&#39;method&#39;</span><span class="token operator">=</span><span class="token string">&#39;improved&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;period&#39;</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------------------------------------------+</span>
<span class="line">|                         Time|valuerepair(root.test.d2.s1, &#39;method&#39;=&#39;improved&#39;, &#39;period&#39;=3)|</span>
<span class="line">+-----------------------------+-------------------------------------------------------------+</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|                                                        100.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|                                                        120.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|                                                         80.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|                                                        100.5|</span>
<span class="line">|2020-01-01T00:00:10.000+08:00|                                                        119.5|</span>
<span class="line">|2020-01-01T00:00:12.000+08:00|                                                         81.5|</span>
<span class="line">|2020-01-01T00:00:14.000+08:00|                                                         99.5|</span>
<span class="line">|2020-01-01T00:00:16.000+08:00|                                                        119.0|</span>
<span class="line">|2020-01-01T00:00:18.000+08:00|                                                         80.5|</span>
<span class="line">|2020-01-01T00:00:20.000+08:00|                                                         99.0|</span>
<span class="line">|2020-01-01T00:00:22.000+08:00|                                                        121.0|</span>
<span class="line">|2020-01-01T00:00:24.000+08:00|                                                         79.5|</span>
<span class="line">+-----------------------------+-------------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="序列发现" tabindex="-1"><a class="header-anchor" href="#序列发现"><span>序列发现</span></a></h2><h3 id="consecutivesequences" tabindex="-1"><a class="header-anchor" href="#consecutivesequences"><span>ConsecutiveSequences</span></a></h3><h4 id="注册语句-47" tabindex="-1"><a class="header-anchor" href="#注册语句-47"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> consecutivesequences <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.series.UDTFConsecutiveSequences&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-52" tabindex="-1"><a class="header-anchor" href="#函数简介-52"><span>函数简介</span></a></h4><p>本函数用于在多维严格等间隔数据中发现局部最长连续子序列。</p><p>严格等间隔数据是指数据的时间间隔是严格相等的，允许存在数据缺失（包括行缺失和值缺失），但不允许存在数据冗余和时间戳偏移。</p><p>连续子序列是指严格按照标准时间间隔等距排布，不存在任何数据缺失的子序列。如果某个连续子序列不是任何连续子序列的真子序列，那么它是局部最长的。</p><p><strong>函数名：</strong> CONSECUTIVESEQUENCES</p><p><strong>输入序列：</strong> 支持多个输入序列，类型可以是任意的，但要满足严格等间隔的要求。</p><p><strong>参数：</strong></p><ul><li><code>gap</code>：标准时间间隔，是一个有单位的正数。目前支持五种单位，分别是&#39;ms&#39;（毫秒）、&#39;s&#39;（秒）、&#39;m&#39;（分钟）、&#39;h&#39;（小时）和&#39;d&#39;（天）。在缺省情况下，函数会利用众数估计标准时间间隔。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为 INT32。输出序列中的每一个数据点对应一个局部最长连续子序列，时间戳为子序列的起始时刻，值为子序列包含的数据点个数。</p><p><strong>提示：</strong> 对于不符合要求的输入，本函数不对输出做任何保证。</p><h4 id="使用示例-52" tabindex="-1"><a class="header-anchor" href="#使用示例-52"><span>使用示例</span></a></h4><h5 id="手动指定标准时间间隔" tabindex="-1"><a class="header-anchor" href="#手动指定标准时间间隔"><span>手动指定标准时间间隔</span></a></h5><p>本函数可以通过<code>gap</code>参数手动指定标准时间间隔。需要注意的是，错误的参数设置会导致输出产生严重错误。</p><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|root.test.d1.s2|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|2020-01-01T00:00:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:05:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:10:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:20:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:25:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:30:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:35:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:40:00.000+08:00|            1.0|           null|</span>
<span class="line">|2020-01-01T00:45:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:50:00.000+08:00|            1.0|            1.0|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> consecutivesequences<span class="token punctuation">(</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">,</span><span class="token string">&#39;gap&#39;</span><span class="token operator">=</span><span class="token string">&#39;5m&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------------------------------------------------------------+</span>
<span class="line">|                         Time|consecutivesequences(root.test.d1.s1, root.test.d1.s2, &quot;gap&quot;=&quot;5m&quot;)|</span>
<span class="line">+-----------------------------+------------------------------------------------------------------+</span>
<span class="line">|2020-01-01T00:00:00.000+08:00|                                                                 3|</span>
<span class="line">|2020-01-01T00:20:00.000+08:00|                                                                 4|</span>
<span class="line">|2020-01-01T00:45:00.000+08:00|                                                                 2|</span>
<span class="line">+-----------------------------+------------------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="自动估计标准时间间隔" tabindex="-1"><a class="header-anchor" href="#自动估计标准时间间隔"><span>自动估计标准时间间隔</span></a></h5><p>当<code>gap</code>参数缺省时，本函数可以利用众数估计标准时间间隔，得到同样的结果。因此，这种用法更受推荐。</p><p>输入序列同上，用于查询的SQL语句如下：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> consecutivesequences<span class="token punctuation">(</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+------------------------------------------------------+</span>
<span class="line">|                         Time|consecutivesequences(root.test.d1.s1, root.test.d1.s2)|</span>
<span class="line">+-----------------------------+------------------------------------------------------+</span>
<span class="line">|2020-01-01T00:00:00.000+08:00|                                                     3|</span>
<span class="line">|2020-01-01T00:20:00.000+08:00|                                                     4|</span>
<span class="line">|2020-01-01T00:45:00.000+08:00|                                                     2|</span>
<span class="line">+-----------------------------+------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="consecutivewindows" tabindex="-1"><a class="header-anchor" href="#consecutivewindows"><span>ConsecutiveWindows</span></a></h3><h4 id="注册语句-48" tabindex="-1"><a class="header-anchor" href="#注册语句-48"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> consecutivewindows <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.series.UDTFConsecutiveWindows&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-53" tabindex="-1"><a class="header-anchor" href="#函数简介-53"><span>函数简介</span></a></h4><p>本函数用于在多维严格等间隔数据中发现指定长度的连续窗口。</p><p>严格等间隔数据是指数据的时间间隔是严格相等的，允许存在数据缺失（包括行缺失和值缺失），但不允许存在数据冗余和时间戳偏移。</p><p>连续窗口是指严格按照标准时间间隔等距排布，不存在任何数据缺失的子序列。</p><p><strong>函数名：</strong> CONSECUTIVEWINDOWS</p><p><strong>输入序列：</strong> 支持多个输入序列，类型可以是任意的，但要满足严格等间隔的要求。</p><p><strong>参数：</strong></p><ul><li><code>gap</code>：标准时间间隔，是一个有单位的正数。目前支持五种单位，分别是 &#39;ms&#39;（毫秒）、&#39;s&#39;（秒）、&#39;m&#39;（分钟）、&#39;h&#39;（小时）和&#39;d&#39;（天）。在缺省情况下，函数会利用众数估计标准时间间隔。</li><li><code>length</code>：序列长度，是一个有单位的正数。目前支持五种单位，分别是 &#39;ms&#39;（毫秒）、&#39;s&#39;（秒）、&#39;m&#39;（分钟）、&#39;h&#39;（小时）和&#39;d&#39;（天）。该参数不允许缺省。</li></ul><p><strong>输出序列：</strong> 输出单个序列，类型为 INT32。输出序列中的每一个数据点对应一个指定长度连续子序列，时间戳为子序列的起始时刻，值为子序列包含的数据点个数。</p><p><strong>提示：</strong> 对于不符合要求的输入，本函数不对输出做任何保证。</p><h4 id="使用示例-53" tabindex="-1"><a class="header-anchor" href="#使用示例-53"><span>使用示例</span></a></h4><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|                         Time|root.test.d1.s1|root.test.d1.s2|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|2020-01-01T00:00:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:05:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:10:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:20:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:25:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:30:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:35:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:40:00.000+08:00|            1.0|           null|</span>
<span class="line">|2020-01-01T00:45:00.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:50:00.000+08:00|            1.0|            1.0|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的SQL语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> consecutivewindows<span class="token punctuation">(</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">,</span><span class="token string">&#39;length&#39;</span><span class="token operator">=</span><span class="token string">&#39;10m&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+--------------------------------------------------------------------+</span>
<span class="line">|                         Time|consecutivewindows(root.test.d1.s1, root.test.d1.s2, &quot;length&quot;=&quot;10m&quot;)|</span>
<span class="line">+-----------------------------+--------------------------------------------------------------------+</span>
<span class="line">|2020-01-01T00:00:00.000+08:00|                                                                   3|</span>
<span class="line">|2020-01-01T00:20:00.000+08:00|                                                                   3|</span>
<span class="line">|2020-01-01T00:25:00.000+08:00|                                                                   3|</span>
<span class="line">+-----------------------------+--------------------------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="机器学习" tabindex="-1"><a class="header-anchor" href="#机器学习"><span>机器学习</span></a></h2><h3 id="ar" tabindex="-1"><a class="header-anchor" href="#ar"><span>AR</span></a></h3><h4 id="注册语句-49" tabindex="-1"><a class="header-anchor" href="#注册语句-49"><span>注册语句</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">function</span> ar <span class="token keyword">as</span> <span class="token string">&#39;org.apache.iotdb.library.dlearn.UDTFAR&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="函数简介-54" tabindex="-1"><a class="header-anchor" href="#函数简介-54"><span>函数简介</span></a></h4><p>本函数用于学习数据的自回归模型系数。</p><p><strong>函数名:</strong> AR</p><p><strong>输入序列:</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数:</strong></p><ul><li><code>p</code>：自回归模型的阶数。默认为1。</li></ul><p><strong>输出序列:</strong> 输出单个序列，类型为 DOUBLE。第一行对应模型的一阶系数，以此类推。</p><p><strong>提示:</strong></p><ul><li><p><code>p</code>应为正整数。</p></li><li><p>序列中的大部分点为等间隔采样点。</p></li><li><p>序列中的缺失点通过线性插值进行填补后用于学习过程。</p></li></ul><h4 id="使用示例-54" tabindex="-1"><a class="header-anchor" href="#使用示例-54"><span>使用示例</span></a></h4><h5 id="指定阶数" tabindex="-1"><a class="header-anchor" href="#指定阶数"><span>指定阶数</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d0.s0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:01.000+08:00|           -4.0|</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|           -3.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|           -2.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|           -1.0|</span>
<span class="line">|2020-01-01T00:00:05.000+08:00|            0.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|            1.0|</span>
<span class="line">|2020-01-01T00:00:07.000+08:00|            2.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|            3.0|</span>
<span class="line">|2020-01-01T00:00:09.000+08:00|            4.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> ar<span class="token punctuation">(</span>s0<span class="token punctuation">,</span><span class="token string">&quot;p&quot;</span><span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------------------+</span>
<span class="line">|                         Time|ar(root.test.d0.s0,&quot;p&quot;=&quot;2&quot;)|</span>
<span class="line">+-----------------------------+---------------------------+</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|                     0.9429|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|                    -0.2571|</span>
<span class="line">+-----------------------------+---------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="representation" tabindex="-1"><a class="header-anchor" href="#representation"><span>Representation</span></a></h3><h4 id="函数简介-55" tabindex="-1"><a class="header-anchor" href="#函数简介-55"><span>函数简介</span></a></h4><p>本函数用于时间序列的表示。</p><p><strong>函数名:</strong> Representation</p><p><strong>输入序列:</strong> 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数:</strong></p><ul><li><code>tb</code>：时间分块数量。默认为10。</li><li><code>vb</code>：值分块数量。默认为10。</li></ul><p><strong>输出序列:</strong> 输出单个序列，类型为INT32，长度为<code>tb*vb</code>。序列的时间戳从0开始，仅用于表示顺序。</p><p><strong>提示:</strong></p><ul><li><code>tb </code>,<code>vb</code>应为正整数。</li></ul><h4 id="使用示例-55" tabindex="-1"><a class="header-anchor" href="#使用示例-55"><span>使用示例</span></a></h4><h5 id="指定时间分块数量、值分块数量" tabindex="-1"><a class="header-anchor" href="#指定时间分块数量、值分块数量"><span>指定时间分块数量、值分块数量</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+</span>
<span class="line">|                         Time|root.test.d0.s0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line">|2020-01-01T00:00:01.000+08:00|           -4.0|</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|           -3.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|           -2.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|           -1.0|</span>
<span class="line">|2020-01-01T00:00:05.000+08:00|            0.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|            1.0|</span>
<span class="line">|2020-01-01T00:00:07.000+08:00|            2.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|            3.0|</span>
<span class="line">|2020-01-01T00:00:09.000+08:00|            4.0|</span>
<span class="line">+-----------------------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> representation<span class="token punctuation">(</span>s0<span class="token punctuation">,</span><span class="token string">&quot;tb&quot;</span><span class="token operator">=</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;vb&quot;</span><span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-------------------------------------------------+</span>
<span class="line">|                         Time|representation(root.test.d0.s0,&quot;tb&quot;=&quot;3&quot;,&quot;vb&quot;=&quot;2&quot;)|</span>
<span class="line">+-----------------------------+-------------------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|                                                1|</span>
<span class="line">|1970-01-01T08:00:00.002+08:00|                                                1|</span>
<span class="line">|1970-01-01T08:00:00.003+08:00|                                                0|</span>
<span class="line">|1970-01-01T08:00:00.004+08:00|                                                0|</span>
<span class="line">|1970-01-01T08:00:00.005+08:00|                                                1|</span>
<span class="line">|1970-01-01T08:00:00.006+08:00|                                                1|</span>
<span class="line">+-----------------------------+-------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rm" tabindex="-1"><a class="header-anchor" href="#rm"><span>RM</span></a></h3><h4 id="函数简介-56" tabindex="-1"><a class="header-anchor" href="#函数简介-56"><span>函数简介</span></a></h4><p>本函数用于基于时间序列表示的匹配度。</p><p><strong>函数名:</strong> RM</p><p><strong>输入序列:</strong> 仅支持两个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。</p><p><strong>参数:</strong></p><ul><li><code>tb</code>：时间分块数量。默认为10。</li><li><code>vb</code>：值分块数量。默认为10。</li></ul><p><strong>输出序列:</strong> 输出单个序列，类型为DOUBLE，长度为<code>1</code>。序列的时间戳从0开始，序列仅有一个数据点，其时间戳为0，值为两个时间序列的匹配度。</p><p><strong>提示:</strong></p><ul><li><code>tb </code>,<code>vb</code>应为正整数。</li></ul><h4 id="使用示例-56" tabindex="-1"><a class="header-anchor" href="#使用示例-56"><span>使用示例</span></a></h4><h5 id="指定时间分块数量、值分块数量-1" tabindex="-1"><a class="header-anchor" href="#指定时间分块数量、值分块数量-1"><span>指定时间分块数量、值分块数量</span></a></h5><p>输入序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|                         Time|root.test.d0.s0|root.test.d0.s1</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line">|2020-01-01T00:00:01.000+08:00|           -4.0|           -4.0|</span>
<span class="line">|2020-01-01T00:00:02.000+08:00|           -3.0|           -3.0|</span>
<span class="line">|2020-01-01T00:00:03.000+08:00|           -3.0|           -3.0|</span>
<span class="line">|2020-01-01T00:00:04.000+08:00|           -1.0|           -1.0|</span>
<span class="line">|2020-01-01T00:00:05.000+08:00|            0.0|            0.0|</span>
<span class="line">|2020-01-01T00:00:06.000+08:00|            1.0|            1.0|</span>
<span class="line">|2020-01-01T00:00:07.000+08:00|            2.0|            2.0|</span>
<span class="line">|2020-01-01T00:00:08.000+08:00|            3.0|            3.0|</span>
<span class="line">|2020-01-01T00:00:09.000+08:00|            4.0|            4.0|</span>
<span class="line">+-----------------------------+---------------+---------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于查询的 SQL 语句：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">select</span> rm<span class="token punctuation">(</span>s0<span class="token punctuation">,</span> s1<span class="token punctuation">,</span><span class="token string">&quot;tb&quot;</span><span class="token operator">=</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;vb&quot;</span><span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出序列：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">+-----------------------------+-----------------------------------------------------+</span>
<span class="line">|                         Time|rm(root.test.d0.s0,root.test.d0.s1,&quot;tb&quot;=&quot;3&quot;,&quot;vb&quot;=&quot;2&quot;)|</span>
<span class="line">+-----------------------------+-----------------------------------------------------+</span>
<span class="line">|1970-01-01T08:00:00.001+08:00|                                                 1.00|</span>
<span class="line">+-----------------------------+-----------------------------------------------------+</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/apache/iotdb-docs/edit/main/src/zh/UserGuide/V1.3.0-2/Reference/UDF-Libraries.md" aria-label="发现错误？在 GitHub 上编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->发现错误？在 GitHub 上编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><!----></div></footer><nav class="vp-page-nav"><!----><a class="route-link auto-link next" href="/zh/UserGuide/V1.3.0-2/Reference/UDF-development.html" aria-label="UDF开发"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">UDF开发<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!--]--><footer style="padding-bottom:2rem;"><span id="doc-version" style="display:none;">latest</span><p style="text-align:center;color:#909399;font-size:12px;margin:0 30px;">Copyright © 2024 The Apache Software Foundation.<br> Apache IoTDB, IoTDB, Apache, the Apache feather logo, and the Apache IoTDB project logo are either registered trademarks or trademarks of The Apache Software Foundation in all countries</p><p style="text-align:center;margin-top:10px;color:#909399;font-size:12px;margin:0 30px;"><strong>Have a question?</strong> Connect with us on QQ, WeChat, or Slack. <a href="https://github.com/apache/iotdb/issues/1995">Join the community</a> now.</p></footer></div><!--]--><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BHE9oQwv.js" defer></script>
  </body>
</html>
